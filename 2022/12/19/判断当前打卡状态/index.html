<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.9.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="判断当前打卡状态">




  <meta name="keywords" content="VUE,uniapp开发,">





  <link rel="alternate" href="/default" title="Cholesterol">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.5">



<link rel="canonical" href="http://unknownfor.github.io/2022/12/19/判断当前打卡状态/">


<meta name="description" content="做考勤需求，公司下存在多个考勤时间段，需要判断当前打卡是上班、下班、早退或者迟到等状态 需要注意的点：  会出现9:00-18：00的考勤时间，也会出现9:00-12:00，13:15 - 18:00 等不定时的多个考勤时间段 公司可以设置不同星期几，设置不一样的考勤时间规则，比如周一到周四9:00-18：00，周五10:00-20:15，周六日休息没有考勤时间 周六日没有设置考勤规则，也就是非工">
<meta name="keywords" content="VUE,uniapp开发">
<meta property="og:type" content="article">
<meta property="og:title" content="判断当前打卡状态">
<meta property="og:url" content="http://unknownfor.github.io/2022/12/19/判断当前打卡状态/index.html">
<meta property="og:site_name" content="Cholesterol">
<meta property="og:description" content="做考勤需求，公司下存在多个考勤时间段，需要判断当前打卡是上班、下班、早退或者迟到等状态 需要注意的点：  会出现9:00-18：00的考勤时间，也会出现9:00-12:00，13:15 - 18:00 等不定时的多个考勤时间段 公司可以设置不同星期几，设置不一样的考勤时间规则，比如周一到周四9:00-18：00，周五10:00-20:15，周六日休息没有考勤时间 周六日没有设置考勤规则，也就是非工">
<meta property="og:locale" content="ch">
<meta property="og:image" content="https://im5.ezgif.com/tmp/ezgif-5-dd1195d2fa.png">
<meta property="og:image" content="https://im5.ezgif.com/tmp/ezgif-5-abca540ebf.png">
<meta property="og:updated_time" content="2022-12-19T03:24:19.523Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="判断当前打卡状态">
<meta name="twitter:description" content="做考勤需求，公司下存在多个考勤时间段，需要判断当前打卡是上班、下班、早退或者迟到等状态 需要注意的点：  会出现9:00-18：00的考勤时间，也会出现9:00-12:00，13:15 - 18:00 等不定时的多个考勤时间段 公司可以设置不同星期几，设置不一样的考勤时间规则，比如周一到周四9:00-18：00，周五10:00-20:15，周六日休息没有考勤时间 周六日没有设置考勤规则，也就是非工">
<meta name="twitter:image" content="https://im5.ezgif.com/tmp/ezgif-5-dd1195d2fa.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.5">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  



    <title> 判断当前打卡状态 - Cholesterol </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Cholesterol</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          判断当前打卡状态
        
      </h1>

      <time class="post-time">
          Dec 19 2022
      </time>
    </header>



    
            <div class="post-content">
            <p>做考勤需求，公司下存在多个考勤时间段，需要判断当前打卡是上班、下班、早退或者迟到等状态</p>
<p>需要注意的点：</p>
<ol>
<li>会出现9:00-18：00的考勤时间，也会出现9:00-12:00，13:15 - 18:00 等不定时的多个考勤时间段</li>
<li>公司可以设置不同星期几，设置不一样的考勤时间规则，比如周一到周四9:00-18：00，周五10:00-20:15，周六日休息没有考勤时间</li>
<li>周六日没有设置考勤规则，也就是非工作日打卡，当天没有打卡记录，则本次为上班；有打卡记录，则本次为下班</li>
<li>需要按照接口返回的法定调休或者公共假期，剔除节假日，节假日打卡按3处理</li>
<li>9点上班，9点整打卡为迟到，8:59打卡为正常上班</li>
</ol>
<h4 id="考勤判断基本规则"><a href="#考勤判断基本规则" class="headerlink" title="考勤判断基本规则"></a>考勤判断基本规则</h4><p><img src="https://im5.ezgif.com/tmp/ezgif-5-dd1195d2fa.png" alt="image"></p>
<h4 id="多时段考勤规则梳理"><a href="#多时段考勤规则梳理" class="headerlink" title="多时段考勤规则梳理"></a>多时段考勤规则梳理</h4><p><img src="https://im5.ezgif.com/tmp/ezgif-5-abca540ebf.png" alt="image"></p>
<h4 id="utils-js"><a href="#utils-js" class="headerlink" title="utils.js"></a>utils.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * js判断当前“时 : 分”是否在一天中某一区间内</span></span><br><span class="line"><span class="comment"> * 比如：15.30 在不在08.30到16.00之间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">beginTime</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">endTime</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAuditTime</span>(<span class="params">beginTime, endTime</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nowDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> beginDate = <span class="keyword">new</span> <span class="built_in">Date</span>(nowDate);</span><br><span class="line">  <span class="keyword">var</span> endDate = <span class="keyword">new</span> <span class="built_in">Date</span>(nowDate);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> beginIndex = beginTime.lastIndexOf(<span class="string">':'</span>);</span><br><span class="line">  <span class="keyword">var</span> beginHour = beginTime.substring(<span class="number">0</span>, beginIndex);</span><br><span class="line">  <span class="keyword">var</span> beginMinue = beginTime.substring(beginIndex + <span class="number">1</span>, beginTime.length);</span><br><span class="line">  beginDate.setHours(beginHour, beginMinue, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> endIndex = endTime.lastIndexOf(<span class="string">':'</span>);</span><br><span class="line">  <span class="keyword">var</span> endHour = endTime.substring(<span class="number">0</span>, endIndex);</span><br><span class="line">  <span class="keyword">var</span> endMinue = endTime.substring(endIndex + <span class="number">1</span>, endTime.length);</span><br><span class="line">  endDate.setHours(endHour, endMinue, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    nowDate.getTime() - beginDate.getTime() &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">    nowDate.getTime() &lt;= endDate.getTime()</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [isDuringDate 比较指定时间是否在指定时间段内]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">dongsir</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DateTime </span>2019-08-21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version </span>1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  </span>date  [beginDateStr] [开始时间]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  </span>date  [endDateStr]  [结束时间]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param  </span>date  [compareDateStr]  [需要比较的时间]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return  <span class="variable">Boolean</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isDuringDate</span>(<span class="params">beginDateStr, endDateStr, compareDateStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> curDate = <span class="keyword">new</span> <span class="built_in">Date</span>(compareDateStr),</span><br><span class="line">    beginDate = <span class="keyword">new</span> <span class="built_in">Date</span>(beginDateStr),</span><br><span class="line">    endDate = <span class="keyword">new</span> <span class="built_in">Date</span>(endDateStr);</span><br><span class="line">  <span class="keyword">if</span> (curDate &gt;= beginDate &amp;&amp; curDate &lt;= endDate) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="index-vue"><a href="#index-vue" class="headerlink" title="index.vue"></a>index.vue</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-if</span>=<span class="string">"innerVisible"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 普通打卡的弹窗 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">u-popup</span> <span class="attr">:show</span>=<span class="string">"show"</span></span></span></span><br><span class="line"><span class="xml">      v-if="show"</span></span><br><span class="line"><span class="xml">      overlay</span></span><br><span class="line"><span class="xml">      round="10"</span></span><br><span class="line"><span class="xml">      closeOnClickOverlay</span></span><br><span class="line"><span class="xml">      :safeAreaInsetBottom="false"</span></span><br><span class="line"><span class="xml">      @close="closePopup"</span></span><br><span class="line"><span class="xml">      mode="center"&gt;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"check-container"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"check-box"</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"icon"</span></span></span></span><br><span class="line"><span class="xml">            v-if="check.show_error"</span></span><br><span class="line"><span class="xml">            src="/static/pages_tools/gps-error.svg"&gt;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">"icon"</span></span></span></span><br><span class="line"><span class="xml">            v-else</span></span><br><span class="line"><span class="xml">            src="/static/pages_tools/gps-success.svg"&gt;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"info"</span></span></span></span><br><span class="line"><span class="xml">            v-if="check.type_name"</span></span><br><span class="line"><span class="xml">            :class="check.show_error ? 'error' : ''"&gt;</span><span class="template-variable">&#123;&#123; check.type_name &#125;&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"address"</span>&gt;</span></span><span class="template-variable">&#123;&#123; check_placeName &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"time"</span>&gt;</span></span><span class="template-variable">&#123;&#123; currentTime &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn submit-btn flex justify-center items-center"</span></span></span></span><br><span class="line"><span class="xml">          @tap.stop="submit"&gt;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">text</span>&gt;</span></span><span class="template-variable">&#123;&#123; check.show_error ? '确认' : '' &#125;&#125;</span><span class="xml">打卡<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn cancel flex justify-center items-center"</span></span></span></span><br><span class="line"><span class="xml">          @tap.stop="cancel"&gt;<span class="tag">&lt;<span class="name">text</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">u-popup</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 外勤打卡弹窗 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">pp-outdoor</span> <span class="attr">v-if</span>=<span class="string">"showOutdoor"</span></span></span></span><br><span class="line"><span class="xml">      :latAndLon="latAndLon"</span></span><br><span class="line"><span class="xml">      :visible.sync="showOutdoor"</span></span><br><span class="line"><span class="xml">      @outdoorCheck="outdoorCheck"</span></span><br><span class="line"><span class="xml">      @close="closeOutdoor"&gt;<span class="tag">&lt;/<span class="name">pp-outdoor</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 打卡成功弹窗 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">pp-success</span> <span class="attr">:visible.sync</span>=<span class="string">"showSuccess"</span></span></span></span><br><span class="line"><span class="xml">      :data="success"</span></span><br><span class="line"><span class="xml">      @closeSuccess="closeSuccess" /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 打卡有冲突 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">conflict</span> <span class="attr">v-if</span>=<span class="string">"showConflict"</span></span></span></span><br><span class="line"><span class="xml">      :visible.sync="showConflict"</span></span><br><span class="line"><span class="xml">      :data="conflict"</span></span><br><span class="line"><span class="xml">      from="打卡"</span></span><br><span class="line"><span class="xml">      @cancel="closeConflict"</span></span><br><span class="line"><span class="xml">      @submit="cancelSubmit" /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 弹窗提示新增考勤组 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">u-modal</span> <span class="attr">:show</span>=<span class="string">"showManage"</span></span></span></span><br><span class="line"><span class="xml">      width="500rpx"</span></span><br><span class="line"><span class="xml">      @confirm="addGroup('add')"</span></span><br><span class="line"><span class="xml">      @cancel="cancelAddGroup"</span></span><br><span class="line"><span class="xml">      ref="noManageModal"</span></span><br><span class="line"><span class="xml">      confirmText="前往设置"</span></span><br><span class="line"><span class="xml">      :showCancelButton="true"&gt;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"slot-content"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>请先设置考勤规则<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">u-modal</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 没有考勤组信息提示弹窗--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">u-modal</span> <span class="attr">:show.sync</span>=<span class="string">"showGroup"</span></span></span></span><br><span class="line"><span class="xml">      width="500rpx"</span></span><br><span class="line"><span class="xml">      @confirm="addGroup()"</span></span><br><span class="line"><span class="xml">      @cancel="cancelAddGroup"</span></span><br><span class="line"><span class="xml">      ref="noGroupModal"</span></span><br><span class="line"><span class="xml">      confirmText="确定"</span></span><br><span class="line"><span class="xml">      cancelText="取消"</span></span><br><span class="line"><span class="xml">      confirmColor="#4C8AFC"</span></span><br><span class="line"><span class="xml">      showCancelButton="true"</span></span><br><span class="line"><span class="xml">      :safeAreaInsetBottom="false"</span></span><br><span class="line"><span class="xml">      :asyncClose="true"&gt;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"slot-content"</span>&gt;</span> 是否将自己加入考勤组？ <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">u-modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">import &#123; checkAuditTime, isDuringDate &#125; from '@/utils/index';</span></span><br><span class="line"><span class="xml">import outdoor from './outdoor-popup';</span></span><br><span class="line"><span class="xml">import successPopup from './success-popup';</span></span><br><span class="line"><span class="xml">import conflict from '../approve-conflict-modal';</span></span><br><span class="line"><span class="xml">import Big from 'big.js';</span></span><br><span class="line"><span class="xml">import dayjs from 'dayjs';</span></span><br><span class="line"><span class="xml">import isBetween from 'dayjs/plugin/isBetween';</span></span><br><span class="line"><span class="xml">dayjs.extend(isBetween);</span></span><br><span class="line"><span class="xml">import attendanceApi from '@/api/attendance';</span></span><br><span class="line"><span class="xml">const app = getApp();</span></span><br><span class="line"><span class="xml">export default &#123;</span></span><br><span class="line"><span class="xml">  props: &#123;</span></span><br><span class="line"><span class="xml">    visible: &#123;</span></span><br><span class="line"><span class="xml">      type: Boolean,</span></span><br><span class="line"><span class="xml">      default: false,</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    latAndLon: &#123;</span></span><br><span class="line"><span class="xml">      type: Object,</span></span><br><span class="line"><span class="xml">      default: () =&gt; (&#123;&#125;),</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    placeName: &#123;</span></span><br><span class="line"><span class="xml">      type: String,</span></span><br><span class="line"><span class="xml">      default: '',</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  components: &#123;</span></span><br><span class="line"><span class="xml">    'pp-outdoor': outdoor,</span></span><br><span class="line"><span class="xml">    'pp-success': successPopup,</span></span><br><span class="line"><span class="xml">    conflict,</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  computed: &#123;</span></span><br><span class="line"><span class="xml">    innerVisible: &#123;</span></span><br><span class="line"><span class="xml">      get() &#123;</span></span><br><span class="line"><span class="xml">        return this.visible;</span></span><br><span class="line"><span class="xml">      &#125;,</span></span><br><span class="line"><span class="xml">      set(v) &#123;</span></span><br><span class="line"><span class="xml">        this.$emit('update:visible', v);</span></span><br><span class="line"><span class="xml">      &#125;,</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  data() &#123;</span></span><br><span class="line"><span class="xml">    return &#123;</span></span><br><span class="line"><span class="xml">      intervalTimer: null,</span></span><br><span class="line"><span class="xml">      showOutdoor: false,</span></span><br><span class="line"><span class="xml">      attendance: &#123;</span></span><br><span class="line"><span class="xml">        placeList: [], //打卡地址</span></span><br><span class="line"><span class="xml">        timeList: [], //上下班时间</span></span><br><span class="line"><span class="xml">      &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      success: &#123;&#125;,</span></span><br><span class="line"><span class="xml">      showSuccess: false,</span></span><br><span class="line"><span class="xml">      showGroup: false, // 考勤组弹窗</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      show: false, // 打卡弹窗</span></span><br><span class="line"><span class="xml">      check: &#123;&#125;, // 打卡信息</span></span><br><span class="line"><span class="xml">      check_placeName: '', // 打卡地址</span></span><br><span class="line"><span class="xml">      currentTime: dayjs().format('HH:mm:ss'),</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      history: [], // 当天当前用户的全部考勤记录</span></span><br><span class="line"><span class="xml">      workRules: '', // 当天当前用户的考勤规则</span></span><br><span class="line"><span class="xml">      isAdmin:</span></span><br><span class="line"><span class="xml">        Vue.prototype.$storage</span></span><br><span class="line"><span class="xml">          ._getStorage('userinfo')</span></span><br><span class="line"><span class="xml">          .userAuthorizationList.filter(</span></span><br><span class="line"><span class="xml">            (a) =&gt; a.userAuthority == '100101' || a.userAuthority == '100108',</span></span><br><span class="line"><span class="xml">          ).length &gt; 0, // 管理员权限、考勤权限</span></span><br><span class="line"><span class="xml">      showManage: false, // 没有考勤组</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      showConflict: false, // 请假有冲突</span></span><br><span class="line"><span class="xml">      conflict: &#123;&#125;, // 冲突信息</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      inside_arr: [], // 考勤时间内</span></span><br><span class="line"><span class="xml">      during_arr: [], // 休息时间</span></span><br><span class="line"><span class="xml">      outside_work: &#123;&#125;, // 考勤时间外,上班</span></span><br><span class="line"><span class="xml">      outside_off: &#123;&#125;, // 考勤时间外,下班</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  mounted() &#123;</span></span><br><span class="line"><span class="xml">    let _this = this;</span></span><br><span class="line"><span class="xml">    setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">      _this.currentTime = dayjs().format('HH:mm:ss');</span></span><br><span class="line"><span class="xml">    &#125;, 1000);</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  watch: &#123;</span></span><br><span class="line"><span class="xml">    show(val) &#123;</span></span><br><span class="line"><span class="xml">      if (val) &#123;</span></span><br><span class="line"><span class="xml">        this.handleCheckType();</span></span><br><span class="line"><span class="xml">        this.intervalTimer = setInterval(this.handleCheckType, 1000);</span></span><br><span class="line"><span class="xml">        app.globalData.scrollLock = true;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    showOutdoor(val) &#123;</span></span><br><span class="line"><span class="xml">      app.globalData.scrollLock = val;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    showManage(val) &#123;</span></span><br><span class="line"><span class="xml">      app.globalData.scrollLock = val;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    showGroup(val) &#123;</span></span><br><span class="line"><span class="xml">      app.globalData.scrollLock = val;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    showSuccess(val) &#123;</span></span><br><span class="line"><span class="xml">      app.globalData.scrollLock = val;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  created() &#123;</span></span><br><span class="line"><span class="xml">    this.getUserCheckList();</span></span><br><span class="line"><span class="xml">    this.getUserAttendanceGroupDetails();</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  methods: &#123;</span></span><br><span class="line"><span class="xml">    //查询用户当天的打卡记录</span></span><br><span class="line"><span class="xml">    getUserCheckList() &#123;</span></span><br><span class="line"><span class="xml">      let params = &#123;</span></span><br><span class="line"><span class="xml">        userId: app.globalData.userId,</span></span><br><span class="line"><span class="xml">        employeeNo: app.globalData.employeeNo,</span></span><br><span class="line"><span class="xml">        enterpriseId: app.globalData.enterpriseId,</span></span><br><span class="line"><span class="xml">        date: dayjs(new Date()).format('YYYY-MM-DD'), // 今天</span></span><br><span class="line"><span class="xml">      &#125;;</span></span><br><span class="line"><span class="xml">      attendanceApi</span></span><br><span class="line"><span class="xml">        .getOneDayAttendanceByUserId(params)</span></span><br><span class="line"><span class="xml">        .then((res) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          if (res &amp;&amp; res.data &amp;&amp; res.data.clockRecord) &#123;</span></span><br><span class="line"><span class="xml">            this.history = res.data.clockRecord; // 当日打卡历史</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .catch((errors) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          uni.$u.toast(errors.msg || '获取打卡出了问题，请稍后再试');</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .finally(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">          uni.hideLoading();</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    // 获取当前用户考勤组详情</span></span><br><span class="line"><span class="xml">    getUserAttendanceGroupDetails() &#123;</span></span><br><span class="line"><span class="xml">      let params = &#123;</span></span><br><span class="line"><span class="xml">        userId: app.globalData.userId,</span></span><br><span class="line"><span class="xml">        employeeNo: app.globalData.employeeNo,</span></span><br><span class="line"><span class="xml">        enterpriseId: app.globalData.enterpriseId,</span></span><br><span class="line"><span class="xml">        hideLoadingTitle: true, // 隐藏请求动画</span></span><br><span class="line"><span class="xml">      &#125;;</span></span><br><span class="line"><span class="xml">      attendanceApi</span></span><br><span class="line"><span class="xml">        .getUserAttendanceGroupDetails(params)</span></span><br><span class="line"><span class="xml">        .then((res) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          if (res.data) &#123;</span></span><br><span class="line"><span class="xml">            this.attendance = res.data; // 考勤组信息</span></span><br><span class="line"><span class="xml">            this.workRules = this.handleCheckRules(); // 当天的考勤规则</span></span><br><span class="line"><span class="xml">            // 判断当天是否有考勤规则</span></span><br><span class="line"><span class="xml">            if (this.workRules) &#123;</span></span><br><span class="line"><span class="xml">              this.calType(this.workRules.shift.shiftTimeList);</span></span><br><span class="line"><span class="xml">              this.formatAttance();</span></span><br><span class="line"><span class="xml">            &#125; else &#123;</span></span><br><span class="line"><span class="xml">              // 没有考勤规则，属于非工作日</span></span><br><span class="line"><span class="xml">              // 有打卡记录，属于下班，否则上班</span></span><br><span class="line"><span class="xml">              this.check_placeName = this.placeName;</span></span><br><span class="line"><span class="xml">              this.history.length</span></span><br><span class="line"><span class="xml">                ? this.handleCheckStatus('offduty')</span></span><br><span class="line"><span class="xml">                : this.handleCheckStatus(0);</span></span><br><span class="line"><span class="xml">              this.show = true;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">          &#125; else &#123;</span></span><br><span class="line"><span class="xml">            // 是管理员</span></span><br><span class="line"><span class="xml">            if (this.isAdmin) &#123;</span></span><br><span class="line"><span class="xml">              this.getGroupList();</span></span><br><span class="line"><span class="xml">            &#125; else &#123;</span></span><br><span class="line"><span class="xml">              // this.$showToast('您尚未加入考勤组，无需打卡');</span></span><br><span class="line"><span class="xml">              // this.$emit('handleBottomBtnShow'); // 普通员工 - 没有考勤组 - 隐藏底部长按按钮</span></span><br><span class="line"><span class="xml">              uni.showModal(&#123;</span></span><br><span class="line"><span class="xml">                content: '您尚未加入考勤组，无需打卡',</span></span><br><span class="line"><span class="xml">                showCancel: false,</span></span><br><span class="line"><span class="xml">                confirmText: '我知道了',</span></span><br><span class="line"><span class="xml">                success: (res) =&gt; &#123;</span></span><br><span class="line"><span class="xml">                  if (res.confirm) &#123;</span></span><br><span class="line"><span class="xml">                    this.innerVisible = false;</span></span><br><span class="line"><span class="xml">                  &#125;</span></span><br><span class="line"><span class="xml">                &#125;,</span></span><br><span class="line"><span class="xml">              &#125;);</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .catch((errors) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          uni.$u.toast(errors.msg || '获取用户考勤组详情出了问题，请稍后再试');</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .finally(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">          uni.hideLoading();</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 获取考勤组列表</span></span><br><span class="line"><span class="xml">    getGroupList() &#123;</span></span><br><span class="line"><span class="xml">      let params = &#123;</span></span><br><span class="line"><span class="xml">        enterpriseId: app.globalData.enterpriseId,</span></span><br><span class="line"><span class="xml">        hideLoadingTitle: true, // 隐藏请求动画</span></span><br><span class="line"><span class="xml">      &#125;;</span></span><br><span class="line"><span class="xml">      attendanceApi</span></span><br><span class="line"><span class="xml">        .getAttendanceGroup(params)</span></span><br><span class="line"><span class="xml">        .then((res) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          // 展示新增考勤组弹窗</span></span><br><span class="line"><span class="xml">          if (res.data &amp;&amp; res.data.records &amp;&amp; res.data.records.length) &#123;</span></span><br><span class="line"><span class="xml">            this.showGroup = true; // 提示加入考勤组</span></span><br><span class="line"><span class="xml">          &#125; else &#123;</span></span><br><span class="line"><span class="xml">            this.showManage = true; // 提示设置考勤规则</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .catch((err) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          this.$showToast('获取考勤组失败');</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 当前星期几，拿到设定的对应打卡规则</span></span><br><span class="line"><span class="xml">    handleCheckRules() &#123;</span></span><br><span class="line"><span class="xml">      let res = '';</span></span><br><span class="line"><span class="xml">      let timeArr = this.attendance.timeList;</span></span><br><span class="line"><span class="xml">      let currentWeek = dayjs().day();</span></span><br><span class="line"><span class="xml">      currentWeek == 0 ? (currentWeek = 7) : ''; // 强制转换周日由0变7</span></span><br><span class="line"><span class="xml">      if (timeArr &amp;&amp; timeArr.length) &#123;</span></span><br><span class="line"><span class="xml">        timeArr.map((t) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          if (t.clockWeek.includes(currentWeek)) &#123;</span></span><br><span class="line"><span class="xml">            res = t; // 当天的考勤规则</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      return res;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 判断是否在打卡范围内</span></span><br><span class="line"><span class="xml">    formatAttance() &#123;</span></span><br><span class="line"><span class="xml">      let placeArr = this.attendance.placeList;</span></span><br><span class="line"><span class="xml">      placeArr.map((p) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        p.latitude = p.dimension;</span></span><br><span class="line"><span class="xml">        // 计算当前位置经纬度  和所在考勤组的地址经纬度 直线距离 <span class="tag">&lt;<span class="name">=设置的距离</span></span></span></span><br><span class="line"><span class="xml">        let num = this.getMapDistance(</span></span><br><span class="line"><span class="xml">          p.latitude,</span></span><br><span class="line"><span class="xml">          p.longitude,</span></span><br><span class="line"><span class="xml">          this.latAndLon.latitude,</span></span><br><span class="line"><span class="xml">          this.latAndLon.longitude,</span></span><br><span class="line"><span class="xml">        );</span></span><br><span class="line"><span class="xml">        p.distance = new Big(num).times(1000).toString(); // 距离，单位米</span></span><br><span class="line"><span class="xml">        p.atPlace = p.distance <span class="tag">&lt;<span class="name">=</span> <span class="attr">p.range</span>; // 是否在打卡范围</span></span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">      // 取最近的打卡地址</span></span><br><span class="line"><span class="xml">      let data = placeArr.filter((item) =&gt; item.atPlace);</span></span><br><span class="line"><span class="xml">      if (data &amp;&amp; data.length) &#123;</span></span><br><span class="line"><span class="xml">        this.check_placeName = data[0].placeName; // 获取打卡地址名</span></span><br><span class="line"><span class="xml">        // 正常打卡，计算上下班</span></span><br><span class="line"><span class="xml">        // todo</span></span><br><span class="line"><span class="xml">        setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">          this.show = true;</span></span><br><span class="line"><span class="xml">        &#125;, 600);</span></span><br><span class="line"><span class="xml">      &#125; else &#123;</span></span><br><span class="line"><span class="xml">        this.showOutdoor = true; // 外勤打卡</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    //拿到打卡时间，判断打卡类型</span></span><br><span class="line"><span class="xml">    // 把一天分为多个打卡时间段</span></span><br><span class="line"><span class="xml">    // 判断是否处在这个时间段里</span></span><br><span class="line"><span class="xml">    handleCheckType() &#123;</span></span><br><span class="line"><span class="xml">      if (this.workRules) &#123;</span></span><br><span class="line"><span class="xml">        let time = this.workRules.shift.shiftTimeList;</span></span><br><span class="line"><span class="xml">        let arr = [];</span></span><br><span class="line"><span class="xml">        time.map((t) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          arr.push(&#123;</span></span><br><span class="line"><span class="xml">            startTime: t.workTime,</span></span><br><span class="line"><span class="xml">            endtTime: t.knockOffTime,</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">        // 只有一条考勤规则</span></span><br><span class="line"><span class="xml">        if (time.length == 1) &#123;</span></span><br><span class="line"><span class="xml">          let unselect = this.unselectTime(arr);</span></span><br><span class="line"><span class="xml">          let before = checkAuditTime(</span></span><br><span class="line"><span class="xml">            unselect[0].startTime,</span></span><br><span class="line"><span class="xml">            unselect[0].endtTime,</span></span><br><span class="line"><span class="xml">          );</span></span><br><span class="line"><span class="xml">          let during = checkAuditTime(arr[0].startTime, arr[0].endtTime);</span></span><br><span class="line"><span class="xml">          let after = checkAuditTime(unselect[1].endtTime, '24:00');</span></span><br><span class="line"><span class="xml">          // 正常上班</span></span><br><span class="line"><span class="xml">          if (before) &#123;</span></span><br><span class="line"><span class="xml">            this.handleCheckStatus(0);</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          // 正常下班</span></span><br><span class="line"><span class="xml">          if (after) &#123;</span></span><br><span class="line"><span class="xml">            this.handleCheckStatus('offduty');</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          // 考勤时间内</span></span><br><span class="line"><span class="xml">          if (during) &#123;</span></span><br><span class="line"><span class="xml">            // 有打卡记录，属于早退，否则迟到</span></span><br><span class="line"><span class="xml">            if (this.history.length) &#123;</span></span><br><span class="line"><span class="xml">              this.handleCheckStatus(4);</span></span><br><span class="line"><span class="xml">            &#125; else &#123;</span></span><br><span class="line"><span class="xml">              this.handleCheckStatus(1);</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        // 多条考勤规则</span></span><br><span class="line"><span class="xml">        if (time.length &gt; 1) &#123;</span></span><br><span class="line"><span class="xml">          let inside_arr = this.inside_arr; // 考勤时间内</span></span><br><span class="line"><span class="xml">          let during_arr = this.during_arr; // 休息时间</span></span><br><span class="line"><span class="xml">          let outside_work = this.outside_work; // 考勤时间外,上班</span></span><br><span class="line"><span class="xml">          let outside_off = this.outside_off; // 考勤时间外,下班</span></span><br><span class="line"><span class="xml">          // 开始判断考勤时间段</span></span><br><span class="line"><span class="xml">          if (</span></span><br><span class="line"><span class="xml">            this.checkAuditSeocnd(outside_work.workTime, outside_work.knockOffTime)</span></span><br><span class="line"><span class="xml">          ) &#123;</span></span><br><span class="line"><span class="xml">            this.handleCheckStatus(0); // 正常上班</span></span><br><span class="line"><span class="xml">            return;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          if (this.checkAuditSeocnd(outside_off.workTime, outside_off.knockOffTime)) &#123;</span></span><br><span class="line"><span class="xml">            this.handleCheckStatus('offduty'); // 正常下班</span></span><br><span class="line"><span class="xml">            return;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          // 在正常的考勤时间段内</span></span><br><span class="line"><span class="xml">          for (var i = 0; i <span class="tag">&lt; <span class="attr">inside_arr.length</span>; <span class="attr">i</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">            let s = inside_arr[i];</span></span><br><span class="line"><span class="xml">            if (this.checkAuditSeocnd(s.workTime, s.knockOffTime)) &#123;</span></span><br><span class="line"><span class="xml">              if (this.history.length) &#123;</span></span><br><span class="line"><span class="xml">                this.handleCheckStatus(4); // 早退</span></span><br><span class="line"><span class="xml">              &#125; else &#123;</span></span><br><span class="line"><span class="xml">                this.handleCheckStatus(1); // 迟到</span></span><br><span class="line"><span class="xml">              &#125;</span></span><br><span class="line"><span class="xml">              return;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          // 在午休范围内</span></span><br><span class="line"><span class="xml">          for (var j = 0; j <span class="tag">&lt; <span class="attr">during_arr.length</span>; <span class="attr">j</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">            let d = during_arr[j];</span></span><br><span class="line"><span class="xml">            let lastest = ''; // 最新打卡记录的打卡时间</span></span><br><span class="line"><span class="xml">            let lastest_type = ''; // 最新打卡记录的打卡类型</span></span><br><span class="line"><span class="xml">            if (this.history &amp;&amp; this.history.length) &#123;</span></span><br><span class="line"><span class="xml">              lastest = this.history[this.history.length - 1].createTime;</span></span><br><span class="line"><span class="xml">              lastest_type = this.history[this.history.length - 1].type;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">            if (this.checkAuditSeocnd(d.workTime, d.knockOffTime)) &#123;</span></span><br><span class="line"><span class="xml">              let today = dayjs(new Date()).format('YYYY/MM/DD');</span></span><br><span class="line"><span class="xml">              let w = today + ' ' + d.workTime;</span></span><br><span class="line"><span class="xml">              let k = today + ' ' + d.knockOffTime;</span></span><br><span class="line"><span class="xml">              if (lastest) &#123;</span></span><br><span class="line"><span class="xml">                // 今天打过卡</span></span><br><span class="line"><span class="xml">                console.log(</span></span><br><span class="line"><span class="xml">                  '在午休范围内,最新打卡记录:' + lastest,</span></span><br><span class="line"><span class="xml">                  '午休时间:' + w + '至' + k,</span></span><br><span class="line"><span class="xml">                );</span></span><br><span class="line"><span class="xml">                let history = dayjs(lastest).format('YYYY/MM/DD HH:mm:ss'); // 最新一条打卡记录</span></span><br><span class="line"><span class="xml">                if (isDuringDate(w, k, history)) &#123;</span></span><br><span class="line"><span class="xml">                  // 在午休时间段内，则本次展示上班</span></span><br><span class="line"><span class="xml">                  this.handleCheckStatus(0); // 上班</span></span><br><span class="line"><span class="xml">                &#125; else if (lastest_type == 4) &#123;</span></span><br><span class="line"><span class="xml">                  // 不在午休时间段内，最新的打卡记录是早退，则本次展示上班</span></span><br><span class="line"><span class="xml">                  this.handleCheckStatus(0); // 上班</span></span><br><span class="line"><span class="xml">                &#125; else &#123;</span></span><br><span class="line"><span class="xml">                  // 不在午休时间段内，则本次展示下班</span></span><br><span class="line"><span class="xml">                  this.handleCheckStatus('offduty'); // 下班</span></span><br><span class="line"><span class="xml">                &#125;</span></span><br><span class="line"><span class="xml">                return;</span></span><br><span class="line"><span class="xml">              &#125; else &#123;</span></span><br><span class="line"><span class="xml">                // 今天没有打过卡</span></span><br><span class="line"><span class="xml">                this.handleCheckStatus('offduty'); // 下班</span></span><br><span class="line"><span class="xml">                return;</span></span><br><span class="line"><span class="xml">              &#125;</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          this.handleCheckStatus('');</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 当前时间处于什么打卡类型</span></span><br><span class="line"><span class="xml">    calType(format_time) &#123;</span></span><br><span class="line"><span class="xml">      let lastest = ''; // 最新的一条打卡时间</span></span><br><span class="line"><span class="xml">      if (this.history &amp;&amp; this.history.length) &#123;</span></span><br><span class="line"><span class="xml">        lastest = this.history[this.history.length - 1].createTime;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      let today = dayjs(new Date()).format('YYYY/MM/DD'); // 当天</span></span><br><span class="line"><span class="xml">      let inside_arr = []; // 考勤时间内</span></span><br><span class="line"><span class="xml">      let during_arr = []; // 休息时间</span></span><br><span class="line"><span class="xml">      let outside_work = &#123;&#125;; // 考勤时间外,上班</span></span><br><span class="line"><span class="xml">      let outside_off = &#123;&#125;; // 考勤时间外,下班</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      // 考勤时间段数组排序</span></span><br><span class="line"><span class="xml">      format_time.map((d) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        d.sort_workTime = today + ' ' + d.workTime;</span></span><br><span class="line"><span class="xml">        d.sort_knockOffTime = today + ' ' + d.knockOffTime;</span></span><br><span class="line"><span class="xml">        // 解决iOS无法识别 yyyy-mm-dd格式的时间转换为时间戳在苹果手机上为NaN</span></span><br><span class="line"><span class="xml">        d.new_date_workTime = new Date(</span></span><br><span class="line"><span class="xml">          d.sort_workTime.replace(/-/g, '/'),</span></span><br><span class="line"><span class="xml">        ).getTime();</span></span><br><span class="line"><span class="xml">        d.new_date_knockOffTime = new Date(</span></span><br><span class="line"><span class="xml">          d.sort_knockOffTime.replace(/-/g, '/'),</span></span><br><span class="line"><span class="xml">        ).getTime();</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">      format_time.sort((a, b) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        return (</span></span><br><span class="line"><span class="xml">          new Date(a.sort_workTime).getTime() -</span></span><br><span class="line"><span class="xml">          new Date(b.sort_workTime).getTime()</span></span><br><span class="line"><span class="xml">        );</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">      format_time.map((t, index) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        inside_arr.push(&#123;</span></span><br><span class="line"><span class="xml">          workTime: t.workTime + ':01',</span></span><br><span class="line"><span class="xml">          knockOffTime: dayjs(t.new_date_knockOffTime - 60000).format('HH:mm') + ':59', // - 1分钟</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">        if (format_time[index + 1] &amp;&amp; format_time[index + 1].sort_workTime) &#123;</span></span><br><span class="line"><span class="xml">          during_arr.push(&#123;</span></span><br><span class="line"><span class="xml">            workTime: t.knockOffTime + ':00',</span></span><br><span class="line"><span class="xml">            knockOffTime: format_time[index + 1].workTime + ':00',</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        // 考勤时间前</span></span><br><span class="line"><span class="xml">        if (index == 0) &#123;</span></span><br><span class="line"><span class="xml">          outside_work = &#123;</span></span><br><span class="line"><span class="xml">            workTime: '00:00:00',</span></span><br><span class="line"><span class="xml">            knockOffTime: t.workTime + ':00',</span></span><br><span class="line"><span class="xml">          &#125;;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        // 考勤时间后</span></span><br><span class="line"><span class="xml">        if (index == format_time.length - 1) &#123;</span></span><br><span class="line"><span class="xml">          outside_off = &#123;</span></span><br><span class="line"><span class="xml">            workTime: t.knockOffTime + ':00',</span></span><br><span class="line"><span class="xml">            knockOffTime: '23:59:59',</span></span><br><span class="line"><span class="xml">          &#125;;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">      this.inside_arr = inside_arr; // 考勤时间内</span></span><br><span class="line"><span class="xml">      this.during_arr = during_arr; // 休息时间</span></span><br><span class="line"><span class="xml">      this.outside_work = outside_work; // 考勤时间外,上班</span></span><br><span class="line"><span class="xml">      this.outside_off = outside_off; // 考勤时间外,下班</span></span><br><span class="line"><span class="xml">      console.log('考勤时间段数组：', format_time);</span></span><br><span class="line"><span class="xml">      console.log('考勤时间外,上班:', outside_work);</span></span><br><span class="line"><span class="xml">      console.log('考勤时间外,下班:', outside_off);</span></span><br><span class="line"><span class="xml">      console.log('考勤时间内:', inside_arr);</span></span><br><span class="line"><span class="xml">      console.log('休息时间:', during_arr);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 打卡弹窗</span></span><br><span class="line"><span class="xml">    //0 正常打卡 1 迟到打卡 2外勤打卡 3缺卡打卡 4 早退打卡 5没加入打卡 6请假 7 出差 8加班 10 旷工</span></span><br><span class="line"><span class="xml">    // 5表示为加入 比如今天加入如考勤  昨天的记录就是5</span></span><br><span class="line"><span class="xml">    handleCheckStatus(type) &#123;</span></span><br><span class="line"><span class="xml">      console.log('打卡类型:', type);</span></span><br><span class="line"><span class="xml">      let type_name = '';</span></span><br><span class="line"><span class="xml">      let show_error = false;</span></span><br><span class="line"><span class="xml">      switch (type) &#123;</span></span><br><span class="line"><span class="xml">        case 0:</span></span><br><span class="line"><span class="xml">          type_name = '上班·打卡正常';</span></span><br><span class="line"><span class="xml">          break;</span></span><br><span class="line"><span class="xml">        case 'offduty':</span></span><br><span class="line"><span class="xml">          type_name = '下班·打卡正常';</span></span><br><span class="line"><span class="xml">          break;</span></span><br><span class="line"><span class="xml">        case 1:</span></span><br><span class="line"><span class="xml">          type_name = '上班·你迟到了';</span></span><br><span class="line"><span class="xml">          show_error = true;</span></span><br><span class="line"><span class="xml">          break;</span></span><br><span class="line"><span class="xml">        case 4:</span></span><br><span class="line"><span class="xml">          type_name = '下班·你早退了';</span></span><br><span class="line"><span class="xml">          show_error = true;</span></span><br><span class="line"><span class="xml">          break;</span></span><br><span class="line"><span class="xml">        default:</span></span><br><span class="line"><span class="xml">          type_name = '';</span></span><br><span class="line"><span class="xml">          break;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      this.check = &#123;</span></span><br><span class="line"><span class="xml">        placeName: this.check_placeName ? this.check_placeName : this.placeName, // 非外勤打卡，展示的打卡地址取考勤组保存的地址</span></span><br><span class="line"><span class="xml">        latitude: this.latAndLon.latitude,</span></span><br><span class="line"><span class="xml">        longitude: this.latAndLon.longitude,</span></span><br><span class="line"><span class="xml">        dimension: this.latAndLon.latitude,</span></span><br><span class="line"><span class="xml">        type, // 1迟到4早退</span></span><br><span class="line"><span class="xml">        type_name,</span></span><br><span class="line"><span class="xml">        show_error,</span></span><br><span class="line"><span class="xml">      &#125;;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 确认打卡</span></span><br><span class="line"><span class="xml">    submit() &#123;</span></span><br><span class="line"><span class="xml">      this.show = false;</span></span><br><span class="line"><span class="xml">      let params = &#123;</span></span><br><span class="line"><span class="xml">        enterpriseId: app.globalData.enterpriseId,</span></span><br><span class="line"><span class="xml">        userId: app.globalData.userId,</span></span><br><span class="line"><span class="xml">        employeeNo: app.globalData.employeeNo,</span></span><br><span class="line"><span class="xml">        ...this.check,</span></span><br><span class="line"><span class="xml">      &#125;;</span></span><br><span class="line"><span class="xml">      delete params.type;</span></span><br><span class="line"><span class="xml">      console.log(params, '打卡postdata');</span></span><br><span class="line"><span class="xml">      attendanceApi</span></span><br><span class="line"><span class="xml">        .saveAttendanceData(params)</span></span><br><span class="line"><span class="xml">        .then((res) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          if (res.extra &amp;&amp; res.extra.extraCode) &#123;</span></span><br><span class="line"><span class="xml">            // 销毁定时器</span></span><br><span class="line"><span class="xml">            clearInterval(this.intervalTimer);</span></span><br><span class="line"><span class="xml">            app.globalData.scrollLock = false;</span></span><br><span class="line"><span class="xml">            // 打卡有冲突</span></span><br><span class="line"><span class="xml">            this.conflict = &#123;</span></span><br><span class="line"><span class="xml">              ...res.data,</span></span><br><span class="line"><span class="xml">              extraCode: res.extra.extraCode,</span></span><br><span class="line"><span class="xml">            &#125;;</span></span><br><span class="line"><span class="xml">            this.showConflict = true;</span></span><br><span class="line"><span class="xml">          &#125; else &#123;</span></span><br><span class="line"><span class="xml">            // 如果今天没有打过卡</span></span><br><span class="line"><span class="xml">            if (!this.history || !this.history.length) &#123;</span></span><br><span class="line"><span class="xml">              this.getClockType()</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">            this.success = res.data;</span></span><br><span class="line"><span class="xml">            this.showSuccess = true;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .catch((errors) =&gt; &#123;</span></span><br><span class="line"><span class="xml">          uni.$u.toast(errors.msg || '打卡出错，请稍后再试');</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .finally(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">          uni.hideLoading();</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 储存用户行动轨迹</span></span><br><span class="line"><span class="xml">    getClockType() &#123;</span></span><br><span class="line"><span class="xml">      let ln = this.$storage._getStorage('latAndLon')</span></span><br><span class="line"><span class="xml">      let params = &#123;</span></span><br><span class="line"><span class="xml">        enterpriseId: app.globalData.enterpriseId,</span></span><br><span class="line"><span class="xml">        userId: app.globalData.userId,</span></span><br><span class="line"><span class="xml">        employeeNo: app.globalData.employeeNo,</span></span><br><span class="line"><span class="xml">        longitude: ln.longitude,</span></span><br><span class="line"><span class="xml">        dimension: ln.latitude,</span></span><br><span class="line"><span class="xml">        placeName: this.$storage._getStorage('placeName'),</span></span><br><span class="line"><span class="xml">        hideLoadingTitle: true // 隐藏请求动画</span></span><br><span class="line"><span class="xml">      &#125;;</span></span><br><span class="line"><span class="xml">      attendanceApi.attendanceGetClockType(params).then((res) =&gt; &#123; &#125;)</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 外勤打卡成功后,展示打卡成功弹窗</span></span><br><span class="line"><span class="xml">    outdoorCheck(params) &#123;</span></span><br><span class="line"><span class="xml">      this.showOutdoor = false;</span></span><br><span class="line"><span class="xml">      console.log(params, '外勤打卡postdata');</span></span><br><span class="line"><span class="xml">      attendanceApi.saveAttendanceData(params).then((res) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        if (res.extra &amp;&amp; res.extra.extraCode) &#123;</span></span><br><span class="line"><span class="xml">          // 销毁定时器</span></span><br><span class="line"><span class="xml">          clearInterval(this.intervalTimer);</span></span><br><span class="line"><span class="xml">          app.globalData.scrollLock = false;</span></span><br><span class="line"><span class="xml">          // 打卡有冲突</span></span><br><span class="line"><span class="xml">          this.conflict = &#123;</span></span><br><span class="line"><span class="xml">            ...res.data,</span></span><br><span class="line"><span class="xml">            extraCode: res.extra.extraCode,</span></span><br><span class="line"><span class="xml">          &#125;;</span></span><br><span class="line"><span class="xml">          this.showConflict = true;</span></span><br><span class="line"><span class="xml">        &#125; else &#123;</span></span><br><span class="line"><span class="xml">          // 如果今天没有打过卡</span></span><br><span class="line"><span class="xml">          if (!this.history || !this.history.length) &#123;</span></span><br><span class="line"><span class="xml">            this.getClockType()</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          this.success = res.data;</span></span><br><span class="line"><span class="xml">          this.showSuccess = true;</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 关闭打卡成功的弹窗</span></span><br><span class="line"><span class="xml">    closeSuccess() &#123;</span></span><br><span class="line"><span class="xml">      this.$emit('after'); // 打卡成功后的回调</span></span><br><span class="line"><span class="xml">      this.showSuccess = false;</span></span><br><span class="line"><span class="xml">      this.innerVisible = false;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    // 加入考勤组</span></span><br><span class="line"><span class="xml">    addGroup(query) &#123;</span></span><br><span class="line"><span class="xml">      let url = '/pages_tools/manage/index';</span></span><br><span class="line"><span class="xml">      if (query) &#123;</span></span><br><span class="line"><span class="xml">        url = url + '?from=' + query;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      uni.redirectTo(&#123;</span></span><br><span class="line"><span class="xml">        url,</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 取消打卡</span></span><br><span class="line"><span class="xml">    cancel() &#123;</span></span><br><span class="line"><span class="xml">      this.show = false;</span></span><br><span class="line"><span class="xml">      this.innerVisible = false;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    // 取消跳转新增考勤组</span></span><br><span class="line"><span class="xml">    cancelAddGroup() &#123;</span></span><br><span class="line"><span class="xml">      this.showManage = false;</span></span><br><span class="line"><span class="xml">      this.showGroup = false;</span></span><br><span class="line"><span class="xml">      this.innerVisible = false;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    closeOutdoor() &#123;</span></span><br><span class="line"><span class="xml">      this.showOutdoor = false;</span></span><br><span class="line"><span class="xml">      this.innerVisible = false;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    closePopup() &#123;</span></span><br><span class="line"><span class="xml">      this.innerVisible = false;</span></span><br><span class="line"><span class="xml">      app.globalData.scrollLock = false;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 有冲突，取消打卡</span></span><br><span class="line"><span class="xml">    closeConflict() &#123;</span></span><br><span class="line"><span class="xml">      this.showConflict = false;</span></span><br><span class="line"><span class="xml">      this.innerVisible = false;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 确认作废有冲突的记录</span></span><br><span class="line"><span class="xml">    cancelSubmit() &#123;</span></span><br><span class="line"><span class="xml">      this.showConflict = false;</span></span><br><span class="line"><span class="xml">      this.submit(); // 继续打卡</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    //经纬度转换成三角函数中度分表形式</span></span><br><span class="line"><span class="xml">    Rad(d) &#123;</span></span><br><span class="line"><span class="xml">      return (d * Math.PI) / 180.0;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    // 计算两点之间的距离</span></span><br><span class="line"><span class="xml">    getMapDistance(lat1, lng1, lat2, lng2) &#123;</span></span><br><span class="line"><span class="xml">      var radLat1 = this.Rad(lat1);</span></span><br><span class="line"><span class="xml">      var radLat2 = this.Rad(lat2);</span></span><br><span class="line"><span class="xml">      var a = radLat1 - radLat2;</span></span><br><span class="line"><span class="xml">      var b = this.Rad(lng1) - this.Rad(lng2);</span></span><br><span class="line"><span class="xml">      var s =</span></span><br><span class="line"><span class="xml">        2 *</span></span><br><span class="line"><span class="xml">        Math.asin(</span></span><br><span class="line"><span class="xml">          Math.sqrt(</span></span><br><span class="line"><span class="xml">            Math.pow(Math.sin(a / 2), 2) +</span></span><br><span class="line"><span class="xml">            Math.cos(radLat1) *</span></span><br><span class="line"><span class="xml">            Math.cos(radLat2) *</span></span><br><span class="line"><span class="xml">            Math.pow(Math.sin(b / 2), 2),</span></span><br><span class="line"><span class="xml">          ),</span></span><br><span class="line"><span class="xml">        );</span></span><br><span class="line"><span class="xml">      s = s * 6378.137; // EARTH_RADIUS;</span></span><br><span class="line"><span class="xml">      s = Math.round(s * 10000) / 10000; // 输出为公里</span></span><br><span class="line"><span class="xml">      return s;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    //入参 格式 unselectTime=[&#123; startTime:"1:00", endtTime:'3:00'&#125;]</span></span><br><span class="line"><span class="xml">    //返回数据 [&#123; startTime:"00:00", endtTime:'1:00'&#125;，&#123; startTime:"3:00", endtTime:'00:00'&#125;]</span></span><br><span class="line"><span class="xml">    //转化成分钟</span></span><br><span class="line"><span class="xml">    toMinites(time) &#123;</span></span><br><span class="line"><span class="xml">      let mins = null;</span></span><br><span class="line"><span class="xml">      let times = time.split(':');</span></span><br><span class="line"><span class="xml">      mins = parseInt(times[0]) * 60 + parseInt(times[1]);</span></span><br><span class="line"><span class="xml">      return mins;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    toHHmmFormat(minutes) &#123;</span></span><br><span class="line"><span class="xml">      let h = null;</span></span><br><span class="line"><span class="xml">      let m = null;</span></span><br><span class="line"><span class="xml">      if (minutes) &#123;</span></span><br><span class="line"><span class="xml">        h = ('0' + parseInt(minutes / 60)).slice(-2);</span></span><br><span class="line"><span class="xml">        m = ('0' + (minutes % 60)).slice(-2);</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      return [h, m].join(':');</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    formateTime(selectedTime) &#123;</span></span><br><span class="line"><span class="xml">      let newSelectTime = [...selectedTime];</span></span><br><span class="line"><span class="xml">      selectedTime.forEach((item, index) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        if (</span></span><br><span class="line"><span class="xml">          this.toMinites(item.startTime) &gt; this.toMinites(item.endtTime) &amp;&amp;</span></span><br><span class="line"><span class="xml">          this.toMinites(item.endtTime) != 0</span></span><br><span class="line"><span class="xml">        ) &#123;</span></span><br><span class="line"><span class="xml">          newSelectTime.splice(index, 1);</span></span><br><span class="line"><span class="xml">          newSelectTime.push(&#123;</span></span><br><span class="line"><span class="xml">            startTime: item.startTime,</span></span><br><span class="line"><span class="xml">            endtTime: '00:00',</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">          newSelectTime.push(&#123;</span></span><br><span class="line"><span class="xml">            startTime: '00:00',</span></span><br><span class="line"><span class="xml">            endtTime: item.endtTime,</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">      console.log(newSelectTime, 'newSelectTime');</span></span><br><span class="line"><span class="xml">      return newSelectTime;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    unselectTime(selectedTime) &#123;</span></span><br><span class="line"><span class="xml">      let arr = [...selectedTime];</span></span><br><span class="line"><span class="xml">      let newSelectTime = this.formateTime(arr);</span></span><br><span class="line"><span class="xml">      let timeArr = [];</span></span><br><span class="line"><span class="xml">      let unselectTime = [];</span></span><br><span class="line"><span class="xml">      if (newSelectTime &amp;&amp; newSelectTime.length) &#123;</span></span><br><span class="line"><span class="xml">        for (let i = 0; i <span class="tag">&lt; <span class="attr">newSelectTime.length</span>; <span class="attr">i</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">          if (</span></span><br><span class="line"><span class="xml">            this.toMinites(newSelectTime[i].startTime) ==</span></span><br><span class="line"><span class="xml">            this.toMinites(newSelectTime[i].endtTime)</span></span><br><span class="line"><span class="xml">          ) &#123;</span></span><br><span class="line"><span class="xml">            return unselectTime;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          timeArr.push([</span></span><br><span class="line"><span class="xml">            this.toMinites(newSelectTime[i].startTime),</span></span><br><span class="line"><span class="xml">            this.toMinites(newSelectTime[i].endtTime),</span></span><br><span class="line"><span class="xml">          ]);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      timeArr.sort((a, b) =&gt; &#123;</span></span><br><span class="line"><span class="xml">        return a[0] - b[0];</span></span><br><span class="line"><span class="xml">      &#125;);</span></span><br><span class="line"><span class="xml">      if (timeArr.length) &#123;</span></span><br><span class="line"><span class="xml">        if (timeArr[0][0] !== 0) &#123;</span></span><br><span class="line"><span class="xml">          unselectTime.unshift(&#123;</span></span><br><span class="line"><span class="xml">            startTime: '00:00',</span></span><br><span class="line"><span class="xml">            endtTime: this.toHHmmFormat(timeArr[0][0]),</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        for (let i = 0; i <span class="tag">&lt; <span class="attr">timeArr.length</span>; <span class="attr">i</span>++) &#123;</span></span></span><br><span class="line"><span class="xml">          if (i + 1 &gt; timeArr.length - 1) &#123;</span></span><br><span class="line"><span class="xml">            continue;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          if (timeArr[i][1] == timeArr[i + 1][0]) &#123;</span></span><br><span class="line"><span class="xml">            continue;</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">          unselectTime.push(&#123;</span></span><br><span class="line"><span class="xml">            startTime: this.formateTime(timeArr[i][1]),</span></span><br><span class="line"><span class="xml">            endtTime: this.toHHmmFormat(timeArr[i + 1][0]),</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        if (timeArr[timeArr.length - 1][1] !== 0) &#123;</span></span><br><span class="line"><span class="xml">          unselectTime.push(&#123;</span></span><br><span class="line"><span class="xml">            endtTime: this.toHHmmFormat(timeArr[timeArr.length - 1][1]),</span></span><br><span class="line"><span class="xml">            startTime: '00:00',</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">        if (</span></span><br><span class="line"><span class="xml">          unselectTime.length &amp;&amp;</span></span><br><span class="line"><span class="xml">          unselectTime[0].startTime == '00:00' &amp;&amp;</span></span><br><span class="line"><span class="xml">          unselectTime[unselectTime.length - 1].endtTime == '00:00'</span></span><br><span class="line"><span class="xml">        ) &#123;</span></span><br><span class="line"><span class="xml">          let startTime = unselectTime[unselectTime.length - 1].startTime;</span></span><br><span class="line"><span class="xml">          let endtTime = unselectTime[0].endtTime;</span></span><br><span class="line"><span class="xml">          unselectTime.splice(0, 1);</span></span><br><span class="line"><span class="xml">          unselectTime.splice(unselectTime.length - 1, 1);</span></span><br><span class="line"><span class="xml">          unselectTime.push(&#123;</span></span><br><span class="line"><span class="xml">            startTime,</span></span><br><span class="line"><span class="xml">            endtTime,</span></span><br><span class="line"><span class="xml">          &#125;);</span></span><br><span class="line"><span class="xml">        &#125;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      return unselectTime;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    /**</span></span><br><span class="line"><span class="xml">     * [checkAuditSeocnd 比较当前时间是否在指定时间段内,精确到毫秒]</span></span><br><span class="line"><span class="xml">     * @author dongsir</span></span><br><span class="line"><span class="xml">     * @DateTime 2022-11-23</span></span><br><span class="line"><span class="xml">     * @version 1.0</span></span><br><span class="line"><span class="xml">     * @param  date  [beginDateStr] [开始时间] HH:mm:ss</span></span><br><span class="line"><span class="xml">     * @param  date  [endDateStr]  [结束时间] HH:mm:ss</span></span><br><span class="line"><span class="xml">     * @return  Boolean</span></span><br><span class="line"><span class="xml">     */</span></span><br><span class="line"><span class="xml">    checkAuditSeocnd(beginTime, endTime) &#123;</span></span><br><span class="line"><span class="xml">      let today = dayjs(new Date()).format('YYYY/MM/DD');</span></span><br><span class="line"><span class="xml">      beginTime = today + ' ' + beginTime;</span></span><br><span class="line"><span class="xml">      endTime = today + ' ' + endTime;</span></span><br><span class="line"><span class="xml">      // default milliseconds</span></span><br><span class="line"><span class="xml">      if (dayjs().isBetween(beginTime, endTime)) &#123;</span></span><br><span class="line"><span class="xml">        return true;</span></span><br><span class="line"><span class="xml">      &#125; else &#123;</span></span><br><span class="line"><span class="xml">        return false;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  beforeDestroy() &#123;</span></span><br><span class="line"><span class="xml">    // 销毁定时器</span></span><br><span class="line"><span class="xml">    clearInterval(this.intervalTimer);</span></span><br><span class="line"><span class="xml">    app.globalData.scrollLock = false;</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">"scss"</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="xml">.check-container &#123;</span></span><br><span class="line"><span class="xml">  text-align: center;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">  .check-box &#123;</span></span><br><span class="line"><span class="xml">    border-bottom: 1px solid rgba(187, 187, 187, 0.6);</span></span><br><span class="line"><span class="xml">    margin: 0 3rem;</span></span><br><span class="line"><span class="xml">    padding: 1.13rem 2rem;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    .icon &#123;</span></span><br><span class="line"><span class="xml">      width: 3.5rem;</span></span><br><span class="line"><span class="xml">      height: 3.5rem;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    .info &#123;</span></span><br><span class="line"><span class="xml">      padding: 0.44rem 0;</span></span><br><span class="line"><span class="xml">      font-size: 1.25rem;</span></span><br><span class="line"><span class="xml">      font-weight: bold;</span></span><br><span class="line"><span class="xml">      color: #262626;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">      &amp;.error &#123;</span></span><br><span class="line"><span class="xml">        color: #e74b47;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    .address &#123;</span></span><br><span class="line"><span class="xml">      width: 320rpx;</span></span><br><span class="line"><span class="xml">      font-size: 0.75rem;</span></span><br><span class="line"><span class="xml">      color: #999999;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">  .time &#123;</span></span><br><span class="line"><span class="xml">    padding: 1.3rem 0;</span></span><br><span class="line"><span class="xml">    font-size: 1.06rem;</span></span><br><span class="line"><span class="xml">    font-weight: bold;</span></span><br><span class="line"><span class="xml">    color: #262626;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">  .btn &#123;</span></span><br><span class="line"><span class="xml">    height: 4rem;</span></span><br><span class="line"><span class="xml">    background: #4c8afc;</span></span><br><span class="line"><span class="xml">    font-size: 1.06rem;</span></span><br><span class="line"><span class="xml">    font-weight: bold;</span></span><br><span class="line"><span class="xml">    color: #ffffff;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    &amp;.submit-btn &#123;</span></span><br><span class="line"><span class="xml">      letter-spacing: 3px;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    &amp;.cancel &#123;</span></span><br><span class="line"><span class="xml">      background: #fff;</span></span><br><span class="line"><span class="xml">      color: #999;</span></span><br><span class="line"><span class="xml">      border-bottom-left-radius: 10px;</span></span><br><span class="line"><span class="xml">      border-bottom-right-radius: 10px;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/VUE/">VUE</a>
		  
			<a href="/tags/uniapp开发/">uniapp开发</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2023/02/28/新官网踩坑笔记/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">新官网踩坑笔记</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2022/12/19/uni-微信小程序-安卓图片空白bug/">
        <span class="next-text nav-default">uni+微信小程序 安卓图片空白bug</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2016 -
    
    2023
    <span class="footer-author">胆固醇</span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.5"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.5"></script>

  </body>
</html>
