[{"title":"ElementUI table 编辑拓展","url":"/2019/02/27/ElementUI-table-%E7%BC%96%E8%BE%91%E6%8B%93%E5%B1%95/","content":"<p>被调到新的项目组，开始财务模块开发，涉及到大量报表和数字。最近的需求涉及到element table，各种详细的要求，要求拓展目前现有的table内容，期间也遇到了很多问题，现在记录下来。</p>\n<h4 id=\"目录\"><a href=\"#目录\" class=\"headerlink\" title=\"目录\"></a>目录</h4><ul>\n<li><a href=\"#1\">允许点击table任意一栏编辑</a></li>\n<li><a href=\"#2\">表头合并和样式自定义</a></li>\n<li><a href=\"#2\">允许上传附件</a></li>\n<li><a href=\"#3\">树状table，允许展开折叠操作</a></li>\n<li><a href=\"#4\">根据选择器选择的内容动态新增可编辑的字段</a></li>\n<li><a href=\"#5\">界面编辑操作，输入数据，光标丢失，感觉很卡</a></li>\n</ul>\n<p><span id=\"1\"></span></p>\n<h4 id=\"表格编辑\"><a href=\"#表格编辑\" class=\"headerlink\" title=\"表格编辑\"></a>表格编辑</h4><p><img src=\"http://vky-test-oss.inboyu.com/upload/39f566df-2aaf-e3bd-af76-5404d52a7750.gif\" alt=\"image\"></p>\n<figure class=\"highlight htmlbars\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">html</span> &gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"ie=edge\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://unpkg.com/element-ui/lib/theme-chalk/index.css\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        .el-table-add-row &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    margin-top: 10px;</span></span><br><span class=\"line\"><span class=\"xml\">    width: 100%;</span></span><br><span class=\"line\"><span class=\"xml\">    height: 34px;</span></span><br><span class=\"line\"><span class=\"xml\">    border: 1px dashed #c1c1cd;</span></span><br><span class=\"line\"><span class=\"xml\">    border-radius: 3px;</span></span><br><span class=\"line\"><span class=\"xml\">    cursor: pointer;</span></span><br><span class=\"line\"><span class=\"xml\">    justify-content: center;</span></span><br><span class=\"line\"><span class=\"xml\">    display: flex;</span></span><br><span class=\"line\"><span class=\"xml\">    line-height: 34px;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;<span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"app\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">el-row</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">el-col</span> <span class=\"attr\">span</span>=<span class=\"string\">\"24\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                <span class=\"tag\">&lt;<span class=\"name\">el-table</span> <span class=\"attr\">size</span>=<span class=\"string\">\"mini\"</span> <span class=\"attr\">:data</span>=<span class=\"string\">\"master_user.data\"</span> <span class=\"attr\">border</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 100%\"</span> <span class=\"attr\">highlight-current-row</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">type</span>=<span class=\"string\">\"index\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">v-for</span>=<span class=\"string\">\"(v,i) in master_user.columns\"</span> <span class=\"attr\">:prop</span>=<span class=\"string\">\"v.field\"</span> <span class=\"attr\">:label</span>=<span class=\"string\">\"v.title\"</span> <span class=\"attr\">:width</span>=<span class=\"string\">\"v.width\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"scope.row.isSet\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                                <span class=\"tag\">&lt;<span class=\"name\">el-input</span> <span class=\"attr\">size</span>=<span class=\"string\">\"mini\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"请输入内容\"</span> <span class=\"attr\">v-model</span>=<span class=\"string\">\"master_user.sel[v.field]\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                                <span class=\"tag\">&lt;/<span class=\"name\">el-input</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-else</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;scope.row[v.field]&#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                    <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                    <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">label</span>=<span class=\"string\">\"操作\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-tag el-tag--info el-tag--mini\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"cursor: pointer;\"</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"pwdChange(scope.row,scope.$index,true)\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                                </span><span class=\"template-variable\">&#123;&#123;scope.row.isSet?'保存':<span class=\"string\">\"修改\"</span>&#125;&#125;</span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"!scope.row.isSet\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-tag el-tag--danger el-tag--mini\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"cursor: pointer;\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                                删除</span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">v-else</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-tag  el-tag--mini\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"cursor: pointer;\"</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"pwdChange(scope.row,scope.$index,false)\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                                取消</span></span><br><span class=\"line\"><span class=\"xml\">                            <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                    <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                <span class=\"tag\">&lt;/<span class=\"name\">el-table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;/<span class=\"name\">el-col</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">el-col</span> <span class=\"attr\">span</span>=<span class=\"string\">\"24\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"el-table-add-row\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 99.2%;\"</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"addMasterUser()\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span>+ 添加<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;/<span class=\"name\">el-col</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">el-row</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"comment\">&lt;!-- import Vue before Element --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://unpkg.com/vue@2.5.17/dist/vue.min.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"comment\">&lt;!-- import JavaScript --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://unpkg.com/element-ui/lib/index.js\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        //id生成工具 这个不用看 示例而已 模拟后台返回的id</span></span><br><span class=\"line\"><span class=\"xml\">        var generateId = &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            _count: 1,</span></span><br><span class=\"line\"><span class=\"xml\">            get()&#123;return ((+new Date()) + \"_\" + (this._count++))&#125;</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;;</span></span><br><span class=\"line\"><span class=\"xml\">        //主要内容</span></span><br><span class=\"line\"><span class=\"xml\">        var app = new Vue(&#123;</span></span><br><span class=\"line\"><span class=\"xml\">            el: \"#app\",</span></span><br><span class=\"line\"><span class=\"xml\">            data: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                master_user: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                    sel: null,//选中行   </span></span><br><span class=\"line\"><span class=\"xml\">                    columns: [</span></span><br><span class=\"line\"><span class=\"xml\">                        &#123; field: \"type\", title: \"远程类型\", width: 120 &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">                        &#123; field: \"addport\", title: \"连接地址\", width: 150 &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">                        &#123; field: \"user\", title: \"登录用户\", width: 120 &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">                        &#123; field: \"pwd\", title: \"登录密码\", width: 220 &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">                        &#123; field: \"info\", title: \"其他信息\" &#125;</span></span><br><span class=\"line\"><span class=\"xml\">                    ],</span></span><br><span class=\"line\"><span class=\"xml\">                    data: [],</span></span><br><span class=\"line\"><span class=\"xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">            &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">            methods: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                //读取表格数据</span></span><br><span class=\"line\"><span class=\"xml\">                readMasterUser() &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                    //根据实际情况，自己改下啊 </span></span><br><span class=\"line\"><span class=\"xml\">                    app.master_user.data.map(i =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                        i.id = generateId.get();//模拟后台插入成功后有了id</span></span><br><span class=\"line\"><span class=\"xml\">                        i.isSet=false;//给后台返回数据添加`isSet`标识</span></span><br><span class=\"line\"><span class=\"xml\">                        return i;</span></span><br><span class=\"line\"><span class=\"xml\">                    &#125;);</span></span><br><span class=\"line\"><span class=\"xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">                //添加账号</span></span><br><span class=\"line\"><span class=\"xml\">                addMasterUser() &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                    for (let i of app.master_user.data) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                        if (i.isSet) return app.$message.warning(\"请先保存当前编辑项\");</span></span><br><span class=\"line\"><span class=\"xml\">                    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">                    let j = &#123; id: 0, \"type\": \"\", \"addport\": \"\", \"user\": \"\", \"pwd\": \"\", \"info\": \"\", \"isSet\": true, \"_temporary\": true &#125;;</span></span><br><span class=\"line\"><span class=\"xml\">                    app.master_user.data.push(j);</span></span><br><span class=\"line\"><span class=\"xml\">                    app.master_user.sel = JSON.parse(JSON.stringify(j));</span></span><br><span class=\"line\"><span class=\"xml\">                &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">                //修改</span></span><br><span class=\"line\"><span class=\"xml\">                pwdChange(row, index, cg) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                    //点击修改 判断是否已经保存所有操作</span></span><br><span class=\"line\"><span class=\"xml\">                    for (let i of app.master_user.data) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                        if (i.isSet &amp;&amp; i.id != row.id) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                            app.$message.warning(\"请先保存当前编辑项\");</span></span><br><span class=\"line\"><span class=\"xml\">                            return false;</span></span><br><span class=\"line\"><span class=\"xml\">                        &#125;</span></span><br><span class=\"line\"><span class=\"xml\">                    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">                    //是否是取消操作</span></span><br><span class=\"line\"><span class=\"xml\">                    if (!cg) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                        if (!app.master_user.sel.id) app.master_user.data.splice(index, 1);</span></span><br><span class=\"line\"><span class=\"xml\">                        return row.isSet = !row.isSet;</span></span><br><span class=\"line\"><span class=\"xml\">                    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">                    //提交数据</span></span><br><span class=\"line\"><span class=\"xml\">                    if (row.isSet) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                        //项目是模拟请求操作  自己修改下</span></span><br><span class=\"line\"><span class=\"xml\">                        (function () &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                            let data = JSON.parse(JSON.stringify(app.master_user.sel));</span></span><br><span class=\"line\"><span class=\"xml\">                            for (let k in data) row[k] = data[k];</span></span><br><span class=\"line\"><span class=\"xml\">                            app.$message(&#123;</span></span><br><span class=\"line\"><span class=\"xml\">                                type: 'success',</span></span><br><span class=\"line\"><span class=\"xml\">                                message: \"保存成功!\"</span></span><br><span class=\"line\"><span class=\"xml\">                            &#125;);</span></span><br><span class=\"line\"><span class=\"xml\">                            //然后这边重新读取表格数据</span></span><br><span class=\"line\"><span class=\"xml\">                            app.readMasterUser();</span></span><br><span class=\"line\"><span class=\"xml\">                            row.isSet = false;</span></span><br><span class=\"line\"><span class=\"xml\">                        &#125;)();</span></span><br><span class=\"line\"><span class=\"xml\">                    &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                        app.master_user.sel = JSON.parse(JSON.stringify(row));</span></span><br><span class=\"line\"><span class=\"xml\">                        row.isSet = true;</span></span><br><span class=\"line\"><span class=\"xml\">                    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">                &#125;</span></span><br><span class=\"line\"><span class=\"xml\">            &#125;</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;);</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<hr>\n<p><span id=\"2\"></span></p>\n<h4 id=\"表头合并、自定样式、表格附件上传\"><a href=\"#表头合并、自定样式、表格附件上传\" class=\"headerlink\" title=\"表头合并、自定样式、表格附件上传\"></a>表头合并、自定样式、表格附件上传</h4><p><img src=\"http://vky-test-oss.inboyu.com/upload/39f566e0-3dcf-99b5-2bd2-1d3a06a9230b.png\" alt=\"image\"></p>\n<blockquote>\n<p>表头合并参考了element官方文档，只需要在 el-table-column 里面嵌套 el-table-column，就可以实现多级表头；<br>render-header 列标题 Label 区域渲染使用的 Function，就可以实现表头样式自定义</p>\n</blockquote>\n<figure class=\"highlight django\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">label</span>=<span class=\"string\">\"关停期间损失\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    prop=\"landlord_liquidated_damages\"</span></span><br><span class=\"line\"><span class=\"xml\">    :render-header=\"renderHeader\"</span></span><br><span class=\"line\"><span class=\"xml\">    label=\"赔付给房东的违约金（元）\"</span></span><br><span class=\"line\"><span class=\"xml\">  &gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      </span><span class=\"template-variable\">&#123;&#123; format(scope.row.landlord_liquidated_damages) &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    &gt;</span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    prop=\"tenant_liquidated_damages\"</span></span><br><span class=\"line\"><span class=\"xml\">    :render-header=\"renderHeader\"</span></span><br><span class=\"line\"><span class=\"xml\">    label=\"赔付给租客的违约金（元）\"</span></span><br><span class=\"line\"><span class=\"xml\">  &gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">      format(scope.row.tenant_liquidated_damages)</span></span><br><span class=\"line\"><span class=\"template-variable\">    &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    prop=\"client_liquidated_damages\"</span></span><br><span class=\"line\"><span class=\"xml\">    :render-header=\"renderHeader\"</span></span><br><span class=\"line\"><span class=\"xml\">    label=\"赔付给委托方的违约金（元）\"</span></span><br><span class=\"line\"><span class=\"xml\">  &gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">      format(scope.row.client_liquidated_damages)</span></span><br><span class=\"line\"><span class=\"template-variable\">    &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    prop=\"operating_loss\"</span></span><br><span class=\"line\"><span class=\"xml\">    :render-header=\"renderHeader\"</span></span><br><span class=\"line\"><span class=\"xml\">    label=\"经营亏损（元）\"</span></span><br><span class=\"line\"><span class=\"xml\">  &gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">      format(scope.row.operating_loss)</span></span><br><span class=\"line\"><span class=\"template-variable\">    &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    prop=\"additional_investment\"</span></span><br><span class=\"line\"><span class=\"xml\">    :render-header=\"renderHeader\"</span></span><br><span class=\"line\"><span class=\"xml\">    label=\"追加投资（元）\"</span></span><br><span class=\"line\"><span class=\"xml\">  &gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">      format(scope.row.additional_investment)</span></span><br><span class=\"line\"><span class=\"template-variable\">    &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">prop</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">label</span>=<span class=\"string\">\"附件\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">div</span></span></span></span><br><span class=\"line\"><span class=\"xml\">      class=\"files-box\"</span></span><br><span class=\"line\"><span class=\"xml\">      v-for=\"(a, aIndex) in scope.row.upload\"</span></span><br><span class=\"line\"><span class=\"xml\">      :key=\"aIndex\"</span></span><br><span class=\"line\"><span class=\"xml\">    &gt;</span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"files-box__name\"</span> <span class=\"attr\">:title</span>=<span class=\"string\">\"a.name\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123; a.name &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"files-box__btn\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"checkFile(a.url)\"</span>&gt;</span>查看<span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">el-button</span></span></span></span><br><span class=\"line\"><span class=\"xml\">          v-if=\"!isDetail\"</span></span><br><span class=\"line\"><span class=\"xml\">          type=\"text\"</span></span><br><span class=\"line\"><span class=\"xml\">          @click=\"delFile(aIndex, scope.$index)\"</span></span><br><span class=\"line\"><span class=\"xml\">          &gt;删除<span class=\"tag\">&lt;/<span class=\"name\">el-button</span></span></span></span><br><span class=\"line\"><span class=\"xml\">        &gt;</span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 表头样式自定义</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    renderHeader(h, &#123; column, $index &#125;) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> str = <span class=\"string\">''</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        column.label == <span class=\"string\">'预计总投（万元)'</span></span><br><span class=\"line\">        || column.label == <span class=\"string\">'预计NOI/GOP投资回报率（%）'</span></span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        str = <span class=\"string\">'投资收益'</span></span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        str = <span class=\"string\">'关停信息'</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;span&gt;</span><br><span class=\"line\">          &#123;str&#125;</span><br><span class=\"line\">          &lt;br /&gt;</span><br><span class=\"line\">          &lt;span <span class=\"class\"><span class=\"keyword\">class</span></span>=<span class=\"string\">\"c6\"</span>&gt;&#123;column.label&#125;&lt;<span class=\"regexp\">/span&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>span&gt;</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除附件</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>i 附件index</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param <span class=\"type\">&#123;*&#125;</span> </span>l list的index</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    delFile(i, l) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.list[l].upload.splice(i, <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// 查看加密附件</span></span><br><span class=\"line\">    <span class=\"keyword\">async</span> checkFile(url) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = <span class=\"keyword\">await</span> PmService.getSignedUrl(url)</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.open(res.data.url, res.data.url)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.error(e)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'#'</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.c6</span> &#123;</span></span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-tag\">color</span>: <span class=\"selector-id\">#606266</span>;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.c6</span><span class=\"selector-pseudo\">::before</span> &#123;</span></span><br><span class=\"line\">  content: \"*\";</span><br><span class=\"line\"><span class=\"css\">  <span class=\"selector-tag\">color</span>: <span class=\"selector-id\">#f56c6c</span>;</span></span><br><span class=\"line\">  margin-right: 4px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.files-box</span> &#123;</span></span><br><span class=\"line\">  position: relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.files-box__name</span> &#123;</span></span><br><span class=\"line\">  height: 40px;</span><br><span class=\"line\">  line-height: 40px;</span><br><span class=\"line\">  width: 110px;</span><br><span class=\"line\">  overflow: hidden;</span><br><span class=\"line\">  text-overflow: ellipsis;</span><br><span class=\"line\">  white-space: nowrap;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.files-box__btn</span> &#123;</span></span><br><span class=\"line\">  position: absolute;</span><br><span class=\"line\">  top: 0;</span><br><span class=\"line\">  right: 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<hr>\n<p><span id=\"3\"></span></p>\n<h4 id=\"树状table，允许展开折叠操作\"><a href=\"#树状table，允许展开折叠操作\" class=\"headerlink\" title=\"树状table，允许展开折叠操作\"></a>树状table，允许展开折叠操作</h4><p><img src=\"http://vky-test-oss.inboyu.com/upload/39f56713-e356-cbec-9c34-45ecada5598a.gif\" alt=\"image\"></p>\n<blockquote>\n<p>default-expand-all 是否默认展开所有行，当 Table 包含展开行存在或者为树形表格时有效</p>\n</blockquote>\n<figure class=\"highlight django\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"f-mt\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">el-table</span></span></span></span><br><span class=\"line\"><span class=\"xml\">      :data=\"data\"</span></span><br><span class=\"line\"><span class=\"xml\">      style=\"width: 100%;\"</span></span><br><span class=\"line\"><span class=\"xml\">      row-key=\"id\"</span></span><br><span class=\"line\"><span class=\"xml\">      :indent=\"6\"</span></span><br><span class=\"line\"><span class=\"xml\">      :default-expand-all=\"default_expand_all\"</span></span><br><span class=\"line\"><span class=\"xml\">      border</span></span><br><span class=\"line\"><span class=\"xml\">      :tree-props=\"&#123; children: 'children', hasChildren: 'hasChildren' &#125;\"</span></span><br><span class=\"line\"><span class=\"xml\">    &gt;</span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">prop</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">label</span>=<span class=\"string\">\"指标名称\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          </span><span class=\"template-variable\">&#123;&#123; scope.row.name &#125;&#125;</span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;<span class=\"name\">f-tips</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"scope.row.method\"</span> <span class=\"attr\">top</span>=<span class=\"string\">\"25%\"</span> <span class=\"attr\">:width</span>=<span class=\"string\">\"400\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">            scope.row.method</span></span><br><span class=\"line\"><span class=\"template-variable\">          &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">f-tips</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">prop</span>=<span class=\"string\">\"systemValue\"</span> <span class=\"attr\">label</span>=<span class=\"string\">\"前台系统取值（元）\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"comment\">&lt;!-- show_system_desc --&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;<span class=\"name\">el-tooltip</span></span></span></span><br><span class=\"line\"><span class=\"xml\">            effect=\"dark\"</span></span><br><span class=\"line\"><span class=\"xml\">            :content=\"scope.row.show_system_desc\"</span></span><br><span class=\"line\"><span class=\"xml\">            placement=\"top\"</span></span><br><span class=\"line\"><span class=\"xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">el-button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span>&gt;</span></span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">              format(scope.row.systemValue)</span></span><br><span class=\"line\"><span class=\"template-variable\">            &#125;&#125;</span><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">el-button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;/<span class=\"name\">el-tooltip</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">prop</span>=<span class=\"string\">\"manualValue\"</span> <span class=\"attr\">label</span>=<span class=\"string\">\"手工补录(元)\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;<span class=\"name\">el-form</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">el-form-item</span></span></span></span><br><span class=\"line\"><span class=\"xml\">              :key=\"scope.row.id\"</span></span><br><span class=\"line\"><span class=\"xml\">              :error=\"valid[scope.row.id + '_' + scope.row.name]\"</span></span><br><span class=\"line\"><span class=\"xml\">            &gt;</span></span><br><span class=\"line\"><span class=\"xml\">              <span class=\"tag\">&lt;<span class=\"name\">el-tooltip</span></span></span></span><br><span class=\"line\"><span class=\"xml\">                effect=\"dark\"</span></span><br><span class=\"line\"><span class=\"xml\">                :content=\"scope.row.show_manual_desc\"</span></span><br><span class=\"line\"><span class=\"xml\">                placement=\"top\"</span></span><br><span class=\"line\"><span class=\"xml\">              &gt;</span></span><br><span class=\"line\"><span class=\"xml\">                <span class=\"tag\">&lt;<span class=\"name\">el-input</span></span></span></span><br><span class=\"line\"><span class=\"xml\">                  size=\"medium\"</span></span><br><span class=\"line\"><span class=\"xml\">                  @input=\"</span></span><br><span class=\"line\"><span class=\"xml\">                    checkInput(</span></span><br><span class=\"line\"><span class=\"xml\">                      scope.row.manualValue,</span></span><br><span class=\"line\"><span class=\"xml\">                      scope.row.id,</span></span><br><span class=\"line\"><span class=\"xml\">                      scope.row.name</span></span><br><span class=\"line\"><span class=\"xml\">                    )</span></span><br><span class=\"line\"><span class=\"xml\">                  \"</span></span><br><span class=\"line\"><span class=\"xml\">                  v-model=\"scope.row.manualValue\"</span></span><br><span class=\"line\"><span class=\"xml\">                  placeholder=\"请输入\"</span></span><br><span class=\"line\"><span class=\"xml\">                &gt;<span class=\"tag\">&lt;/<span class=\"name\">el-input</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">              <span class=\"tag\">&lt;/<span class=\"name\">el-tooltip</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;/<span class=\"name\">el-form-item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;/<span class=\"name\">el-form</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">prop</span>=<span class=\"string\">\"total\"</span> <span class=\"attr\">label</span>=<span class=\"string\">\"合计(元)\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;<span class=\"name\">el-tooltip</span></span></span></span><br><span class=\"line\"><span class=\"xml\">            effect=\"dark\"</span></span><br><span class=\"line\"><span class=\"xml\">            :content=\"scope.row.show_system_desc\"</span></span><br><span class=\"line\"><span class=\"xml\">            placement=\"top\"</span></span><br><span class=\"line\"><span class=\"xml\">          &gt;</span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">              </span><span class=\"template-variable\">&#123;&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">                scope.row.can_edit</span></span><br><span class=\"line\"><span class=\"template-variable\">                  ? format(</span></span><br><span class=\"line\"><span class=\"template-variable\">                      (</span></span><br><span class=\"line\"><span class=\"template-variable\">                        Number(scope.row.systemValue) +</span></span><br><span class=\"line\"><span class=\"template-variable\">                        Number(scope.row.manualValue)</span></span><br><span class=\"line\"><span class=\"template-variable\">                      ).toFixed(2)</span></span><br><span class=\"line\"><span class=\"template-variable\">                    )</span></span><br><span class=\"line\"><span class=\"template-variable\">                  : format(scope.row.total)</span></span><br><span class=\"line\"><span class=\"template-variable\">              &#125;&#125;</span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;/<span class=\"name\">el-tooltip</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">el-table-column</span> <span class=\"attr\">prop</span>=<span class=\"string\">\"houses\"</span> <span class=\"attr\">label</span>=<span class=\"string\">\"楼栋均摊(元)\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"620\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;<span class=\"name\">template</span> <span class=\"attr\">slot-scope</span>=<span class=\"string\">\"scope\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;<span class=\"name\">el-form</span> <span class=\"attr\">:inline</span>=<span class=\"string\">\"true\"</span> <span class=\"attr\">label-position</span>=<span class=\"string\">\"right\"</span> <span class=\"attr\">label-width</span>=<span class=\"string\">\"120px\"</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">el-form-item</span></span></span></span><br><span class=\"line\"><span class=\"xml\">              v-for=\"(item, index) in scope.row.show_houses\"</span></span><br><span class=\"line\"><span class=\"xml\">              :label=\"item.name\"</span></span><br><span class=\"line\"><span class=\"xml\">              :key=\"index\"</span></span><br><span class=\"line\"><span class=\"xml\">              :error=\"valid[item.id + '_' + scope.row.name]\"</span></span><br><span class=\"line\"><span class=\"xml\">            &gt;</span></span><br><span class=\"line\"><span class=\"xml\">              <span class=\"tag\">&lt;<span class=\"name\">el-tooltip</span></span></span></span><br><span class=\"line\"><span class=\"xml\">                effect=\"dark\"</span></span><br><span class=\"line\"><span class=\"xml\">                placement=\"top\"</span></span><br><span class=\"line\"><span class=\"xml\">                :content=\"item.show_system_desc\"</span></span><br><span class=\"line\"><span class=\"xml\">              &gt;</span></span><br><span class=\"line\"><span class=\"xml\">                <span class=\"tag\">&lt;<span class=\"name\">el-input</span></span></span></span><br><span class=\"line\"><span class=\"xml\">                  size=\"medium\"</span></span><br><span class=\"line\"><span class=\"xml\">                  style=\"width: 130px;\"</span></span><br><span class=\"line\"><span class=\"xml\">                  :disabled=\"!item.can_edit\"</span></span><br><span class=\"line\"><span class=\"xml\">                  @input=\"</span></span><br><span class=\"line\"><span class=\"xml\">                    checkInput(item.value, item.id, scope.row.name, scope.row)</span></span><br><span class=\"line\"><span class=\"xml\">                  \"</span></span><br><span class=\"line\"><span class=\"xml\">                  v-model=\"item.value\"</span></span><br><span class=\"line\"><span class=\"xml\">                  placeholder=\"请输入修改数值\"</span></span><br><span class=\"line\"><span class=\"xml\">                &gt;<span class=\"tag\">&lt;/<span class=\"name\">el-input</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">              <span class=\"tag\">&lt;/<span class=\"name\">el-tooltip</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;/<span class=\"name\">el-form-item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            <span class=\"tag\">&lt;<span class=\"name\">el-button</span></span></span></span><br><span class=\"line\"><span class=\"xml\">              class=\"show-btn\"</span></span><br><span class=\"line\"><span class=\"xml\">              v-if=\"scope.row.houses &amp;&amp; scope.row.houses.length &gt; 2\"</span></span><br><span class=\"line\"><span class=\"xml\">              type=\"text\"</span></span><br><span class=\"line\"><span class=\"xml\">              @click=\"handleMore(scope.row)\"</span></span><br><span class=\"line\"><span class=\"xml\">              &gt;查看更多<span class=\"tag\">&lt;/<span class=\"name\">el-button</span></span></span></span><br><span class=\"line\"><span class=\"xml\">            &gt;</span></span><br><span class=\"line\"><span class=\"xml\">          <span class=\"tag\">&lt;/<span class=\"name\">el-form</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        <span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">el-table-column</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">el-table</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">function makeMsg(oriMsg, msg) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  return `$&#123;oriMsg&#125;$&#123;msg ? '，' + msg : ''&#125;`</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"><span class=\"xml\">export default &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  name: 'table-form',</span></span><br><span class=\"line\"><span class=\"xml\">  props: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    data: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      type: [Array],</span></span><br><span class=\"line\"><span class=\"xml\">      required: true</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">    // 控制树展开折叠</span></span><br><span class=\"line\"><span class=\"xml\">    default_expand_all: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      type: Boolean,</span></span><br><span class=\"line\"><span class=\"xml\">      required: true</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">  data() &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    return &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      valid: &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"xml\">      title: '',</span></span><br><span class=\"line\"><span class=\"xml\">      form: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        houses: []</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">      rules: &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"xml\">      visible: false,</span></span><br><span class=\"line\"><span class=\"xml\">      active: ['1'],</span></span><br><span class=\"line\"><span class=\"xml\">      error_info: [],</span></span><br><span class=\"line\"><span class=\"xml\">      d_loading: false,</span></span><br><span class=\"line\"><span class=\"xml\">      list: [],</span></span><br><span class=\"line\"><span class=\"xml\">      field: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        visible: false,</span></span><br><span class=\"line\"><span class=\"xml\">        loading: false,</span></span><br><span class=\"line\"><span class=\"xml\">        title: ''</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">  watch: &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"xml\">  computed: &#123;&#125;,</span></span><br><span class=\"line\"><span class=\"xml\">  methods: &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    /**</span></span><br><span class=\"line\"><span class=\"xml\">     * 编辑 ,校验输入合法</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;*&#125; value</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;*&#125; id</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;*&#125; name</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;*&#125; item 当前编辑的item</span></span><br><span class=\"line\"><span class=\"xml\">     */</span></span><br><span class=\"line\"><span class=\"xml\">    checkInput(value, id, name, item) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      let i = 14</span></span><br><span class=\"line\"><span class=\"xml\">      let f = 2</span></span><br><span class=\"line\"><span class=\"xml\">      let all_true = false</span></span><br><span class=\"line\"><span class=\"xml\">      this.valid[id + '_' + name] = ''</span></span><br><span class=\"line\"><span class=\"xml\">      let reg = new RegExp(`^-?\\\\d&#123;1,$&#123;i&#125;&#125;(\\\\.\\\\d&#123;1,$&#123;f&#125;&#125;)?$`)</span></span><br><span class=\"line\"><span class=\"xml\">      if (!reg.test(value)) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        this.valid[id + '_' + name] = `最多$&#123;i&#125;位整数$&#123;f&#125;位小数`</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      // 校验是否还存在其他valid</span></span><br><span class=\"line\"><span class=\"xml\">      for (let v in this.valid) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        if (this.valid[v]) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          all_true = false</span></span><br><span class=\"line\"><span class=\"xml\">          break</span></span><br><span class=\"line\"><span class=\"xml\">        &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          all_true = true</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      let res = 0</span></span><br><span class=\"line\"><span class=\"xml\">      if (item.houses &amp;&amp; item.houses.length) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        item.houses.forEach((h) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          res = Utils.floatAdd(res, h.value, 2)</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;)</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      item.manualValue = res // 同步更新当前手工补录值</span></span><br><span class=\"line\"><span class=\"xml\">      this.$emit('checkInput', all_true) // 通过输入合法性校验</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;,</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">    // 查看更多楼栋信息</span></span><br><span class=\"line\"><span class=\"xml\">    handleMore(data) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      this.form = _.clone(data)</span></span><br><span class=\"line\"><span class=\"xml\">      this.title = data.name</span></span><br><span class=\"line\"><span class=\"xml\">      this.visible = true</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;,</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">    // 查看明细</span></span><br><span class=\"line\"><span class=\"xml\">    goTo(url) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      this.$emit('goTo', url)</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;,</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">    /**</span></span><br><span class=\"line\"><span class=\"xml\">     * 正浮点数限制</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;Number&#125; i 整数最大位数</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;Number&#125; f 小数最大位数</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;Object&#125; options 配置</span></span><br><span class=\"line\"><span class=\"xml\">     *    isMoreThanZero: 是否强制大于0</span></span><br><span class=\"line\"><span class=\"xml\">     *    canNegative: 是否允许输入负数</span></span><br><span class=\"line\"><span class=\"xml\">     */</span></span><br><span class=\"line\"><span class=\"xml\">    float(i, f, options = &#123;&#125;) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      return &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        validator: (rule, value, callback) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          let reg</span></span><br><span class=\"line\"><span class=\"xml\">          let msg</span></span><br><span class=\"line\"><span class=\"xml\">          if (f == 0) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            reg = new RegExp(`^-?\\\\d&#123;1,$&#123;i&#125;&#125;$`)</span></span><br><span class=\"line\"><span class=\"xml\">          &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            reg = new RegExp(`^-?\\\\d&#123;1,$&#123;i&#125;&#125;(\\\\.\\\\d&#123;1,$&#123;f&#125;&#125;)?$`)</span></span><br><span class=\"line\"><span class=\"xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"xml\">          if (!value) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            callback()</span></span><br><span class=\"line\"><span class=\"xml\">          &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            if (reg.test(value)) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">              if (</span></span><br><span class=\"line\"><span class=\"xml\">                (options.isMoreThanZero &amp;&amp; Number(value) <span class=\"tag\">&lt;<span class=\"name\">=</span> <span class=\"attr\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"xml\">                || (!options.canNegative &amp;&amp; Number(value) <span class=\"tag\">&lt; <span class=\"attr\">0</span>)</span></span></span><br><span class=\"line\"><span class=\"xml\">              ) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                msg = '请输入大于零的数值'</span></span><br><span class=\"line\"><span class=\"xml\">              &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                callback()</span></span><br><span class=\"line\"><span class=\"xml\">              &#125;</span></span><br><span class=\"line\"><span class=\"xml\">            &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">              msg = `最多$&#123;i&#125;位整数`</span></span><br><span class=\"line\"><span class=\"xml\">              if (f != 0) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                msg += `$&#123;f&#125;位小数`</span></span><br><span class=\"line\"><span class=\"xml\">              &#125;</span></span><br><span class=\"line\"><span class=\"xml\">            &#125;</span></span><br><span class=\"line\"><span class=\"xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"xml\">          if (msg) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            callback(new Error(makeMsg(msg, options.extraMsg)))</span></span><br><span class=\"line\"><span class=\"xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">        trigger: 'blur'</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">    /*</span></span><br><span class=\"line\"><span class=\"xml\">      不允许输入全部是空格</span></span><br><span class=\"line\"><span class=\"xml\">     */</span></span><br><span class=\"line\"><span class=\"xml\">    notAllBlank(label) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      return &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        validator: (rule, value = '', callback) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          if (value.trim().length == 0) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            callback(new Error(`$&#123;label&#125;不能全部是空格`))</span></span><br><span class=\"line\"><span class=\"xml\">          &#125; else &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            callback()</span></span><br><span class=\"line\"><span class=\"xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">        trigger: 'blur'</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;,</span></span><br><span class=\"line\"><span class=\"xml\">    /**</span></span><br><span class=\"line\"><span class=\"xml\">     * 千分位</span></span><br><span class=\"line\"><span class=\"xml\">     * @param &#123;*&#125; str 字符串数字</span></span><br><span class=\"line\"><span class=\"xml\">     */</span></span><br><span class=\"line\"><span class=\"xml\">    format(str) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      if (!str) return str</span></span><br><span class=\"line\"><span class=\"xml\">      str = str.toString()</span></span><br><span class=\"line\"><span class=\"xml\">      let minus = false</span></span><br><span class=\"line\"><span class=\"xml\">      if (/^-/.test(str)) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        minus = true</span></span><br><span class=\"line\"><span class=\"xml\">        str = str.replace(/^-/, '')</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      let [int, float] = str.split('.')</span></span><br><span class=\"line\"><span class=\"xml\">      let result = []</span></span><br><span class=\"line\"><span class=\"xml\">      for (let i = 0; i <span class=\"tag\">&lt; <span class=\"attr\">int.length</span>; <span class=\"attr\">i</span>++) &#123;</span></span></span><br><span class=\"line\"><span class=\"xml\">        result = [int[int.length - i - 1], ...result]</span></span><br><span class=\"line\"><span class=\"xml\">        if (i % 3 == 2 &amp;&amp; i != int.length - 1) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          result = [',', ...result]</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      if (float) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        return `$&#123;minus ? '-' : ''&#125;$&#123;result.join('')&#125;.$&#123;float&#125;`</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      return `$&#123;minus ? '-' : ''&#125;$&#123;result.join('')&#125;`</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"less\"</span> <span class=\"attr\">scoped</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">@import '~__assets/var.less';</span></span><br><span class=\"line\"><span class=\"xml\">@import url('//at.alicdn.com/t/font_1712723_tp9lsy2fuua.css');</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">.f-fr &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  float: right;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">.f-tooltip &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  max-width: 700px !important;</span></span><br><span class=\"line\"><span class=\"xml\">  word-wrap: break-word !important;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">.show-btn &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  position: absolute;</span></span><br><span class=\"line\"><span class=\"xml\">  right: 20px;</span></span><br><span class=\"line\"><span class=\"xml\">  top: 13px;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">/deep/ .cell &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  user-select: text;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">/deep/ .el-table__row &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  td &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    &amp;:last-child &#123;</span></span><br><span class=\"line\"><span class=\"xml\">      .cell &#123;</span></span><br><span class=\"line\"><span class=\"xml\">        max-height: 60px;</span></span><br><span class=\"line\"><span class=\"xml\">      &#125;</span></span><br><span class=\"line\"><span class=\"xml\">    &#125;</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">.dialog-total &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  height: 32px;</span></span><br><span class=\"line\"><span class=\"xml\">  text-align: right;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">.error-info &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  color: @c-err;</span></span><br><span class=\"line\"><span class=\"xml\">  font-size: 16px;</span></span><br><span class=\"line\"><span class=\"xml\">  line-height: 24px;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">.f-i-btn &#123;</span></span><br><span class=\"line\"><span class=\"xml\">  font-size: 16px;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"https://element.eleme.cn/#/zh-CN/component/table\" target=\"_blank\" rel=\"noopener\">Table 表格</a></li>\n<li><a href=\"https://www.cnblogs.com/jiajialove/p/10740217.html\" target=\"_blank\" rel=\"noopener\">elementUi中input输入字符光标在输入一个字符后，光标失去焦点</a></li>\n</ul>\n","tags":["Element"]},{"title":"2019年终总结","url":"/2020/01/14/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/","content":"<p>  a、2019年做了哪些工作，列举出最重要的三项并阐述每一项工作取得的效果；</p>\n<p> b、这三项工作当中有哪些做得好的，哪些做得不好的，要有详尽的分析；</p>\n<p> c、2020年自己的能力提升计划和关键动作是什么。</p>\n<figure class=\"highlight asciidoc\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>单店分析模型</span><br><span class=\"line\"><span class=\"bullet\">- </span>样式、地图</span><br><span class=\"line\"><span class=\"bullet\">- </span>户口簿</span><br><span class=\"line\"><span class=\"bullet\">- </span>单一模块拆分组件</span><br><span class=\"line\"><span class=\"bullet\">- </span>老平台支出预算模块优化</span><br></pre></td></tr></table></figure>\n<h4 id=\"功能更加细化\"><a href=\"#功能更加细化\" class=\"headerlink\" title=\"功能更加细化\"></a>功能更加细化</h4><p>2019年的工作，主要做了支出预算管理优化、个人额度、万村批量付款、经营指标管理ce&amp;noi济南试点。从不懂为什么要做这样的需求，到逐渐理解。印象最深刻的就是【户口簿】【老平台支出预算模块优化】【单店分析模型】。</p>\n<p>资产户口簿列表多，编辑逻辑复杂，因为是在新平台上开发，有严格的eslint规范，所以需要做到细分功能模块，做组件拆分和复用。详情涉及到36个Number类型字段，且都可以修改。不仅区分出手填和一般编辑，还细分出调值和调账功能。对用户角色做了可操作权限的严格区分。详情页的拆成一个table，只负责做展示功能，可编辑功能拆分表格，渲染不同的弹窗模式。</p>\n<p>先判断当前用户权限，再去调用操作逻辑代码。</p>\n<h4 id=\"组件还有优化空间\"><a href=\"#组件还有优化空间\" class=\"headerlink\" title=\"组件还有优化空间\"></a>组件还有优化空间</h4><p>老平台支出预算模块优化。今年一年总是在【修修补补】这部分模块的功能。一点点的删除和替换旧语法和逻辑代码，换成es6的简介写法。尝试把多处重复使用的css文件改为less写法并压缩。把ajax请求改成手动异步模式。</p>\n<p>但是目前为止还是下手紧张，进度缓慢。代码文件还是过大，部分js文件超过了100kb。</p>\n<p>单店分析模型 也遇到了和户口簿一样的问题，表单多，需要拆分多个。比较特殊的是没有办法做到代码复用，每一个表单都是独一无二的。样式特殊，需要手动绘制页面，还涉及到饼图和柱状图。</p>\n<p>最大的问题就是地图样式问题，因为时间紧迫使用了v-chart，缺少官方文档。没有研究出来如何自定义样式地图，是坤哥帮忙查看源码解决了这个问题，感谢坤哥。</p>\n<h4 id=\"2020年自己的能力提升计划\"><a href=\"#2020年自己的能力提升计划\" class=\"headerlink\" title=\"2020年自己的能力提升计划\"></a>2020年自己的能力提升计划</h4><p>需要从用户的角度思考功能点交互细节</p>\n<p>持续思考提升工程质量的方式，如 TypeScript、Code Review 和自动化测试等</p>\n<p>继续研究自动化测试相关。</p>\n<h4 id=\"对门店线一组对期望和想法。\"><a href=\"#对门店线一组对期望和想法。\" class=\"headerlink\" title=\"对门店线一组对期望和想法。\"></a>对门店线一组对期望和想法。</h4><p>迭代时间最长不要超过三周。</p>\n<p>更加严谨的执行测试用例。</p>\n","tags":["生活"]},{"title":"ElementUI和第三方图标库Iconfont","url":"/2019/05/27/ElementUI%E5%92%8C%E7%AC%AC%E4%B8%89%E6%96%B9%E5%9B%BE%E6%A0%87%E5%BA%93Iconfont/","content":"<p>遇到一个需求，ElementUI没有符合的图标，需要插入ui提供的图标，所以使用iconfont。</p>\n<p>在项目李找到该图标，本次使用的是【xitong】这个图标。选择font class，再选择在线链接，复制这个链接。<br>在less文件里引入这个iconfont，插入到el-input即可使用。</p>\n<p><img src=\"http://vky-test-oss.inboyu.com/upload/39f56737-c8dc-9641-68f5-370f9959f503.png\" alt=\"选择iconfont\"></p>\n<p><img src=\"http://vky-test-oss.inboyu.com/upload/39f5673d-5269-568b-6300-8723196c4547.png\" alt=\"使用iconfont\"></p>\n<figure class=\"highlight dust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">  <span class=\"tag\">&lt;<span class=\"name\">el-input</span></span></span></span><br><span class=\"line\"><span class=\"xml\">    size=\"medium\"</span></span><br><span class=\"line\"><span class=\"xml\">    suffix-icon=\"iconfont icon-JYT-icon-xitong\"</span></span><br><span class=\"line\"><span class=\"xml\">    v-model=\"item.value\"</span></span><br><span class=\"line\"><span class=\"xml\">  &gt;<span class=\"tag\">&lt;/<span class=\"name\">el-input</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">export default </span><span class=\"template-variable\">&#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">  data() &#123;</span></span><br><span class=\"line\"><span class=\"template-variable\">    item: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">scoped</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">@import url('//at.alicdn.com/t/font_1712723_tp9lsy2fuua.css');</span></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n","tags":["Element"]},{"title":"Element日期选择组件时间选择限定","url":"/2017/07/18/Element%E6%97%A5%E6%9C%9F%E9%80%89%E6%8B%A9%E7%BB%84%E4%BB%B6%E6%97%B6%E9%97%B4%E9%80%89%E6%8B%A9%E9%99%90%E5%AE%9A/","content":"<h1 id=\"2018-年-12-月更新：\"><a href=\"#2018-年-12-月更新：\" class=\"headerlink\" title=\"2018 年 12 月更新：\"></a>2018 年 12 月更新：</h1><p>要求禁用时间不能小于启用时间。<br>问题： 启用时间是动态更新的，不同数据启用时间不同，导致禁用时间范围也不一样。在data初始赋值后不会再更新pickerOptions<br>解决方法：watch 启用时间，每次更新启用时间都动态更新一次pickerOptions</p>\n<h1 id=\"Template\"><a href=\"#Template\" class=\"headerlink\" title=\"Template\"></a>Template</h1><figure class=\"highlight livecodeserver\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;el-form-<span class=\"keyword\">item</span> label=<span class=\"string\">\"启用月份\"</span> prop=<span class=\"string\">\"start_year_month\"</span>&gt;</span><br><span class=\"line\">    &lt;el-<span class=\"built_in\">date</span>-picker</span><br><span class=\"line\">      v-model=<span class=\"string\">\"form.start_year_month\"</span></span><br><span class=\"line\">      type=<span class=\"string\">\"month\"</span></span><br><span class=\"line\">      <span class=\"built_in\">format</span>=<span class=\"string\">\"yyyy 年 MM\"</span></span><br><span class=\"line\">      <span class=\"built_in\">value</span>-<span class=\"built_in\">format</span>=<span class=\"string\">\"yyyyMM\"</span></span><br><span class=\"line\">      style=<span class=\"string\">\"width: 100%\"</span></span><br><span class=\"line\">      placeholder=<span class=\"string\">\"请选择启用月份\"</span></span><br><span class=\"line\">      :clearable=<span class=\"string\">\"false\"</span></span><br><span class=\"line\">      :editable=<span class=\"string\">\"false\"</span></span><br><span class=\"line\">    &gt;&lt;/el-<span class=\"built_in\">date</span>-picker&gt;</span><br><span class=\"line\">  &lt;/el-form-<span class=\"keyword\">item</span>&gt;</span><br><span class=\"line\">  &lt;el-form-<span class=\"keyword\">item</span></span><br><span class=\"line\">    label=<span class=\"string\">\"禁用月份\"</span></span><br><span class=\"line\">    prop=<span class=\"string\">\"stop_year_month\"</span></span><br><span class=\"line\">  &gt;</span><br><span class=\"line\">    &lt;el-<span class=\"built_in\">date</span>-picker</span><br><span class=\"line\">      :picker-options=<span class=\"string\">\"pickerOptions\"</span></span><br><span class=\"line\">      v-model=<span class=\"string\">\"form.stop_year_month\"</span></span><br><span class=\"line\">      :clearable=<span class=\"string\">\"false\"</span></span><br><span class=\"line\">      :editable=<span class=\"string\">\"false\"</span></span><br><span class=\"line\">      type=<span class=\"string\">\"month\"</span></span><br><span class=\"line\">      style=<span class=\"string\">\"width: 100%\"</span></span><br><span class=\"line\">      <span class=\"built_in\">format</span>=<span class=\"string\">\"yyyy 年 MM\"</span></span><br><span class=\"line\">      <span class=\"built_in\">value</span>-<span class=\"built_in\">format</span>=<span class=\"string\">\"yyyyMM\"</span></span><br><span class=\"line\">      placeholder=<span class=\"string\">\"请选择禁用月份\"</span></span><br><span class=\"line\">    &gt;&lt;/el-<span class=\"built_in\">date</span>-picker&gt;</span><br><span class=\"line\">  &lt;/el-form-<span class=\"keyword\">item</span>&gt;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Script\"><a href=\"#Script\" class=\"headerlink\" title=\"Script\"></a>Script</h1><figure class=\"highlight kotlin\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">data</span>: &#123;</span><br><span class=\"line\">  pickerOptions: &#123;&#125;,</span><br><span class=\"line\">  form: &#123;</span><br><span class=\"line\">    start_year_month: <span class=\"string\">''</span>,</span><br><span class=\"line\">    stop_year_month: <span class=\"string\">''</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">watch: &#123;</span><br><span class=\"line\">  <span class=\"comment\">// time.getTime是把选中的时间转化成自1970年1月1日 00:00:00 UTC到当前时间的毫秒数</span></span><br><span class=\"line\">  <span class=\"comment\">// 当前启用日期为 ‘201912’ ，只包含日期，导致return范围不对，需要转换为‘2019-12’</span></span><br><span class=\"line\">  [<span class=\"string\">'form.start_year_month'</span>](<span class=\"keyword\">val</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pickerOptions = Object.assign(&#123;&#125;, <span class=\"keyword\">this</span>.pickerOptions, &#123;</span><br><span class=\"line\">      <span class=\"comment\">// disabledDate 为true表示不可选,false表示可选</span></span><br><span class=\"line\">      disabledDate: (time) =&gt; &#123;</span><br><span class=\"line\">      let str = <span class=\"keyword\">val</span>.slice(<span class=\"number\">0</span>, <span class=\"number\">4</span>) + <span class=\"string\">'-'</span> + <span class=\"keyword\">val</span>.slice(<span class=\"number\">4</span>, <span class=\"number\">7</span>)</span><br><span class=\"line\">      str = new Date(str).getTime()</span><br><span class=\"line\">      <span class=\"keyword\">return</span> time.getTime() &lt; str  <span class=\"comment\">// 可选时间范围大于等于启用日期</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"实现效果\"><a href=\"#实现效果\" class=\"headerlink\" title=\"实现效果\"></a>实现效果</h1><p><img src=\"http://xiaobokeji-test.oss-cn-shenzhen.aliyuncs.com/upload/39f20b94-1fa9-7f0c-547d-b353afaadf5e/1576142187330.gif\" alt=\"image\"></p>\n<hr>\n<h1 id=\"2018-年-7-月更新：\"><a href=\"#2018-年-7-月更新：\" class=\"headerlink\" title=\"2018 年 7 月更新：\"></a>2018 年 7 月更新：</h1><p>产品觉得饿了么的时间范围选择器不方便，要求使用两个单独的时间选择器做时间范围筛选。</p>\n<h1 id=\"Template-1\"><a href=\"#Template-1\" class=\"headerlink\" title=\"Template\"></a>Template</h1><figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"keyword\">el</span>-date-picker</span><br><span class=\"line\">  v-model=<span class=\"string\">\"startDate\"</span></span><br><span class=\"line\">  <span class=\"built_in\">type</span>=<span class=\"string\">\"date\"</span></span><br><span class=\"line\">  placeholder=<span class=\"string\">\"选择开始日期\"</span></span><br><span class=\"line\">  :picker-<span class=\"keyword\">options</span>=<span class=\"string\">\"pickerOptionsStart\"</span></span><br><span class=\"line\">  @change=<span class=\"string\">\"changeEnd\"</span></span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&lt;/<span class=\"keyword\">el</span>-date-picker&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;<span class=\"keyword\">el</span>-date-picker</span><br><span class=\"line\">  v-model=<span class=\"string\">\"endDate\"</span></span><br><span class=\"line\">  <span class=\"built_in\">type</span>=<span class=\"string\">\"date\"</span></span><br><span class=\"line\">  placeholder=<span class=\"string\">\"选择结束日期\"</span></span><br><span class=\"line\">  :picker-<span class=\"keyword\">options</span>=<span class=\"string\">\"pickerOptionsEnd\"</span></span><br><span class=\"line\">  @change=<span class=\"string\">\"changeStart\"</span></span><br><span class=\"line\">&gt;</span><br><span class=\"line\">&lt;/<span class=\"keyword\">el</span>-date-picker&gt;</span><br></pre></td></tr></table></figure>\n<h1 id=\"Script-1\"><a href=\"#Script-1\" class=\"headerlink\" title=\"Script\"></a>Script</h1><figure class=\"highlight kotlin\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">data</span>() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        pickerOptionsStart: &#123;&#125;,</span><br><span class=\"line\">        pickerOptionsEnd:&#123;&#125;,</span><br><span class=\"line\">        startDate: <span class=\"string\">''</span>,</span><br><span class=\"line\">        endDate: <span class=\"string\">''</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">methods:&#123;</span><br><span class=\"line\">      changeStart ()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.pickerOptionsStart = Object.assign(&#123;&#125;,<span class=\"keyword\">this</span>.pickerOptionsStart,&#123;</span><br><span class=\"line\">          disabledDate: (time) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> time.getTime() &gt; <span class=\"keyword\">this</span>.endDate</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      changeEnd ()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.pickerOptionsEnd = Object.assign(&#123;&#125;,<span class=\"keyword\">this</span>.pickerOptionsEnd,&#123;</span><br><span class=\"line\">          disabledDate: (time) =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> time.getTime() &lt; <span class=\"keyword\">this</span>.startDate</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h5 id=\"2018-年-4-月更新：\"><a href=\"#2018-年-4-月更新：\" class=\"headerlink\" title=\"2018 年 4 月更新：\"></a>2018 年 4 月更新：</h5><p>做企业合同办理入住遇到新的需求，特此记录一下。</p>\n<figure class=\"highlight verilog\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> moment from 'moment'</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">function</span> () &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/** *</span></span><br><span class=\"line\"><span class=\"comment\">     * 不允许选择未来日期</span></span><br><span class=\"line\"><span class=\"comment\">     * 允许选择合同开始前的30天,（即往前推29天）</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果合同租期已结束，可选最大时间为租期结束时间</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    pickerOptions: &#123;</span><br><span class=\"line\">      disabledDate(<span class=\"keyword\">time</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> curDate = (<span class=\"keyword\">new</span> Date())<span class=\"variable\">.getTime</span>()</span><br><span class=\"line\">        <span class=\"keyword\">let</span> start = <span class=\"keyword\">new</span> Date(that<span class=\"variable\">.form</span><span class=\"variable\">.rent_start</span>)<span class=\"variable\">.getTime</span>()</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">end</span> = <span class=\"keyword\">new</span> Date(that<span class=\"variable\">.form</span><span class=\"variable\">.rent_end</span>)<span class=\"variable\">.getTime</span>()</span><br><span class=\"line\">        <span class=\"keyword\">let</span> three = <span class=\"number\">30</span> * <span class=\"number\">24</span> * <span class=\"number\">3600</span> * <span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (moment()<span class=\"variable\">.isAfter</span>(that<span class=\"variable\">.form</span><span class=\"variable\">.rent_end</span>, <span class=\"number\">'da</span>y')) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"keyword\">time</span><span class=\"variable\">.getTime</span>() &lt; start - three || <span class=\"keyword\">time</span><span class=\"variable\">.getTime</span>() &gt; <span class=\"keyword\">end</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">time</span><span class=\"variable\">.getTime</span>() &lt; start - three || <span class=\"keyword\">time</span><span class=\"variable\">.getTime</span>() &gt; curDate</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h5 id=\"应用场景：\"><a href=\"#应用场景：\" class=\"headerlink\" title=\"应用场景：\"></a>应用场景：</h5><p>双栏日期选择。选定开始日期后，结束日期只能限定在开始日期后三个月内的任意一天。</p>\n<h5 id=\"缺点\"><a href=\"#缺点\" class=\"headerlink\" title=\"缺点:\"></a>缺点:</h5><p>内部循环遍历所有日期，性能较差</p>\n<h5 id=\"代码：\"><a href=\"#代码：\" class=\"headerlink\" title=\"代码：\"></a>代码：</h5><ul>\n<li>datepick.html</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"datepick\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">datepick</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">datepick</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>datepick.vue</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"block\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">el-date-picker</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">v-model</span>=<span class=\"string\">\"value1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">type</span>=<span class=\"string\">\"date\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">placeholder</span>=<span class=\"string\">\"开始日期\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">:picker-options</span>=<span class=\"string\">\"pickerOptions0\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">el-date-picker</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">el-date-picker</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">v-model</span>=<span class=\"string\">\"value2\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">type</span>=<span class=\"string\">\"date\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                   <span class=\"attr\">placeholder</span>=<span class=\"string\">\"结束日期\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                    <span class=\"attr\">:picker-options</span>=<span class=\"string\">\"pickerOptions1\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">el-date-picker</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span></span><br><span class=\"line\">        data()&#123;</span><br><span class=\"line\"><span class=\"actionscript\">            <span class=\"keyword\">return</span> &#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">            value1:<span class=\"string\">''</span>,</span></span><br><span class=\"line\"><span class=\"actionscript\">            value2:<span class=\"string\">''</span>,</span></span><br><span class=\"line\">            pickerOptions1: &#123;</span><br><span class=\"line\"><span class=\"actionscript\">                <span class=\"comment\">//disabledDate是日期组件的一个方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                disabledDate: <span class=\"function\">(<span class=\"params\">time</span>) =&gt;</span> &#123;</span></span><br><span class=\"line\"><span class=\"actionscript\">                    <span class=\"comment\">//这里就涉及到日期的指定了  setMonth()函数可以设置月份</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">let</span> currentTime = <span class=\"keyword\">this</span>.value1;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">let</span> threeMonths = currentTime.setMonth(currentTime.getMonth()+<span class=\"number\">3</span>);</span></span><br><span class=\"line\"><span class=\"actionscript\">                    <span class=\"comment\">//一开始我没加下面减三个月的那个语句，他的值会一直累加</span></span></span><br><span class=\"line\">                    currentTime.setMonth(currentTime.getMonth()-3)</span><br><span class=\"line\"><span class=\"actionscript\">                    <span class=\"keyword\">return</span> time.getTime() &lt; <span class=\"keyword\">this</span>.value1 || time.getTime() &gt; threeMonths ;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>datepick.js</li>\n</ul>\n<figure class=\"highlight livescript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Vue <span class=\"keyword\">from</span> <span class=\"string\">'vue'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ElementUI <span class=\"keyword\">from</span> <span class=\"string\">'element-ui'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'element-ui/lib/theme-chalk/index.css'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> datepick <span class=\"keyword\">from</span> <span class=\"string\">'../components/datepick.vue'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">Vue.use(ElementUI);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</span><br><span class=\"line\">    el: <span class=\"string\">\"<span class=\"subst\">#datepick</span>\"</span>,</span><br><span class=\"line\">    template:<span class=\"string\">'&lt;datepick/&gt;'</span>,</span><br><span class=\"line\">    components: &#123;datepick&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n","tags":["Element"]},{"title":"Taro使用笔记","url":"/2021/05/09/Taro%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/","content":"<p>最近小程序做的实在是踩坑辛酸泪，做个笔记记录下吧</p>\n<p><a href=\"https://taro-docs.jd.com/taro/docs/\" target=\"_blank\" rel=\"noopener\">官方使用文档</a>对脚手架的下载和项目创建和运行项目，仔细看完快速上手很详细，就是很多运行起来意料之外的bug</p>\n<h5 id=\"路由配置\"><a href=\"#路由配置\" class=\"headerlink\" title=\"路由配置\"></a>路由配置</h5><p>配置路由中我们要注意，创建的页面不会像uniapp那样自动给配置进全局配置里，需要手动对app.jsx进行配置。这里的报错就是没找到这个module，配置了还不行，改变了app.js必须重新运行，才会生效。</p>\n<figure class=\"highlight flix\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// src/app.jsx</span></span><br><span class=\"line\">pages: [ <span class=\"comment\">// 路由</span></span><br><span class=\"line\">  'pages/home/<span class=\"keyword\">index</span>',</span><br><span class=\"line\">  'pages/kind/<span class=\"keyword\">index</span>',</span><br><span class=\"line\">  'pages/cart/<span class=\"keyword\">index</span>',</span><br><span class=\"line\">  'pages/user/<span class=\"keyword\">index</span>',</span><br><span class=\"line\">  'pages/<span class=\"keyword\">index</span>/<span class=\"keyword\">index</span>'</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<h5 id=\"页面配置\"><a href=\"#页面配置\" class=\"headerlink\" title=\"页面配置\"></a>页面配置</h5><p>在Taro中的页面配置并没有分一个单独的写，而是直接在组件中写</p>\n<p>当然你想要下拉刷新的时候必须在这里面进行配置，否则就算在下拉刷新的周期里写了也不会有任何反应</p>\n<figure class=\"highlight scala\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Home</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span></span>&#123;</span><br><span class=\"line\">  config = &#123;</span><br><span class=\"line\">      navigationBarBackgroundColor: '#ffffff',</span><br><span class=\"line\">      navigationBarTextStyle: <span class=\"symbol\">'blac</span>k',</span><br><span class=\"line\">      navigationBarTitleText: '测试',</span><br><span class=\"line\">      backgroundColor: '#eeeeee',</span><br><span class=\"line\">      backgroundTextStyle: <span class=\"symbol\">'ligh</span>t',</span><br><span class=\"line\">      enablePullDownRefresh:<span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> ｝</span><br></pre></td></tr></table></figure>\n<h5 id=\"公共请求封装\"><a href=\"#公共请求封装\" class=\"headerlink\" title=\"公共请求封装\"></a>公共请求封装</h5><p>在请求数据的时候，单独写的一个js让全部请求都能够使用，你这时候就不能光看一个请求区适配，有些有数据传，有些没数据传。有些get有些post这是后你就需要给其设定默认值，需要考虑好封装的请求大兼容性</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Taro <span class=\"keyword\">from</span> <span class=\"string\">'@tarojs/taro'</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> baseUrl=<span class=\"string\">\"http://xxxx\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">options</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> &#123;url,method,data&#125;=options</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    Taro.request(&#123;</span><br><span class=\"line\">      url:baseUrl+url,</span><br><span class=\"line\">      method:method||<span class=\"string\">'GET'</span>,</span><br><span class=\"line\">      data:data||&#123;&#125;,</span><br><span class=\"line\">      success:<span class=\"function\"><span class=\"params\">res</span>=&gt;</span>&#123;</span><br><span class=\"line\">        resolve(res)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail:<span class=\"function\"><span class=\"params\">res</span>=&gt;</span>&#123;</span><br><span class=\"line\">        reject(res)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"计算页面高度\"><a href=\"#计算页面高度\" class=\"headerlink\" title=\"计算页面高度\"></a>计算页面高度</h5><p>页面滚动到某个元素的时候，固定导航栏，小程序需要获取某个元素的高度。这个元素在子组件中。</p>\n<p>也就是如何获取自定义组件中某个元素的信息。微信官方是使用this.createSelectorQuery。但是在taro小程序中，子组件使用this.createSelectorQuery会报错，直接抛出 this.createSelectorQuery is not a function。大部分百度信息是加延时。但是加了延时也不作用～</p>\n<p>taro中正确用法：使用in(this.$scope)</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">wx</span><span class=\"selector-class\">.createSelectorQuery</span>()<span class=\"selector-class\">.in</span>(this.$scope)<span class=\"selector-class\">.select</span>(<span class=\"string\">'.replay-content'</span>)<span class=\"selector-class\">.boundingClientRect</span>(function (<span class=\"attribute\">rect</span>: any) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// to do</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)<span class=\"selector-class\">.exec</span>()</span><br></pre></td></tr></table></figure>\n<h5 id=\"defaultProps\"><a href=\"#defaultProps\" class=\"headerlink\" title=\"defaultProps\"></a>defaultProps</h5><p>子组件中接收的props需要定义defaultProps。否则小程序端报错</p>\n<p>期间还踩了大坑，在 Taro 中，JS 代码里必须书写单引号，特别是 JSX 中，如果出现双引号，可能会导致编译错误</p>\n<p>小程序受限于wxml语法，也不支持扩展运算符</p>\n<h5 id=\"jsx\"><a href=\"#jsx\" class=\"headerlink\" title=\"jsx\"></a>jsx</h5><p>小程序端不支持在render()之外定义jsx。比如在外面renderForm()</p>\n<p>最后一项就是我自己的问题了，在关于计算属性时，由于之前是使用vue，而我经常使用computed来计算值直接渲染视图，我在使用Taro的时候就一直在寻找有没有对应的函数能够给我使用，最后看过案例后，才想起数据渲染视图这句话，我并不需要对应的方法使用同样可以得到我想要的结果，我在componentDidShow(){}函数中用进入时请求的值先行计算赋给state然后在计算的值改变的操作中再次调用此函数，最后能够在数据改变的时候让计算的值得到更新。</p>\n","tags":["前端","学习","小程序"]},{"title":"H5开发配置","url":"/2020/03/11/H5%E5%BC%80%E5%8F%91%E9%85%8D%E7%BD%AE/","content":"<h3 id=\"whistle\"><a href=\"#whistle\" class=\"headerlink\" title=\"whistle\"></a>whistle</h3><p>全局安装 whistle , <a href=\"https://git.inboyu.com/platform/partner-ui\" target=\"_blank\" rel=\"noopener\">文档地址</a></p>\n<p>使用时用 git 命令行 <code>w2 start</code>，关闭使用<code>w2 stop</code></p>\n<p>rules 目录配置</p>\n<p>ip 地址为项目运行后<code>npm run dev</code>后的 ip 结果</p>\n<p><img src=\"http://vky-test-oss.inboyu.com/upload/39fe4b99-6eff-d03b-4976-14643d81bde1.png\" alt=\"image\"></p>\n<h3 id=\"value-目录下配置\"><a href=\"#value-目录下配置\" class=\"headerlink\" title=\"value 目录下配置\"></a>value 目录下配置</h3><figure class=\"highlight routeros\"><table><tr><td class=\"code\"><pre><span class=\"line\">vsconsole</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script <span class=\"attribute\">src</span>=<span class=\"string\">\"https://cdn.bootcdn.net/ajax/libs/vConsole/3.3.4/vconsole.min.js\"</span>&gt;&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"builtin-name\">run</span> vsconsole</span><br><span class=\"line\"></span><br><span class=\"line\">var vConsole = new VConsole();</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://vky-test-oss.inboyu.com/upload/39fe4b9b-086a-e41b-199f-4bebcfac8304.png\" alt=\"image\"></p>\n<h4 id=\"配置证书\"><a href=\"#配置证书\" class=\"headerlink\" title=\"配置证书\"></a>配置证书</h4><p><img src=\"http://vky-test-oss.inboyu.com/upload/39fe4b9b-a80d-2183-fef6-f6d72268e8dd.png\" alt=\"image\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">注意：证书必须安装在企业信任的目录下，不然配置不会成功</span><br></pre></td></tr></table></figure>\n<h5 id=\"whistle-script\"><a href=\"#whistle-script\" class=\"headerlink\" title=\"whistle script\"></a>whistle script</h5><p>安装 script 插件，<a href=\"https://github.com/whistle-plugins/whistle.script\" target=\"_blank\" rel=\"noopener\">下载地址</a></p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> -g whistle</span><br><span class=\"line\">npm <span class=\"keyword\">install</span> -g whistle.script</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://vky-test-oss.inboyu.com/upload/39fe4b9c-6094-d8d8-7127-9fdb6fe0b820.png\" alt=\"image\"></p>\n<h4 id=\"Proxy-SwitchyOmega\"><a href=\"#Proxy-SwitchyOmega\" class=\"headerlink\" title=\"Proxy SwitchyOmega\"></a>Proxy SwitchyOmega</h4><p>谷歌浏览器安装插件，使用的时候选择【proxy】情景模式</p>\n<p><img src=\"http://vky-test-oss.inboyu.com/upload/39fe4b9c-da72-cc89-1135-70cdbe954378.png\" alt=\"image\"></p>\n<p><a href=\"chrome-extension://padekgcemlokbadohgkifijomclgjgif/options.html#!/profile/proxy\" target=\"_blank\" rel=\"noopener\">服务器配置</a></p>\n","tags":["移动开发"]},{"title":"Vue中样式覆盖-style的scoped属性","url":"/2017/07/06/Vue%E4%B8%AD%E6%A0%B7%E5%BC%8F%E8%A6%86%E7%9B%96-style%E7%9A%84scoped%E5%B1%9E%E6%80%A7/","content":"<h5 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h5><p>  &emsp;项目使用Vue和ElementUi，想要覆盖ElementUi默认的输入框样式，新增自定义CSS样式，根据el-input编译后生成的class修改，但是样式并不生效。<br> 后来发现修改<br><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span> <span class=\"attr\">scoped</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>标签里的<font color=\"#4bcc8e\">scoped</font>删除就生效了。  </p>\n<h5 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h5><p>  &emsp;<font color=\"#4bcc8e\">scope</font>可以做到样式私有化，及当前样式只作用于当前模块，不会影响全局。</p>\n<p> &emsp;通过查看DOM结构发现：vue通过在DOM结构以及css样式上加唯一不重复的标记，以保证唯一，达到样式私有化模块化的目的。具体的渲染结果是怎样的，通过一个例子来说明。</p>\n<h5 id=\"举个栗子\"><a href=\"#举个栗子\" class=\"headerlink\" title=\"举个栗子\"></a>举个栗子</h5><p> &emsp;一个公共组件button，为了样式模块化，给其加上<font color=\"#4bcc8e\">scoped</font>属性</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">//button.vue</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"button-warp\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">class</span>=<span class=\"string\">\"button\"</span>&gt;</span>text<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">template</span>&gt;</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">scoped</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.button-warp</span>&#123;</span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-tag\">display</span><span class=\"selector-pseudo\">:inline-block</span>;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.button</span>&#123;</span></span><br><span class=\"line\">        padding: 5px 10px;</span><br><span class=\"line\">        font-size: 12px;</span><br><span class=\"line\">        border-radus: 2px;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>&emsp;浏览器渲染的button组件，其html和css结构如下：</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"keyword\">div</span> data-v<span class=\"number\">-2311</span>c06a <span class=\"built_in\">class</span>=<span class=\"string\">\"button-warp\"</span>&gt;</span><br><span class=\"line\">    &lt;button data-v<span class=\"number\">-2311</span>c06a <span class=\"built_in\">class</span>=<span class=\"string\">\"button\"</span>&gt;<span class=\"built_in\">text</span>&lt;/button&gt;</span><br><span class=\"line\">&lt;/<span class=\"keyword\">div</span>&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.button-warp</span><span class=\"selector-attr\">[data-v-2311c06a]</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>:inline-block;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.button</span><span class=\"selector-attr\">[data-v-2311c06a]</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">5px</span> <span class=\"number\">10px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">font-size</span>: <span class=\"number\">12px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border-radus</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>&emsp;从上面的案例可以看出，添加了<font color=\"#4bcc8e\">scoped</font>属性的组件，为了达到组件样式模块化，做了两个处理：</p>\n<ul>\n<li>给 <code>HTML</code>的 <code>DOM</code>节点加一个不重复data属性(形如：data-v-2311c06a)来表示他的唯一性</li>\n<li>在每句 <code>css</code>选择器的末尾（编译后的生成的css语句）加一个当前组件的data属性选择器（如[data-v-2311c06a]）来私有化样式</li>\n</ul>\n<p>&emsp;但这势必影响到css的优先级，<font color=\"#4bcc8e\">scoped</font>虽然达到了组件样式模块化，但是会导致每个样式的<code>权重加重</code>。理论上我们要修改这个样式的话，需要更高的权重去修改，增加了复杂度。</p>\n<h5 id=\"外部引用\"><a href=\"#外部引用\" class=\"headerlink\" title=\"外部引用\"></a>外部引用</h5><p>&emsp;栗子说明了单个组件渲染，当遇到组件相互调用，如果组件内部包含有其他组件，只会给其他组件的最外层标签加上当前组件的data属性。</p>\n<h5 id=\"解决方案\"><a href=\"#解决方案\" class=\"headerlink\" title=\"解决方案\"></a>解决方案</h5><p>&emsp;vue-loader的深度作用选择器。  </p>\n<p>&emsp;在vue.js中，<code>&lt;style scoped&gt;</code>的作用域在本<code>html</code>页面，<code>&lt;style&gt;</code>样式的作用域则是全局（即所有html页面），由于我把其中一个html页面的<code>&lt;style scoped&gt;</code><font color=\"#4bcc8e\">scoped</font>去掉，这个页面的样式就变成了全局样式，当其它页面和这些全局样式重<code>class</code>名时，样式会被覆盖（vue默认全局样式覆盖局部样式），这样就导致当前页面定义样式影响到全局样式。</p>\n<p>&emsp;如何在<code>&lt;style scoped&gt;</code>局部样式中覆盖全局样式：父组件cssName+ /deep/+第三方库需要更改的cssName</p>\n<figure class=\"highlight coffeescript\"><table><tr><td class=\"code\"><pre><span class=\"line\">比如修改<span class=\"class\"><span class=\"keyword\">class</span>为<span class=\"title\">el</span>-<span class=\"title\">input__inner</span>的元素，</span></span><br><span class=\"line\">它的父<span class=\"class\"><span class=\"keyword\">class</span>为<span class=\"title\">input_percent</span>，</span></span><br><span class=\"line\">则在style中写入input_percent <span class=\"regexp\">/deep/</span> .el-input__inner &#123;&#125;即可</span><br></pre></td></tr></table></figure>\n","tags":["Vue"]},{"title":"markdown语法","url":"/2017/03/09/markdown%E8%AF%AD%E6%B3%95/","content":"<ul>\n<li><a href=\"#1\">强调</a></li>\n<li><a href=\"#2\">分割线</a></li>\n<li><a href=\"#3\">引用</a></li>\n<li><a href=\"#4\">嵌套列表</a></li>\n<li><a href=\"#5\">段落缩进（空格）</a></li>\n<li><a href=\"#6\">字体、字号、颜色</a></li>\n<li><a href=\"#7\">标签</a></li>\n<li><a href=\"#8\">换行</a></li>\n<li><a href=\"#9\">首行缩进</a></li>\n<li><a href=\"#10\">流程图（mermaid语法）</a></li>\n</ul>\n<ul>\n<li>当前目录使用的索引超链的方式</li>\n</ul>\n<p><span id=\"1\"></span></p>\n<h4 id=\"强调\"><a href=\"#强调\" class=\"headerlink\" title=\"强调\"></a>强调</h4><figure class=\"highlight maxima\"><table><tr><td class=\"code\"><pre><span class=\"line\">**强调文字**</span><br><span class=\"line\"><span class=\"symbol\">__</span>强调文字<span class=\"symbol\">__</span></span><br><span class=\"line\"></span><br><span class=\"line\">*强调文字</span><br><span class=\"line\">强调文字*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">_</span>强调文字<span class=\"symbol\">_</span></span><br></pre></td></tr></table></figure>\n<p><strong>强调文字</strong><br><strong>强调文字</strong></p>\n<p><em>强调文字<br>强调文字</em></p>\n<p><em>强调文字</em></p>\n<p><span id=\"2\"></span></p>\n<h4 id=\"分割线\"><a href=\"#分割线\" class=\"headerlink\" title=\"分割线\"></a>分割线</h4><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n<hr>\n<p><span id=\"3\"></span></p>\n<h4 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h4><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\">引用</span></span><br><span class=\"line\"><span class=\"meta\"> &gt;</span><span class=\"bash\">&gt;引用中的引用</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>引用</p>\n<blockquote>\n<p>引用中的引用<br><span id=\"4\"></span></p>\n</blockquote>\n</blockquote>\n<h4 id=\"嵌套列表\"><a href=\"#嵌套列表\" class=\"headerlink\" title=\"嵌套列表\"></a>嵌套列表</h4><figure class=\"highlight markdown\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>嵌套列表1</span><br><span class=\"line\"><span class=\"bullet\"> + </span>嵌套列表2</span><br><span class=\"line\"><span class=\"bullet\"> + </span>嵌套列表3</span><br><span class=\"line\"><span class=\"bullet\">  - </span>嵌套列表4</span><br><span class=\"line\"><span class=\"bullet\">   * </span>嵌套列表5</span><br><span class=\"line\"><span class=\"bullet\">- </span>嵌套列表6</span><br></pre></td></tr></table></figure>\n<ul>\n<li>嵌套列表1<ul>\n<li>嵌套列表2</li>\n<li>嵌套列表3</li>\n</ul>\n<ul>\n<li>嵌套列表4<ul>\n<li>嵌套列表5</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>嵌套列表6</li>\n</ul>\n<p><span id=\"5\"></span></p>\n<h4 id=\"段落缩进\"><a href=\"#段落缩进\" class=\"headerlink\" title=\"段落缩进\"></a>段落缩进</h4><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">半方大的空白<span class=\"symbol\">&amp;ensp;</span>或<span class=\"symbol\">&amp;#8194;</span>看，飞碟</span><br><span class=\"line\">全方大的空白<span class=\"symbol\">&amp;emsp;</span>或<span class=\"symbol\">&amp;#8195;</span>看，飞碟</span><br><span class=\"line\">不断行的空白格<span class=\"symbol\">&amp;nbsp;</span>或<span class=\"symbol\">&amp;#160;</span>看，飞碟</span><br><span class=\"line\"><span class=\"symbol\">&amp;emsp;</span><span class=\"symbol\">&amp;emsp;</span>段落从此开始。</span><br></pre></td></tr></table></figure>\n<p>半方大的空白&ensp;或&#8194;看，飞碟</p>\n<p>全方大的空白&emsp;或&#8195;看，飞碟</p>\n<p>不断行的空白格&nbsp;或&#160;看，飞碟</p>\n<p>&emsp;&emsp;段落从此开始。</p>\n<p><span id=\"6\"></span></p>\n<h4 id=\"字体、字号、颜色\"><a href=\"#字体、字号、颜色\" class=\"headerlink\" title=\"字体、字号、颜色\"></a>字体、字号、颜色</h4><figure class=\"highlight routeros\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;font <span class=\"attribute\">face</span>=<span class=\"string\">\"黑体\"</span>&gt;我是黑体字&lt;/font&gt;</span><br><span class=\"line\">&lt;font <span class=\"attribute\">face</span>=<span class=\"string\">\"微软雅黑\"</span>&gt;我是微软雅黑&lt;/font&gt;</span><br><span class=\"line\">&lt;font <span class=\"attribute\">face</span>=<span class=\"string\">\"STCAIYUN\"</span>&gt;我是华文彩云&lt;/font&gt;</span><br><span class=\"line\">&lt;font <span class=\"attribute\">color</span>=#0099ff <span class=\"attribute\">size</span>=12 <span class=\"attribute\">face</span>=<span class=\"string\">\"黑体\"</span>&gt;黑体&lt;/font&gt;</span><br><span class=\"line\">&lt;font <span class=\"attribute\">color</span>=#00ffff <span class=\"attribute\">size</span>=3&gt;null&lt;/font&gt;</span><br><span class=\"line\">&lt;font <span class=\"attribute\">color</span>=gray <span class=\"attribute\">size</span>=5&gt;gray&lt;/font&gt;</span><br></pre></td></tr></table></figure>\n<font face=\"黑体\">我是黑体字</font>\n\n<font face=\"微软雅黑\">我是微软雅黑</font>\n\n<font face=\"STCAIYUN\">我是华文彩云</font>\n\n<font color=\"#4bcc8e\" size=\"6\" face=\"黑体\">黑体</font>\n\n<font color=\"#4bcc8e\" size=\"3\">null</font>\n\n<font color=\"gray\" size=\"5\">gray</font>\n\n<p><span id=\"7\"></span></p>\n<h4 id=\"标签\"><a href=\"#标签\" class=\"headerlink\" title=\"标签\"></a>标签</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">行内标签`</span><br></pre></td></tr></table></figure>\n<p>这是一个有颜色的<code>标签</code></p>\n<p><span id=\"8\"></span></p>\n<h4 id=\"换行\"><a href=\"#换行\" class=\"headerlink\" title=\"换行\"></a>换行</h4><ul>\n<li><p>使用br标签</p>\n</li>\n<li><p>在末尾敲击两个以上空白，然后回车</p>\n</li>\n</ul>\n<p><span id=\"9\"></span></p>\n<h4 id=\"首行缩进\"><a href=\"#首行缩进\" class=\"headerlink\" title=\"首行缩进\"></a>首行缩进</h4><p>使用特殊占位符<br>不同占位符所占空白是不一样大的。</p>\n<figure class=\"highlight dts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">&amp;ensp</span>;或&amp;<span class=\"meta\">#8194; <span class=\"comment\">//半角</span></span></span><br><span class=\"line\"><span class=\"variable\">&amp;emsp</span>;或&amp;<span class=\"meta\">#8195; <span class=\"comment\">//全角</span></span></span><br><span class=\"line\"><span class=\"variable\">&amp;nbsp</span>;或&amp;<span class=\"meta\">#160;</span></span><br></pre></td></tr></table></figure>\n<h5 id=\"全角输入情况下双击两次空格\"><a href=\"#全角输入情况下双击两次空格\" class=\"headerlink\" title=\"全角输入情况下双击两次空格\"></a>全角输入情况下双击两次空格</h5><p>这个方法我遇到一个问题：首段不能缩进</p>\n<p><span id=\"10\"></span></p>\n<h4 id=\"流程图（mermaid语法）\"><a href=\"#流程图（mermaid语法）\" class=\"headerlink\" title=\"流程图（mermaid语法）\"></a>流程图（mermaid语法）</h4><p>书写graph XX，用以确定将要绘制的流程图及其类型（XX表示流程图类型）。<br>流程图分为竖向和横向两大类，竖向包括自上而下和自下而上两种顺序，横向包括从右到左和从左到右两种顺序。<br><code>其对应语法分别为：graph TB/graph BT/graph RL/graph LR。</code></p>\n<p>TB - top bottom（自上而下）<br>BT - bottom top（自下而上）<br>RL - right left（从右到左）<br>LR - left right（从左到右）<br>TD: 默认方向，从上到下</p>\n<h5 id=\"连接线与箭头\"><a href=\"#连接线与箭头\" class=\"headerlink\" title=\"连接线与箭头\"></a>连接线与箭头</h5><p>一个箭头 -&gt; 只能表示一条线<br>要表示箭头，需要两个箭头 -&gt;&gt;<br>虚线用两个虚线表示 –&gt;&gt;</p>\n<figure class=\"highlight coq\"><table><tr><td class=\"code\"><pre><span class=\"line\">graph TD</span><br><span class=\"line\">A[模块A] --&gt;|<span class=\"type\">A1</span>| <span class=\"type\">B</span>(模块B)</span><br><span class=\"line\">B --&gt; C&#123;判断条件C&#125;</span><br><span class=\"line\">C --&gt;|<span class=\"type\">条件C1</span>| <span class=\"type\">D</span>&gt;模块D]</span><br><span class=\"line\">C --&gt;|<span class=\"type\">条件C2</span>| <span class=\"type\">E</span>((模块E))</span><br><span class=\"line\">C --&gt;|<span class=\"type\">条件C3</span>| <span class=\"type\">F</span>[<span class=\"string\">\"模块F(引号可转义特殊字符)\"</span>]</span><br></pre></td></tr></table></figure>\n<p>例子：</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"code\"><pre><span class=\"line\">- <span class=\"built_in\">id</span> 为汽车主键<span class=\"built_in\">id</span></span><br><span class=\"line\">- scar-<span class=\"built_in\">id</span> 为汽车车系<span class=\"built_in\">id</span></span><br><span class=\"line\">- 主要车的系列判断<span class=\"built_in\">id</span>为车辆系列ids</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">carmodel-&gt;&gt;carinfo: http:<span class=\"regexp\">//</span>XX<span class=\"regexp\">/index.php/</span>src<span class=\"regexp\">/index/</span>carmodel<span class=\"regexp\">/id/</span><span class=\"number\">1</span></span><br><span class=\"line\">carinfo-&gt;&gt;carmodel: http:<span class=\"regexp\">//</span>XX<span class=\"regexp\">/index.php/</span>Src<span class=\"regexp\">/index/</span>carinfo?car_id=<span class=\"number\">13</span>&amp;scar_id=<span class=\"number\">19</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight awk\"><table><tr><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">enginesize-&gt;&gt;caryear: http:<span class=\"regexp\">//</span>XX<span class=\"regexp\">/index.php/</span>Src<span class=\"regexp\">/index/</span>enginesize?car_id=<span class=\"number\">13</span>&amp;scar_id=<span class=\"number\">19</span></span><br><span class=\"line\">caryear-&gt;&gt;enginesize: http:<span class=\"regexp\">//</span>XX<span class=\"regexp\">/index.php/</span>Src<span class=\"regexp\">/index/</span>cartype?car_id=<span class=\"number\">13</span>&amp;scar_id=<span class=\"number\">19</span>&amp;dis_id=<span class=\"number\">1</span>&amp;year_id=<span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n","tags":["学习"]},{"title":"webview更新地址没有发起请求","url":"/2018/08/14/webview%E6%9B%B4%E6%96%B0%E5%9C%B0%E5%9D%80%E6%B2%A1%E6%9C%89%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82/","content":"<h4 id=\"场景\"><a href=\"#场景\" class=\"headerlink\" title=\"场景\"></a>场景</h4><p>app启动的时候会预加载web页面，web页面依赖app的相关权限数据（例如aoo定位坐标）</p>\n<ol>\n<li>首次进入app，用户据胡娥授权定位或者手机定位未开启，这时候web页面已经预加载。(以hash路由为例)</li>\n</ol>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><span class=\"line\">http<span class=\"variable\">s:</span>//www.baidu.<span class=\"keyword\">com</span>/<span class=\"built_in\">index</span>.html#/</span><br></pre></td></tr></table></figure>\n<p>获取不到定位，页面先加载北京的数据。</p>\n<ol start=\"2\">\n<li>用户开启手机定位，app获取到经纬度，重新请求一次接口，url地址为</li>\n</ol>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><span class=\"line\">http<span class=\"variable\">s:</span>//www.baidu.<span class=\"keyword\">com</span>/<span class=\"built_in\">index</span>.html#/?<span class=\"keyword\">lat</span>=<span class=\"number\">143.232232</span>&amp;lon=<span class=\"number\">32.234432</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h4><p>url更新并没有请求接口更新数据</p>\n<h4 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h4><p>利用watch监听router中query的变化</p>\n<figure class=\"highlight sqf\"><table><tr><td class=\"code\"><pre><span class=\"line\">watch: &#123;</span><br><span class=\"line\">      <span class=\"string\">'$route'</span> (<span class=\"keyword\">to</span>, <span class=\"keyword\">from</span>) &#123; <span class=\"comment\">//监听路由是否变化</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span>(<span class=\"keyword\">to</span>.query.lat != <span class=\"keyword\">from</span>.query.lat)&#123;</span><br><span class=\"line\">              this.loadData();<span class=\"comment\">//重新加载数据</span></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>APP加载的一直是<code>https://www.baidu.com/index.html#/</code>这个地址，只是后边追加的参数不同，再回想下vue单页面路由的原理，只有访问到对应的路由才会触发对应的页面加载（当前路由和要跳转的路由对应同一个组件时，组件不会被更新，生命周期不会被执行），才会触发页面中的vue的生命周期，所以，可以利用watch来监听路由参数的变化。</p>\n<h4 id=\"参考文章\"><a href=\"#参考文章\" class=\"headerlink\" title=\"参考文章\"></a>参考文章</h4><ul>\n<li><a href=\"https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html#%E5%93%8D%E5%BA%94%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%98%E5%8C%96\" target=\"_blank\" rel=\"noopener\">官方说明</a></li>\n</ul>\n","tags":["前端","vue","移动端"]},{"title":"人脸识别门禁功能","url":"/2019/07/18/%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E9%97%A8%E7%A6%81%E5%8A%9F%E8%83%BD/","content":"<p>需求比较急，就用了微信的<code>weui</code></p>\n<figure class=\"highlight capnproto\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> weui <span class=\"keyword\">from</span> <span class=\"string\">\"weui.js/dist/weui.min\"</span>;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//拉起微信的图片上传服务</span></span><br><span class=\"line\">upload() &#123;</span><br><span class=\"line\">  $.utils.uploadImage(<span class=\"keyword\">data</span> =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.signedUrl = <span class=\"keyword\">data</span>.signedUrl;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.sendData.originUrl = <span class=\"keyword\">data</span>.originUrl;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.submit(<span class=\"keyword\">data</span>.originUrl);</span><br><span class=\"line\">  &#125;, <span class=\"literal\">true</span>);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//预览图片</span></span><br><span class=\"line\">preview(url) &#123;</span><br><span class=\"line\">  let urls = [];</span><br><span class=\"line\">  urls[<span class=\"number\">0</span>] = url;</span><br><span class=\"line\">  window.wx.previewImage(&#123;</span><br><span class=\"line\">    current: url, <span class=\"comment\">// 当前显示图片的http链接</span></span><br><span class=\"line\">    urls: urls <span class=\"comment\">// 需要预览的图片http链接列表</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p>图片上传微信 API <code>wx.chooseImage</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">InitJsSdk: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (_wxInited) &#123;</span><br><span class=\"line\">        callback &amp;&amp; callback();</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> url = <span class=\"string\">\"/weixin/jssdksign\"</span>;</span><br><span class=\"line\">    $.ajax( url , &#123;</span><br><span class=\"line\">        data: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"url\"</span>:  <span class=\"built_in\">window</span>.location.href.split(<span class=\"string\">'#'</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        type: <span class=\"string\">\"GET\"</span>,</span><br><span class=\"line\">        success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (data) &#123;</span><br><span class=\"line\">                data.jsApiList = [</span><br><span class=\"line\">                    <span class=\"string\">\"previewImage\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"getLocation\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"openLocation\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"chooseImage\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"uploadImage\"</span>,</span><br><span class=\"line\">                    <span class=\"string\">\"onMenuShareTimeline\"</span>,  <span class=\"comment\">//分享到朋友圈</span></span><br><span class=\"line\">                    <span class=\"string\">\"onMenuShareAppMessage\"</span>,  <span class=\"comment\">//发送给朋友</span></span><br><span class=\"line\">                    <span class=\"string\">\"hideMenuItems\"</span>,  <span class=\"comment\">//批量隐藏功能按钮</span></span><br><span class=\"line\">                    <span class=\"string\">\"showMenuItems\"</span>   <span class=\"comment\">//批量显示功能按钮</span></span><br><span class=\"line\">                ];</span><br><span class=\"line\">                wx.config(data);</span><br><span class=\"line\"></span><br><span class=\"line\">                wx.ready(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                    wx.hideMenuItems(&#123;</span><br><span class=\"line\">                        menuList: [<span class=\"string\">'menuItem:share:appMessage'</span>,<span class=\"string\">'menuItem:share:timeline'</span>,<span class=\"string\">\"menuItem:share:qq\"</span>,<span class=\"string\">\"menuItem:share:QZone\"</span>,<span class=\"string\">\"menuItem:copyUrl\"</span>]</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                    _wxInited = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    callback &amp;&amp; callback();</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//微信上传图片</span></span><br><span class=\"line\">uploadImage: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">callback,safe,count</span>) </span>&#123;</span><br><span class=\"line\">    _utils.InitJsSdk(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        wx.chooseImage(&#123;</span><br><span class=\"line\">            count: count || <span class=\"number\">1</span>, <span class=\"comment\">// 默认9</span></span><br><span class=\"line\">            <span class=\"comment\">// sizeType: ['original','compressed'], // 可以指定是原图还是压缩图，默认二者都有</span></span><br><span class=\"line\">            <span class=\"comment\">// sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有</span></span><br><span class=\"line\">            success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> localIds = res.localIds;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    _utils.pushAllImg(localIds, safe, callback)</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(<span class=\"built_in\">JSON</span>.stringify(error))</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            error:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>)</span>&#123;</span><br><span class=\"line\">                $.message.show(<span class=\"string\">'图片选取失败!'</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p>查看预览,返回的<code>wx.preview</code></p>\n<p>遇到了微信公众号开发者工具，调用这两个方法都是报错的问题。发布测试后就发现 ok 了，原来工具不支持这个方法，还是得真机调试。</p>\n<p>封装好的请求和方法一定要调试好了之后再调试，不然不停发布测试实在是耽误时间和精力。</p>\n<p>提前测试好文件上传，替换好。抓包测试。</p>\n<figure class=\"highlight scheme\"><table><tr><td class=\"code\"><pre><span class=\"line\">[&#123;</span><br><span class=\"line\">id: '',</span><br><span class=\"line\">    number: '',</span><br><span class=\"line\">bank_num:''</span><br><span class=\"line\">&#125;,&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    id: '',</span><br><span class=\"line\">    number: '',</span><br><span class=\"line\">bank_num:''</span><br><span class=\"line\">&#125;]</span><br></pre></td></tr></table></figure>\n<p>提交报错后， 提交中 loading 态没有取消,需要处理 catch error</p>\n","tags":["工作笔记"]},{"title":"前端页面内权限控制规范","url":"/2018/03/13/%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%86%85%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E8%A7%84%E8%8C%83/","content":"<h4 id=\"201809更新\"><a href=\"#201809更新\" class=\"headerlink\" title=\"201809更新\"></a>201809更新</h4><p><code>v-auth</code>控制弹窗内元素渲染会出现首次渲染成功后，第二次打开弹窗为false的情况，导致权限判断失败，页面样式错位，所以无法在弹窗内使用该方法。</p>\n<p>解决方法：因为只需要页面初次加载时判断用户有无功能权限，通过接口查询一次后赋值给data的xx属性，通过属性的值来判断。</p>\n<figure class=\"highlight cs\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">async</span> <span class=\"title\">created</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do someting</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 查询有无删除调账记录权限</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> valid = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.fCheckAuth(<span class=\"string\">'household.HOUSEHOLD_DELSUBJECT'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (valid) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.show_del = <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    console.log(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"前端页面内权限控制规范\"><a href=\"#前端页面内权限控制规范\" class=\"headerlink\" title=\"前端页面内权限控制规范\"></a>前端页面内权限控制规范</h1><p>目前的权限系统支持到动作点的细粒度控制，前端支持前置判断权限从而控制节点的展示与隐藏，执行相关逻辑等。前端通过 mixin 混入权限控制模块进行判断和处理。</p>\n<p>自定义组件需要单独<code>import &#39;@/mixin/auth&#39;</code>，如果是已经引入了<code>@/mixin</code>的页面组件则不需要额外引入该模块。</p>\n<p>该模块提供一个自定义指令<code>v-auth</code>和一个公共方法<code>fCheckAuth</code>，前者用来根据权限控制一个节点的展示或隐藏，后者通过该方法查询当前角色是否有某权限。</p>\n<hr>\n<h2 id=\"动作点管理\"><a href=\"#动作点管理\" class=\"headerlink\" title=\"动作点管理\"></a>动作点管理</h2><p>动作点统一添加到<code>@/config/auth</code>。动作点通过模块管理，值为后台刷新的动作点名。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 账单</span></span><br><span class=\"line\">  bill: &#123;</span><br><span class=\"line\">    CONFIRM_OFFLINE_PAYMENT: <span class=\"string\">'accounting_billcenter_confirmofflinepayment'</span> <span class=\"comment\">// 确认财务收款</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"v-auth\"><a href=\"#v-auth\" class=\"headerlink\" title=\"v-auth\"></a>v-auth</h2><p><code>v-auth</code>接收多种格式的参数。</p>\n<hr>\n<h3 id=\"传入字符串\"><a href=\"#传入字符串\" class=\"headerlink\" title=\"传入字符串\"></a>传入字符串</h3><p>可以传入一个形如<code>&#39;bill.CONFIRM_OFFLINE_PAYMENT&#39;</code>的字符串，指令会到配置中寻找对应的路径查询当前动作点是否有权限，如果没有权限，则移除这个 DOM。</p>\n<p>注意：传入的是字符串<code>&#39;bill.CONFIRM_OFFLINE_PAYMENT&#39;</code>，而不是<code>bill.CONFIRM_OFFLINE_PAYMENT</code>，后者会被框架当做组件的<code>data</code>值去获取。</p>\n<hr>\n<h3 id=\"传入对象\"><a href=\"#传入对象\" class=\"headerlink\" title=\"传入对象\"></a>传入对象</h3><p>可以传入的是一个对象：</p>\n<table>\n<thead>\n<tr>\n<th>参数名</th>\n<th>类型</th>\n<th>解释</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>auth</td>\n<td>String</td>\n<td>逻辑处理同字符串参数</td>\n</tr>\n<tr>\n<td>hide</td>\n<td>Boolean</td>\n<td>如果为<code>true</code>，则将其<code>display</code>属性置为<code>none</code>（而不是从 dom 中移除这个节点）</td>\n</tr>\n<tr>\n<td>reverse</td>\n<td>Boolean</td>\n<td>如果为<code>true</code>，则展示逻辑与正常相反，即无权限时展示该节点，有权限时移除这个节点</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"传入布尔值\"><a href=\"#传入布尔值\" class=\"headerlink\" title=\"传入布尔值\"></a>传入布尔值</h3><p>如果传入的是一个布尔值且该布尔值为<code>false</code>，则移除这个 DOM。作用同<code>v-if</code>。</p>\n<hr>\n<h2 id=\"fCheckAuth-方法\"><a href=\"#fCheckAuth-方法\" class=\"headerlink\" title=\"fCheckAuth()方法\"></a>fCheckAuth()方法</h2><p>使用<code>this.fCheckAuth(auth)</code>方法判断当前是否有<code>auth</code>权限，<code>auth</code>参数同<code>v-auth</code>自定义指令接收的字符串参数。</p>\n<p>注意，这是一个异步方法。使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> valid = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.fCheckAuth(<span class=\"string\">'bill.CONFIRM_OFFLINE_PAYMENT'</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span> (valid) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>或者</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.fCheckAuth(<span class=\"string\">'bill.CONFIRM_OFFLINE_PAYMENT'</span>).then(<span class=\"function\"><span class=\"params\">valid</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (valid) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>判断是否具有相关权限。</p>\n","tags":["前端","开发文档"]},{"title":"元素水平垂直居中","url":"/2017/07/09/%E5%85%83%E7%B4%A0%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E5%B1%85%E4%B8%AD/","content":"<ul>\n<li><a href=\"#1\">方法一：position加margin</a></li>\n<li><a href=\"#2\">方法二： diaplay:table-cell</a></li>\n<li><a href=\"#3\">方法三：position加 transform</a></li>\n<li><a href=\"#4\">方法四：flex;align-items: center;justify-content: center</a></li>\n<li><a href=\"#5\">方法五：display:flex;margin:auto</a></li>\n<li><a href=\"#6\">方法六：transfer -50%</a></li>\n<li><a href=\"#7\">方法七：兼容低版本浏览器，不固定宽高</a></li>\n</ul>\n<h4 id=\"示例图\"><a href=\"#示例图\" class=\"headerlink\" title=\"示例图\"></a>示例图</h4><p><img src=\"http://vky-test-oss.inboyu.com/upload/39e79077-c1de-6d5b-a697-c17158ad3ada.png\" alt=\"示例图\"></p>\n<p><span id=\"1\"></span></p>\n<h4 id=\"1-position加margin\"><a href=\"#1-position加margin\" class=\"headerlink\" title=\"1.position加margin\"></a>1.position加margin</h4><p>父元素和子元素高宽都固定，使用绝对定位的方法居中<br><figure class=\"highlight dts\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**html**/</span></span><br><span class=\"line\"><span class=\"params\">&lt;div class=\"parent\"&gt;</span></span><br><span class=\"line\">    <span class=\"params\">&lt;div class=\"child\"&gt;</span><span class=\"params\">&lt;/div&gt;</span></span><br><span class=\"line\"><span class=\"params\">&lt;/div&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**css**/</span></span><br><span class=\"line\">.<span class=\"class\">parent </span>&#123;</span><br><span class=\"line\"><span class=\"symbol\">    width:</span> <span class=\"number\">200</span>px;</span><br><span class=\"line\"><span class=\"symbol\">    height:</span> <span class=\"number\">200</span>px;</span><br><span class=\"line\"><span class=\"symbol\">    background:</span> yellow;</span><br><span class=\"line\"><span class=\"symbol\">    position:</span> relative;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">.<span class=\"class\">child </span>&#123;</span><br><span class=\"line\"><span class=\"symbol\">    width:</span> <span class=\"number\">100</span>px;</span><br><span class=\"line\"><span class=\"symbol\">    height:</span> <span class=\"number\">100</span>px;</span><br><span class=\"line\"><span class=\"symbol\">    background:</span> green;</span><br><span class=\"line\"><span class=\"symbol\">    margin:</span> auto;</span><br><span class=\"line\"><span class=\"symbol\">    position:</span> absolute;</span><br><span class=\"line\"><span class=\"symbol\">    left:</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"symbol\">    right:</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"symbol\">    top:</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"symbol\">    bottom:</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><span id=\"2\"></span></p>\n<h4 id=\"2-display-tabel-cell\"><a href=\"#2-display-tabel-cell\" class=\"headerlink\" title=\"2.display:tabel-cell\"></a>2.display:tabel-cell</h4><p>父元素必须为tabel-cell，子元素必须为display：inline-block</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- <span class=\"selector-tag\">html</span> --&gt;</span><br><span class=\"line\">&lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"parent\"</span>&gt;</span><br><span class=\"line\">     &lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"child\"</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*css*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: yellow;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">.child&#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: green;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><span id=\"3\"></span></p>\n<h4 id=\"3-position加-transform\"><a href=\"#3-position加-transform\" class=\"headerlink\" title=\"3.position加 transform\"></a>3.position加 transform</h4><p>不需要考虑父元素的高宽，可以做自适应，但是子元素的高宽必须限定</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- <span class=\"selector-tag\">html</span> --&gt;</span><br><span class=\"line\">&lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"parent\"</span>&gt;</span><br><span class=\"line\">    &lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"child\"</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">/* css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parentss</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: yellow;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: green;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>:<span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>:<span class=\"number\">50%</span>;</span><br><span class=\"line\">    -webkit-<span class=\"attribute\">transform</span>:translate(-<span class=\"number\">50%</span>,-<span class=\"number\">50%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>:translate(-<span class=\"number\">50%</span>,-<span class=\"number\">50%</span>);</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><span id=\"4\"></span></p>\n<h4 id=\"4-flex-alige-item-center-justify-content-center\"><a href=\"#4-flex-alige-item-center-justify-content-center\" class=\"headerlink\" title=\"4.flex;alige-item:center;justify-content: center\"></a>4.flex;alige-item:center;justify-content: center</h4><p>子元素和父元素都无需限定高宽，移动端兼容性良好</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- <span class=\"selector-tag\">html</span> --&gt;</span><br><span class=\"line\">&lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"parent\"</span>&gt;</span><br><span class=\"line\">    &lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"child\"</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: yellow;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: flex; </span><br><span class=\"line\">    <span class=\"attribute\">align-items</span>: center; </span><br><span class=\"line\">    <span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: green;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">100px</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><span id=\"5\"></span></p>\n<h4 id=\"5-display-flex-margin-auto\"><a href=\"#5-display-flex-margin-auto\" class=\"headerlink\" title=\"5.display:flex;margin:auto\"></a>5.display:flex;margin:auto</h4><p>兼容性没测试过，移动端适用</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- html --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"parent\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"child\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">/* css */</span><br><span class=\"line\">.parent &#123;</span><br><span class=\"line\">    background: yellow;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 200px;</span><br><span class=\"line\">    display: flex; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.child &#123;</span><br><span class=\"line\">    background: green;</span><br><span class=\"line\">    width: 100px;</span><br><span class=\"line\">    height: 100px;</span><br><span class=\"line\">    margin: auto;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><span id=\"6\"></span></p>\n<h4 id=\"6-tranfer-50\"><a href=\"#6-tranfer-50\" class=\"headerlink\" title=\"6.tranfer -50%\"></a>6.tranfer -50%</h4><p>百分比来设置宽高</p>\n<figure class=\"highlight scss\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//vertical center</span></span><br><span class=\"line\"><span class=\"selector-class\">.vertical-center</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span> absolute</span><br><span class=\"line\">  <span class=\"attribute\">top</span> 50%</span><br><span class=\"line\">  <span class=\"attribute\">transform</span> translate(0,-50%)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.vertical-horizontal</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">position</span> absolute</span><br><span class=\"line\">  <span class=\"attribute\">left</span> 50%</span><br><span class=\"line\">  <span class=\"attribute\">top</span> 50%</span><br><span class=\"line\">  <span class=\"attribute\">transform</span> translate(-50%,-50%)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- <span class=\"selector-tag\">html</span> --&gt;</span><br><span class=\"line\">&lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"parent\"</span>&gt;</span><br><span class=\"line\">    &lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"child\"</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* css */</span></span><br><span class=\"line\"><span class=\"selector-class\">.parent</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.child</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>:<span class=\"number\">50%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>:<span class=\"number\">30%</span>;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>:<span class=\"number\">20px</span>;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>:center;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>:<span class=\"number\">#393</span>;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>:<span class=\"number\">#fff</span>;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate(-<span class=\"number\">50%</span>, -<span class=\"number\">50%</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><span id=\"7\"><span></span></span></p>\n<h4 id=\"7-高宽不定\"><a href=\"#7-高宽不定\" class=\"headerlink\" title=\"7.高宽不定\"></a>7.高宽不定</h4><figure class=\"highlight stylus\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- <span class=\"selector-tag\">html</span> --&gt;</span><br><span class=\"line\">&lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"table\"</span>&gt;</span><br><span class=\"line\">    &lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"tableCell\"</span>&gt;</span><br><span class=\"line\">        &lt;<span class=\"selector-tag\">div</span> class=<span class=\"string\">\"content\"</span>&gt;不固定宽高，自适应&lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\">/*css*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.table</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">200px</span>;<span class=\"comment\">/*高度值不能少*/</span></span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">200px</span>;<span class=\"comment\">/*宽度值不能少*/</span></span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: relative;</span><br><span class=\"line\">    <span class=\"attribute\">float</span>:left;</span><br><span class=\"line\">    <span class=\"attribute\">background</span>: yellow;</span><br><span class=\"line\">&#125;      </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"selector-class\">.tableCell</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">display</span>: table-cell;</span><br><span class=\"line\">    <span class=\"attribute\">vertical-align</span>: middle;</span><br><span class=\"line\">    <span class=\"attribute\">text-align</span>: center;        </span><br><span class=\"line\">    *<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">10px</span>;</span><br><span class=\"line\">    *<span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">    *<span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.content</span> &#123;</span><br><span class=\"line\">    *<span class=\"attribute\">position</span>:relative;</span><br><span class=\"line\">    *<span class=\"attribute\">top</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">    *<span class=\"attribute\">left</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">     <span class=\"attribute\">background</span>: green;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","tags":["移动开发"]},{"title":"图片或背景实现等比自适应缩放","url":"/2019/01/26/%E5%9B%BE%E7%89%87%E6%88%96%E8%83%8C%E6%99%AF%E5%AE%9E%E7%8E%B0%E7%AD%89%E6%AF%94%E8%87%AA%E9%80%82%E5%BA%94%E7%BC%A9%E6%94%BE/","content":"<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>React App<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    body &#123;</span><br><span class=\"line\">      margin: 0px;</span><br><span class=\"line\">      padding: 0px;</span><br><span class=\"line\"><span class=\"css\">      <span class=\"selector-tag\">background-color</span>: <span class=\"selector-id\">#f8f6f7</span>;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.ly-container</span> &#123;</span></span><br><span class=\"line\">      display: flex;</span><br><span class=\"line\">      flex-wrap: wrap;</span><br><span class=\"line\">      justify-content: space-between;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.ly-temp-item</span> &#123;</span></span><br><span class=\"line\">      width: 23%;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.ly-temp-bodyer</span> &#123;</span></span><br><span class=\"line\">      overflow: hidden;</span><br><span class=\"line\">      position: relative;</span><br><span class=\"line\">      border-radius: 8px;</span><br><span class=\"line\">      padding-bottom: calc(1500% / 11);</span><br><span class=\"line\">      background-color: white;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.ly-temp-image</span> &#123;</span></span><br><span class=\"line\">      top: 0px;</span><br><span class=\"line\">      left: 0px;</span><br><span class=\"line\">      right: 0px;</span><br><span class=\"line\">      bottom: 0px;</span><br><span class=\"line\">      position: absolute;</span><br><span class=\"line\">      margin-bottom: 5%;</span><br><span class=\"line\">      background-size: 100%;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-class\">.ly-temp-footer</span> &#123;</span></span><br><span class=\"line\">      font-size: 14px;</span><br><span class=\"line\">      margin-top: 8px;</span><br><span class=\"line\">      text-align: center;</span><br><span class=\"line\">      line-height: 24px;</span><br><span class=\"line\">      margin-bottom: 8px;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/1.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/2.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/3.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/4.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/5.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/6.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/7.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-item\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-image\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"background-image: url(./image/8.png);\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ly-temp-footer\"</span>&gt;</span>标题1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","tags":["前端","学习"]},{"title":"学习单元测试 - Jest","url":"/2018/05/04/%E5%AD%A6%E4%B9%A0%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%20-%20Jest/","content":"<p>现在系统功能趋于稳定，想着接入单元测试使用一下。尝试着为公共组件和公共方法编写覆盖全面的单元测试。</p>\n<h1 id=\"Jest\"><a href=\"#Jest\" class=\"headerlink\" title=\"Jest\"></a>Jest</h1><p>vue-cli 自带Jest,开箱即用。在根目录中创建一个名为 jest.config.js 的配置文件。<a href=\"https://doc.ebichu.cc/jest/docs/zh-Hans/configuration.html\" target=\"_blank\" rel=\"noopener\">配置文档</a></p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">module</span>.<span class=\"keyword\">exports</span> = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 文件后缀</span></span><br><span class=\"line\">  moduleFileExtensions: [<span class=\"string\">'js'</span>, <span class=\"string\">'jsx'</span>, <span class=\"string\">'json'</span>, <span class=\"string\">'vue'</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 文件如何转换</span></span><br><span class=\"line\">  transform: &#123;</span><br><span class=\"line\">    <span class=\"string\">'^.+\\\\.vue$'</span>: <span class=\"string\">'vue-jest'</span>,</span><br><span class=\"line\">    <span class=\"string\">'.+\\\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$'</span>:</span><br><span class=\"line\">      <span class=\"string\">'jest-transform-stub'</span>,</span><br><span class=\"line\">    <span class=\"string\">'^.+\\\\.jsx?$'</span>: <span class=\"string\">'babel-jest'</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// 忽略的文件</span></span><br><span class=\"line\">  transformIgnorePatterns: [<span class=\"string\">'/node_modules/'</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 生成快照需要的插件</span></span><br><span class=\"line\">  snapshotSerializers: [<span class=\"string\">'jest-serializer-vue'</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 需要执行哪些目录下的测试用例</span></span><br><span class=\"line\">  testMatch: [</span><br><span class=\"line\">    <span class=\"string\">'**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)'</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"comment\">// 在执行用例前的配置文件</span></span><br><span class=\"line\">  setupFiles: [<span class=\"string\">'./tests/setup.js'</span>],</span><br><span class=\"line\">  <span class=\"comment\">// 测试覆盖率配置</span></span><br><span class=\"line\">  collectCoverage: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">  coverageReporters: [<span class=\"string\">'html'</span>, <span class=\"string\">'lcov'</span>, <span class=\"string\">'text-summary'</span>],</span><br><span class=\"line\">  coverageDirectory: <span class=\"string\">'./test/coverage'</span>,</span><br><span class=\"line\">  collectCoverageFrom: [<span class=\"string\">'components/**/*.vue'</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>安装<br><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">vue <span class=\"keyword\">add</span><span class=\"bash\"> unit-jest</span></span><br></pre></td></tr></table></figure></p>\n<h1 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h1><p>断言、异步代码测试、Mock 函数、快照<a href=\"https://jestjs.io/docs/zh-Hans/expect\" target=\"_blank\" rel=\"noopener\">参考文档</a></p>\n<p>异步获取数据肯定是一个常见场景了。异步代码通常会有两种写法，分别为：</p>\n<ul>\n<li>回调函数</li>\n<li>函数返回 promise</li>\n</ul>\n<p>在测试异步代码的时候，通常返回的数据是不确定的，因此我们只需要测试异步代码是否正常返回数据即可。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 回调函数的写法，通过 done 来让测试代码一直等待</span></span><br><span class=\"line\">test(<span class=\"string\">'fetch success'</span>, <span class=\"function\"><span class=\"params\">done</span> =&gt;</span> &#123;</span><br><span class=\"line\">  fetch(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">    expect(data.success).toBe(<span class=\"literal\">true</span>)</span><br><span class=\"line\">    done()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// 函数返回 promise 的写法，注意要加上 return</span></span><br><span class=\"line\"><span class=\"comment\">// 当然对于返回 promise 的函数我们也可以直接使用 await</span></span><br><span class=\"line\">test(<span class=\"string\">'fetch success'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fetch().then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">    expect(data.success).toBe(<span class=\"literal\">true</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h1 id=\"实践\"><a href=\"#实践\" class=\"headerlink\" title=\"实践\"></a>实践</h1><p>单元测试case部署在<code>tests/unit</code>文件夹中，使用<code>Jest</code>编写。可以测试引入的公共方法，也可以测试一个单文件组件。建议按照代码组织结构来编写对应的单元测试case。</p>\n<p>使用<code>npm run unit</code>来运行单元测试，测试结果会在命令行中显示。在构建<strong>测试环境</strong>的时候会自动运行单元测试，如果单元测试存在未通过的case，则构建会失败并终止。构建beta环境和生产环境暂时不会运行单元测试。</p>\n<p>一个简单的关于为数字加入千位分隔符的方法的单元测试：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">describe(<span class=\"string\">'Utils suits'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  it(<span class=\"string\">'should add commas for numbers'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> fn = Utils.addNumberCommas</span><br><span class=\"line\">    expect(fn(<span class=\"number\">123</span>)).toBe(<span class=\"string\">'123'</span>)</span><br><span class=\"line\">    expect(fn(<span class=\"number\">12345</span>)).toBe(<span class=\"string\">'12,345'</span>)</span><br><span class=\"line\">    expect(fn(<span class=\"number\">1234567.89</span>)).toBe(<span class=\"string\">'1,234,567.89'</span>)</span><br><span class=\"line\">    expect(fn(<span class=\"number\">-1234567.89</span>)).toBe(<span class=\"string\">'-1,234,567.89'</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>输出示例：<br><img src=\"http://xiaobokeji-test.oss-cn-shenzhen.aliyuncs.com/upload/39f20ba0-fd66-fe24-8be1-fd8e5701ca49/npmrununit.png\" alt=\"image\"></p>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"https://jestjs.io/\" target=\"_blank\" rel=\"noopener\">Jest</a></li>\n<li><a href=\"https://cn.vuejs.org/v2/guide/unit-testing.html\" target=\"_blank\" rel=\"noopener\">Vue单元测试</a></li>\n<li><a href=\"https://vue-test-utils.vuejs.org/zh/\" target=\"_blank\" rel=\"noopener\">Vue_Test_Utils</a></li>\n</ul>\n","tags":["前端","学习","单元测试"]},{"title":"宏任务还是微任务？","url":"/2021/04/26/%E5%AE%8F%E4%BB%BB%E5%8A%A1%E8%BF%98%E6%98%AF%E5%BE%AE%E4%BB%BB%E5%8A%A1%EF%BC%9F/","content":"<h4 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h4><p>我们都知道js是一个单线程，里面的的请求方式分为两种，一种是同步请求，一种是异步请求，同步方法先执行完毕，然后再去异步任务队列中查看有没有异步任务，有才会执行。</p>\n<p>在JavaScript中，所有的任务都可以分为</p>\n<p>同步任务：立即执行的任务，同步任务一般会直接进入到主线程中执行</p>\n<p>异步任务：异步执行的任务，比如<code>ajax</code>网络请求，<code>setTimeout</code>定时函数等</p>\n<h4 id=\"常见的宏任务\"><a href=\"#常见的宏任务\" class=\"headerlink\" title=\"常见的宏任务\"></a>常见的宏任务</h4><p><code>script</code>、<code>setTimeout</code>、<code>setInterval</code>、<code>setImmediate</code></p>\n<h4 id=\"常见的微任务\"><a href=\"#常见的微任务\" class=\"headerlink\" title=\"常见的微任务\"></a>常见的微任务</h4><p>一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前</p>\n<p><code>Promise</code>中的then、async、await、<code>process.nextTick</code>（Node.js）、<code>MutationObserver</code>（监听DOM变化的事件）、<code>Object.observe</code>（已废弃；Proxy 对象替代）</p>\n<p>关于两者之间的区别：微任务是批量执行、宏任务则是一个一个的执行。</p>\n<ul>\n<li>执行一个宏任务，如果遇到微任务就将它放到微任务的事件队列中</li>\n<li>当前宏任务执行完成后，会查看微任务的事件队列，然后将里面的所有微任务依次执行完</li>\n</ul>\n<p>这里我们可以看到，script标签包含的下面的代码块，那么这就属于是第一个异步任务，也就是宏任务，首先去执行它</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>) </span></span><br><span class=\"line\"><span class=\"actionscript\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span> </span>&#123; </span></span><br><span class=\"line\"><span class=\"javascript\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>)</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve</span>) </span>&#123; </span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>);  </span></span><br><span class=\"line\">        resolve();</span><br><span class=\"line\"><span class=\"actionscript\">    &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span> </span>&#123; </span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>)</span></span><br><span class=\"line\"><span class=\"actionscript\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'5'</span>) </span></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'6'</span>); </span></span><br><span class=\"line\">            resolve();</span><br><span class=\"line\"><span class=\"actionscript\">        &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">             <span class=\"built_in\">console</span>.log(<span class=\"string\">'7'</span>)</span></span><br><span class=\"line\"><span class=\"actionscript\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span> </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'8'</span>) </span></span><br><span class=\"line\">        &#125;); </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight coffeescript\"><table><tr><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">new</span> Promise(<span class=\"function\"><span class=\"params\">(resolve, reject)</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">&#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">new</span> Promise(<span class=\"function\"><span class=\"params\">(resolve, reject)</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">        resolve()</span><br><span class=\"line\">    &#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">    &#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">6</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">new</span> Promise(<span class=\"function\"><span class=\"params\">(resolve, reject)</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">7</span>)</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">&#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">8</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">172384650</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight coffeescript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"keyword\">new</span> Promise(<span class=\"function\"><span class=\"params\">(resolve, reject)</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">    setTimeout(() = &gt;&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">&#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">6</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">1</span>，<span class=\"number\">2</span>，<span class=\"number\">6</span>，<span class=\"number\">4</span>，<span class=\"number\">3</span>，<span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>) </span><br><span class=\"line\">    setTimeout(function () &#123; </span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">new</span> Promise(function (resolve) &#123; </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>);  </span><br><span class=\"line\">        resolve();</span><br><span class=\"line\">    &#125;).<span class=\"keyword\">then</span>(function () &#123; </span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>)</span><br><span class=\"line\">        setTimeout(function () &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'5'</span>) </span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">new</span> Promise(function (resolve) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'6'</span>); </span><br><span class=\"line\">            resolve();</span><br><span class=\"line\">        &#125;).<span class=\"keyword\">then</span>(function () &#123;</span><br><span class=\"line\">             <span class=\"built_in\">console</span>.log(<span class=\"string\">'7'</span>)</span><br><span class=\"line\">        setTimeout(function () &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'8'</span>) </span><br><span class=\"line\">        &#125;); </span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">9</span>)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">136947258</span></span><br><span class=\"line\"></span><br><span class=\"line\">let promise = <span class=\"keyword\">new</span> Promise(resolve=&gt;&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">        resolve();</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'1'</span>)</span><br><span class=\"line\">    &#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'2'</span>)</span><br><span class=\"line\">&#125;).<span class=\"keyword\">then</span>(value=&gt;<span class=\"built_in\">console</span>.log(<span class=\"string\">'3'</span>))</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'4'</span>)</span><br><span class=\"line\"><span class=\"number\">2413</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>) <span class=\"regexp\">//</span> 遇到 <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>) ，直接打印 <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"regexp\">//</span> 遇到定时器，属于新的宏任务，留着后面执行</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"regexp\">//</span> 遇到 <span class=\"keyword\">new</span> Promise，这个是直接执行的，打印 <span class=\"string\">'new Promise'</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> Promise(<span class=\"function\"><span class=\"params\">(resolve, reject)</span>=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'new Promise'</span>)</span><br><span class=\"line\">    resolve()</span><br><span class=\"line\">&#125;).<span class=\"keyword\">then</span>(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123; <span class=\"regexp\">//</span> .<span class=\"keyword\">then</span> 属于微任务，放入微任务队列，后面再执行</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'then'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>) <span class=\"regexp\">//</span> 遇到 <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>) 直接打印 <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"regexp\">//</span> 好了本轮宏任务执行完毕，现在去微任务列表查看是否有微任务，发现 .<span class=\"keyword\">then</span> 的回调，执行它，打印 <span class=\"string\">'then'</span></span><br><span class=\"line\"><span class=\"regexp\">//</span> 当一次宏任务执行完，再去执行新的宏任务，这里就剩一个定时器的宏任务了，执行它，打印 <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">实际结果是：<span class=\"number\">1</span>=&gt;<span class=\"string\">'new Promise'</span>=&gt; <span class=\"number\">3</span> =&gt; <span class=\"string\">'then'</span> =&gt; <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>同步&gt;微任务&gt;宏任务</p>\n<h4 id=\"async与await\"><a href=\"#async与await\" class=\"headerlink\" title=\"async与await\"></a>async与await</h4><p><code>async</code> 是异步的意思，<code>await</code>则可以理解为 <code>async wait</code>。所以可以理解<code>async</code>就是用来声明一个异步方法，而 <code>await</code>是用来等待异步方法执行</p>\n<p><code>async</code>函数返回一个<code>promise</code>对象，下面两种方法是等效的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(<span class=\"string\">'TEST'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// asyncF is equivalent to f!</span></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">asyncF</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'TEST'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>正常情况下，<code>await</code>命令后面是一个 <code>Promise</code>对象，返回该对象的结果。如果不是 <code>Promise</code>对象，就直接返回对应的值。不管<code>await</code>后面跟着的是什么，<code>await</code>都会阻塞后面的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn1</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">await</span> fn2()</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>) <span class=\"comment\">// 阻塞</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn2</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'fn2'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fn1()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br></pre></td></tr></table></figure>\n<p>上面的例子中，<code>await</code>会阻塞下面的代码（即加入微任务队列），先执行 <code>async</code>外面的同步代码，同步代码执行完，再回到 <code>async</code> 函数中，再执行之前阻塞的代码</p>\n<p>所以上述输出结果为：<code>1，fn2，3，2</code></p>\n<p>参考文章</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/weixin_48389576/article/details/112210861\" target=\"_blank\" rel=\"noopener\">宏任务微任务</a></li>\n<li><a href=\"https://vue3js.cn/interview/JavaScript/event_loop.html#%E4%B8%89%E3%80%81async%E4%B8%8Eawait\" target=\"_blank\" rel=\"noopener\">事件循环</a></li>\n</ul>\n","tags":["前端","学习"]},{"title":"手写一个带有并发限制的异步调度器","url":"/2020/06/29/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E5%B8%A6%E6%9C%89%E5%B9%B6%E5%8F%91%E9%99%90%E5%88%B6%E7%9A%84%E5%BC%82%E6%AD%A5%E8%B0%83%E5%BA%A6%E5%99%A8/","content":"<figure class=\"highlight typescript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  并发限制</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> Schedule &#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.waitList = [] <span class=\"comment\">// 异步任务等待队列</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.execList = [] <span class=\"comment\">// 异步任务执行队列</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.maxNum = <span class=\"number\">2</span>  <span class=\"comment\">//最大并发数量</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 添加异步任务</span></span><br><span class=\"line\">    add(callback) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 先判断异步任务执行队列长度</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.execList.length &lt; <span class=\"keyword\">this</span>.maxNum) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//如果执行队列数量小于最大并发数量，则将该队列放入异步执行队列</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.execList.push(callback)</span><br><span class=\"line\">            <span class=\"comment\">// 并执行该任务</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.run(callback)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 否则将该任务放入等待队列</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.waitList.push(callback)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 执行异步任务</span></span><br><span class=\"line\">    run(callback) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> len = <span class=\"keyword\">this</span>.execList.length</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = len - <span class=\"number\">1</span> <span class=\"comment\">//获取当前正在执行的异步任务的索引</span></span><br><span class=\"line\">        <span class=\"comment\">// 执行该异步任务</span></span><br><span class=\"line\">        callback().then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 执行完将该任务移出执行队列</span></span><br><span class=\"line\">            <span class=\"keyword\">this</span>.execList.splice(index, <span class=\"number\">1</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 再判断等待队列是否还有异步任务</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span>.waitList.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.run(<span class=\"keyword\">this</span>.waitList.shift())</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> timeout = <span class=\"function\"><span class=\"params\">time</span> =&gt;</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    setTimeout(resolve, time)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> schedule = <span class=\"keyword\">new</span> Schedule()</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTask</span>(<span class=\"params\">time, index</span>) </span>&#123;</span><br><span class=\"line\">    schedule.add(</span><br><span class=\"line\">        ()=&gt;timeout(time).then(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(index, +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()))</span><br><span class=\"line\">    )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">addTask(<span class=\"number\">1000</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">addTask(<span class=\"number\">500</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">addTask(<span class=\"number\">300</span>, <span class=\"number\">3</span>)</span><br><span class=\"line\">addTask(<span class=\"number\">400</span>, <span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2,3,1,4</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 先任务1进执行队列，任务1开始执行，接着任务2进执行队列，任务2开始执行</span></span><br><span class=\"line\"><span class=\"comment\"> * 接着任务3进等待队列，任务4进等待队列。时间到了500ms，打印出2，任务2移出执行队列</span></span><br><span class=\"line\"><span class=\"comment\"> * 任务3进执行队列，此时时间到了（500+300）800ms，打印出3，任务3移出执行队列</span></span><br><span class=\"line\"><span class=\"comment\"> * 任务4进执行队列，此时时间到了1000ms，打印出1，任务1移出执行队列</span></span><br><span class=\"line\"><span class=\"comment\"> * 等待队列没有任务了，此时时间到了（800+400）1200ms，打印出4</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure>\n<p>最近看到一道<a href=\"https://github.com/mqyqingfeng/Blog/issues/98\" target=\"_blank\" rel=\"noopener\">面试题</a>，题目如下：</p>\n<blockquote>\n<p>红灯三秒亮一次，绿灯一秒亮一次，黄灯2秒亮一次；如何让三个灯不断交替重复亮灯？（用 Promise 实现）</p>\n</blockquote>\n<p>三个亮灯函数已经存在：<br><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">red</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'red'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">green</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'green'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">yellow</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'yellow'</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>利用 then 和递归实现：<br><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">red</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'red'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">green</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'green'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">yellow</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'yellow'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> lightUp = <span class=\"function\">(<span class=\"params\">timmer, callback</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">            callback();</span><br><span class=\"line\">            resolve();</span><br><span class=\"line\">        &#125;, timmer);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> trafficStep = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Promise</span>.resolve()</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> light(<span class=\"number\">3000</span>, red);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> light(<span class=\"number\">2000</span>, green);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> light(<span class=\"number\">1000</span>, yellow);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">     .then(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        trafficStep(); <span class=\"comment\">// 执行完毕后，递归执行</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">trafficStep()</span><br></pre></td></tr></table></figure></p>\n<p>执行效果如图所示<br><img src=\"https://img-blog.csdnimg.cn/eafb393645054d2dbaa5b10951636cf2.gif\" alt=\"image\"></p>\n","tags":["前端","面试"]},{"title":"手写节流函数和防抖函数","url":"/2019/08/13/%E6%89%8B%E5%86%99%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0%E5%92%8C%E9%98%B2%E6%8A%96%E5%87%BD%E6%95%B0/","content":"<h4 id=\"函数节流\"><a href=\"#函数节流\" class=\"headerlink\" title=\"函数节流\"></a>函数节流</h4><p>不断触发一个函数后，执行第一次，只有大于设定的执行周期后才会执行第二次</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            节流函数：fn:要被节流的函数，delay：规定的时间</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">       <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">fn,delay</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 记录上一次函数出发的时间</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> lastTime = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 记录当前函数触发的时间</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> nowTime = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()</span><br><span class=\"line\">            <span class=\"comment\">// 当当前时间减去上一次执行时间大于这个指定间隔时间才让他触发这个函数</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(nowTime - lastTime &gt; delay)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 绑定this指向</span></span><br><span class=\"line\">                fn.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">                <span class=\"comment\">//同步时间</span></span><br><span class=\"line\">                lastTime = nowTime</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"函数防抖\"><a href=\"#函数防抖\" class=\"headerlink\" title=\"函数防抖\"></a>函数防抖</h4><p>不断触发一个函数，在规定时间内只让最后一次生效，前面都不生效</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">fn,delay</span>)</span>&#123;</span><br><span class=\"line\">           <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span></span><br><span class=\"line\">        <span class=\"comment\">//  清除上一次延时器</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">               clearTimeout(timer)</span><br><span class=\"line\">              <span class=\"comment\">//  重新设置一个新的延时器</span></span><br><span class=\"line\">              timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                  fn.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">              &#125;, delay);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>","tags":["前端","面试"]},{"title":"手动实现all、bind、apply","url":"/2017/09/23/%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0all%E3%80%81bind%E3%80%81apply/","content":"<h6 id=\"call\"><a href=\"#call\" class=\"headerlink\" title=\"call\"></a>call</h6><p>原生call</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(arg1, arg2)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a, <span class=\"keyword\">this</span>.b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">run.call(&#123;</span><br><span class=\"line\">  a: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  b: <span class=\"string\">'b'</span></span><br><span class=\"line\">&#125;, <span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n<p>在实现的过程有个关键：</p>\n<p>如果一个函数作为一个对象的属性，那么通过对象的.运算符调用此函数，<strong>this</strong> 就是此对象</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  b: <span class=\"string\">'b'</span>,</span><br><span class=\"line\">  test: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arg1, arg2)</span><br><span class=\"line\">    <span class=\"comment\">// this.a 就是 a; this.b 就是 b</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a, <span class=\"keyword\">this</span>.b) </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">obj.test(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n<h6 id=\"手动模拟call\"><a href=\"#手动模拟call\" class=\"headerlink\" title=\"手动模拟call\"></a>手动模拟call</h6><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.call2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'Error'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 默认上下文是window</span></span><br><span class=\"line\">  context = context || <span class=\"built_in\">window</span></span><br><span class=\"line\">  <span class=\"comment\">// 保存默认的fn</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; fn &#125; = context</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 前面讲的关键，将函数本身作为对象context的属性调用，自动绑定this</span></span><br><span class=\"line\">  context.fn = <span class=\"keyword\">this</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> args = [...arguments].slice(<span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = context.fn(...args)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 恢复默认的fn</span></span><br><span class=\"line\">  context.fn = fn</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 以下是测试代码</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(arg1, arg2)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a, <span class=\"keyword\">this</span>.b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">test.call2(&#123;</span><br><span class=\"line\">  a: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  b: <span class=\"string\">'b'</span></span><br><span class=\"line\">&#125;, <span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n<h6 id=\"bind\"><a href=\"#bind\" class=\"headerlink\" title=\"bind\"></a>bind</h6><p><code>bind</code>有两个特点：</p>\n<ul>\n<li>本身返回一个全新的函数，所以需要考虑new的清空</li>\n<li>可以保留参数，内部实现了参数的拼接</li>\n</ul>\n<figure class=\"highlight qml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.bind2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'Error'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">  <span class=\"comment\">// 保留之前的参数，为了下面的参数拼接</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> args = [...arguments].slice(<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 如果被new创建实例，不会被改变上下文！</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> F) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> that(...args, ...arguments)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">// args.concat(...arguments): 拼接之前和现在的参数</span></span><br><span class=\"line\">    <span class=\"comment\">// 注意：arguments是个类Array的Object, 用解构运算符..., 直接拿值拼接</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(context, args.concat(...arguments))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 以下是测试代码</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(arg1, arg2)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a, <span class=\"keyword\">this</span>.b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> test2 = test.bind2(&#123;</span><br><span class=\"line\">  <span class=\"attribute\">a</span>: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  <span class=\"attribute\">b</span>: <span class=\"string\">'b'</span></span><br><span class=\"line\">&#125;, <span class=\"number\">1</span>) <span class=\"comment\">// 参数 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">test2(<span class=\"number\">2</span>) <span class=\"comment\">// 参数 2</span></span><br></pre></td></tr></table></figure>\n<h6 id=\"apply\"><a href=\"#apply\" class=\"headerlink\" title=\"apply\"></a>apply</h6><p>apply和call实现类似，只是传入的参数形式是数组形式，而不是逗号分隔的参数序列。</p>\n<p>因此，借助es6提供的…运算符，就可以很方便的实现数组和参数序列的转化。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.apply2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'Error'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  context = context || <span class=\"built_in\">window</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; fn &#125; = context</span><br><span class=\"line\"></span><br><span class=\"line\">  context.fn = <span class=\"keyword\">this</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"built_in\">Array</span>.isArray(<span class=\"built_in\">arguments</span>[<span class=\"number\">1</span>])) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 通过...运算符将数组转换为用逗号分隔的参数序列</span></span><br><span class=\"line\">    result = context.fn(...arguments[<span class=\"number\">1</span>])</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    result = context.fn()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  context.fn = fn</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 以下是测试代码</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(arg1, arg2)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a, <span class=\"keyword\">this</span>.b)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">test.apply2(&#123;</span><br><span class=\"line\">  a: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  b: <span class=\"string\">'b'</span></span><br><span class=\"line\">&#125;, [<span class=\"number\">1</span>, <span class=\"number\">2</span>])</span><br></pre></td></tr></table></figure>\n","tags":["前端","面试"]},{"title":"操作按钮展示逻辑","url":"/2019/06/12/%E6%93%8D%E4%BD%9C%E6%8C%89%E9%92%AE%E5%B1%95%E7%A4%BA%E9%80%BB%E8%BE%91/","content":"<h4 id=\"合同申请\"><a href=\"#合同申请\" class=\"headerlink\" title=\"合同申请\"></a>合同申请</h4><ul>\n<li>接口：/contract-expend/detail</li>\n<li>status为0 default，默认为新增状态</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>按钮</th>\n<th>状态(data.detail.detail.status)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>合同归档</td>\n<td>data.detail.detail.hasFileManageTag</td>\n</tr>\n<tr>\n<td>保存</td>\n<td>0、1</td>\n</tr>\n<tr>\n<td>提交</td>\n<td>0、1</td>\n</tr>\n<tr>\n<td>发起K2审批</td>\n<td>14</td>\n</tr>\n<tr>\n<td>撤回草稿</td>\n<td>14</td>\n</tr>\n<tr>\n<td>生成付款单</td>\n<td>10</td>\n</tr>\n<tr>\n<td>结算合同</td>\n<td>10</td>\n</tr>\n<tr>\n<td>查看审批流程</td>\n<td>非0状态下都展示</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>data.detail.operation.delete</td>\n</tr>\n<tr>\n<td>作废</td>\n<td>data.detail.operation.abolish</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"合同付款单申请\"><a href=\"#合同付款单申请\" class=\"headerlink\" title=\"合同付款单申请\"></a>合同付款单申请</h4><ul>\n<li>接口：无</li>\n<li>status为0 默认为新增状态</li>\n<li>url带newId 为重新发起的单据</li>\n</ul>\n<p>区分付款方式</p>\n<table>\n<thead>\n<tr>\n<th>按钮</th>\n<th>状态(data.detail.detail.status)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>保存</td>\n<td>0、url带newId、8、10、17、24</td>\n</tr>\n<tr>\n<td>提交</td>\n<td>0、url带newId、5、8、17、24 或者invoiceType为2，且status为10</td>\n</tr>\n<tr>\n<td>发起K2审批</td>\n<td>26、27</td>\n</tr>\n<tr>\n<td>撤回草稿</td>\n<td>26</td>\n</tr>\n<tr>\n<td>冲账</td>\n<td>12、或者invoiceType为1且status为10或者19</td>\n</tr>\n<tr>\n<td>打印封面</td>\n<td>2、3、4、9、15、16、 11, 18, 20, 21, 22, 23, 25、url带newId</td>\n</tr>\n<tr>\n<td>复制&amp;重新发起</td>\n<td>25</td>\n</tr>\n<tr>\n<td>查看审批流程</td>\n<td>非0、非5、非url带newId</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>5、8、10、17、24，以上状态url不能带newId、非invoiceType为1且status为10</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"事项申请\"><a href=\"#事项申请\" class=\"headerlink\" title=\"事项申请\"></a>事项申请</h4><ul>\n<li>接口：/expend-matter/get-edit-data</li>\n<li>status为0 默认为新增状态</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>按钮</th>\n<th>状态（data.data.expenditure.status_cn）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>提交</td>\n<td>0、草稿</td>\n</tr>\n<tr>\n<td>保存</td>\n<td>0、草稿</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>0、草稿</td>\n</tr>\n<tr>\n<td>查看审批流程</td>\n<td>!= ‘草稿’ 或者 data.data.showFlag==true</td>\n</tr>\n<tr>\n<td>撤回</td>\n<td>等待审批</td>\n</tr>\n<tr>\n<td>生成付款单</td>\n<td>审批通过且data.data.expenditure.left_apply_amount大于0</td>\n</tr>\n<tr>\n<td>事项已完成</td>\n<td>审批通过</td>\n</tr>\n<tr>\n<td>作废</td>\n<td>审批通过且data.data.expenditure.invoices 小于等于0</td>\n</tr>\n<tr>\n<td>发起k2审批</td>\n<td>未发起K2审批</td>\n</tr>\n<tr>\n<td>撤回到草稿</td>\n<td>未发起K2审批</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"事项付款单\"><a href=\"#事项付款单\" class=\"headerlink\" title=\"事项付款单\"></a>事项付款单</h4><ul>\n<li>接口：/expend-matter/get-invoice-info</li>\n<li>status为0 默认为新增状态</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>按钮</th>\n<th>状态（data.data.invoiceStatus）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>提交</td>\n<td>0、url带resend、5、8、10、17、24、!(type为1和status为10)</td>\n</tr>\n<tr>\n<td>保存</td>\n<td>0、url带resend、5</td>\n</tr>\n<tr>\n<td>删除</td>\n<td>5、8、10、17、24、!(type为1和status为10)</td>\n</tr>\n<tr>\n<td>查看审批流程</td>\n<td>!= 5 或 data.data.hasK2.length</td>\n</tr>\n<tr>\n<td>打印封面</td>\n<td>0、1、2、3、4、6、7、9、11、12、13、14、15、16、18、20、21、22、23</td>\n</tr>\n<tr>\n<td>冲账</td>\n<td>type == 1 且 status 10、12、19</td>\n</tr>\n<tr>\n<td>复制&amp;重新发起</td>\n<td>25</td>\n</tr>\n<tr>\n<td>发起k2审批</td>\n<td>26、27</td>\n</tr>\n<tr>\n<td>撤回草稿</td>\n<td>26</td>\n</tr>\n</tbody>\n</table>\n","tags":["工作笔记"]},{"title":"计算请假小时的时长","url":"/2022/07/01/%E8%AE%A1%E7%AE%97%E8%AF%B7%E5%81%87%E5%B0%8F%E6%97%B6%E7%9A%84%E6%97%B6%E9%95%BF/","content":"<p>最近有一个需求，选择两个日期后，计算请假总的小时数</p>\n<p>要求：</p>\n<ol>\n<li>日期之间如果有法定节假日，需要剔除计算</li>\n<li>已设置的非考勤时间段，需要剔除计算</li>\n<li>只统计请假日期范围内需要出勤的时间总和</li>\n</ol>\n<p>举例：</p>\n<p>请假10月1日至10月10日，其中10月1日至10月7日为法定节假日，10月8日、10月9日、10月10日为考勤日期，考勤时间段为9:00-12:00， 13:00-18:00，由此可得请假小时为24个小时</p>\n<p>思考：</p>\n<p>因为考勤时间可能存在多个时间段和多个筛选日期条件</p>\n<p>先统计出需要出勤的日期，计算出全部工作小时，再遍历法定节假日数组，剔除法定节假日的工作小时</p>\n<p>demo如下：</p>\n<h4 id=\"参考api\"><a href=\"#参考api\" class=\"headerlink\" title=\"参考api\"></a>参考api</h4><p><a href=\"http://www.apihubs.cn/#/holiday\" target=\"_blank\" rel=\"noopener\">节假日api，依据条件进行筛选</a></p>\n<h5 id=\"数据结构\"><a href=\"#数据结构\" class=\"headerlink\" title=\"数据结构\"></a>数据结构</h5><figure class=\"highlight subunit\"><table><tr><td class=\"code\"><pre><span class=\"line\">return &#123;</span><br><span class=\"line\">     // 法定节假日</span><br><span class=\"line\">     festival: [\"2018<span class=\"string\">-12</span><span class=\"string\">-30</span>\", \"2018<span class=\"string\">-12</span><span class=\"string\">-31</span>\", \"2019<span class=\"string\">-01</span><span class=\"string\">-01</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-03</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-04</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-05</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-06</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-07</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-08</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-09</span>\",</span><br><span class=\"line\">       \"2019<span class=\"string\">-02</span><span class=\"string\">-10</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-11</span>\", \"2019<span class=\"string\">-04</span><span class=\"string\">-05</span>\", \"2019<span class=\"string\">-04</span><span class=\"string\">-06</span>\", \"2019<span class=\"string\">-04</span><span class=\"string\">-07</span>\", \"2019<span class=\"string\">-05</span><span class=\"string\">-01</span>\", \"2019<span class=\"string\">-05</span><span class=\"string\">-02</span>\", \"2019<span class=\"string\">-05</span><span class=\"string\">-03</span>\", \"2019<span class=\"string\">-05</span><span class=\"string\">-04</span>\", \"2019<span class=\"string\">-06</span><span class=\"string\">-07</span>\", \"2019<span class=\"string\">-06</span><span class=\"string\">-08</span>\",</span><br><span class=\"line\">       \"2019<span class=\"string\">-06</span><span class=\"string\">-09</span>\", \"2019<span class=\"string\">-09</span><span class=\"string\">-13</span>\", \"2019<span class=\"string\">-09</span><span class=\"string\">-14</span>\", \"2019<span class=\"string\">-09</span><span class=\"string\">-15</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-01</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-02</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-03</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-04</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-05</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-06</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-07</span>\",</span><br><span class=\"line\">       \"2020<span class=\"string\">-01</span><span class=\"string\">-01</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-24</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-25</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-26</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-27</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-28</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-29</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-30</span>\", \"2020<span class=\"string\">-01</span><span class=\"string\">-31</span>\", \"2020<span class=\"string\">-02</span><span class=\"string\">-01</span>\", \"2020<span class=\"string\">-02</span><span class=\"string\">-02</span>\",</span><br><span class=\"line\">       \"2020<span class=\"string\">-04</span><span class=\"string\">-04</span>\", \"2020<span class=\"string\">-04</span><span class=\"string\">-05</span>\", \"2020<span class=\"string\">-04</span><span class=\"string\">-06</span>\", \"2020<span class=\"string\">-05</span><span class=\"string\">-01</span>\", \"2020<span class=\"string\">-05</span><span class=\"string\">-02</span>\", \"2020<span class=\"string\">-05</span><span class=\"string\">-03</span>\", \"2020<span class=\"string\">-05</span><span class=\"string\">-04</span>\", \"2020<span class=\"string\">-05</span><span class=\"string\">-05</span>\", \"2020<span class=\"string\">-06</span><span class=\"string\">-25</span>\", \"2020<span class=\"string\">-06</span><span class=\"string\">-26</span>\", \"2020<span class=\"string\">-06</span><span class=\"string\">-27</span>\",</span><br><span class=\"line\">       \"2020<span class=\"string\">-10</span><span class=\"string\">-01</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-02</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-03</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-04</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-05</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-06</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-07</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-08</span>\",</span><br><span class=\"line\">       \"2021<span class=\"string\">-01</span><span class=\"string\">-01</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-11</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-12</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-13</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-14</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-15</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-16</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-17</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-26</span>\", \"2021<span class=\"string\">-04</span><span class=\"string\">-02</span>\", \"2021<span class=\"string\">-04</span><span class=\"string\">-03</span>\",</span><br><span class=\"line\">       \"2021<span class=\"string\">-04</span><span class=\"string\">-04</span>\", \"2021<span class=\"string\">-04</span><span class=\"string\">-30</span>\", \"2021<span class=\"string\">-05</span><span class=\"string\">-01</span>\", \"2021<span class=\"string\">-05</span><span class=\"string\">-02</span>\", \"2021<span class=\"string\">-06</span><span class=\"string\">-12</span>\", \"2021<span class=\"string\">-06</span><span class=\"string\">-13</span>\", \"2021<span class=\"string\">-06</span><span class=\"string\">-14</span>\", \"2021<span class=\"string\">-06</span><span class=\"string\">-12</span>\", \"2021<span class=\"string\">-09</span><span class=\"string\">-19</span>\", \"2021<span class=\"string\">-09</span><span class=\"string\">-20</span>\", \"2021<span class=\"string\">-09</span><span class=\"string\">-21</span>\",</span><br><span class=\"line\">       \"2021<span class=\"string\">-10</span><span class=\"string\">-01</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-02</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-03</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-04</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-05</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-06</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-07</span>\",</span><br><span class=\"line\">       \"2022<span class=\"string\">-01</span><span class=\"string\">-01</span>\", \"2022<span class=\"string\">-01</span><span class=\"string\">-31</span>\", \"2022<span class=\"string\">-02</span><span class=\"string\">-01</span>\", \"2022<span class=\"string\">-02</span><span class=\"string\">-02</span>\", \"2022<span class=\"string\">-02</span><span class=\"string\">-03</span>\", \"2022<span class=\"string\">-02</span><span class=\"string\">-04</span>\", \"2022<span class=\"string\">-02</span><span class=\"string\">-05</span>\", \"2022<span class=\"string\">-02</span><span class=\"string\">-06</span>\", \"2022<span class=\"string\">-04</span><span class=\"string\">-03</span>\", \"2022<span class=\"string\">-04</span><span class=\"string\">-04</span>\", \"2022<span class=\"string\">-04</span><span class=\"string\">-05</span>\",</span><br><span class=\"line\">       \"2022<span class=\"string\">-04</span><span class=\"string\">-30</span>\", \"2022<span class=\"string\">-05</span><span class=\"string\">-01</span>\", \"2022<span class=\"string\">-05</span><span class=\"string\">-02</span>\", \"2022<span class=\"string\">-06</span><span class=\"string\">-03</span>\", \"2022<span class=\"string\">-06</span><span class=\"string\">-04</span>\", \"2022<span class=\"string\">-06</span><span class=\"string\">-05</span>\", \"2022<span class=\"string\">-09</span><span class=\"string\">-09</span>\", \"2022<span class=\"string\">-09</span><span class=\"string\">-10</span>\", \"2022<span class=\"string\">-09</span><span class=\"string\">-11</span>\", \"2022<span class=\"string\">-10</span><span class=\"string\">-01</span>\", \"2022<span class=\"string\">-10</span><span class=\"string\">-02</span>\",</span><br><span class=\"line\">       \"2022<span class=\"string\">-10</span><span class=\"string\">-03</span>\", \"2022<span class=\"string\">-10</span><span class=\"string\">-04</span>\", \"2022<span class=\"string\">-10</span><span class=\"string\">-05</span>\", \"2022<span class=\"string\">-10</span><span class=\"string\">-06</span>\", \"2022<span class=\"string\">-10</span><span class=\"string\">-07</span>\"</span><br><span class=\"line\">     ],</span><br><span class=\"line\">     //需要上班的周末</span><br><span class=\"line\">     weekendWorkDay: [\"2018<span class=\"string\">-12</span><span class=\"string\">-29</span>\", \"2019<span class=\"string\">-02</span><span class=\"string\">-02</span>\", \"2019<span class=\"string\">-09</span><span class=\"string\">-29</span>\", \"2019<span class=\"string\">-10</span><span class=\"string\">-12</span>\", \"2019<span class=\"string\">-04</span><span class=\"string\">-28</span>\", \"2019<span class=\"string\">-05</span><span class=\"string\">-05</span>\",</span><br><span class=\"line\">       \"2020<span class=\"string\">-01</span><span class=\"string\">-19</span>\", \"2020<span class=\"string\">-04</span><span class=\"string\">-26</span>\", \"2020<span class=\"string\">-05</span><span class=\"string\">-09</span>\", \"2020<span class=\"string\">-06</span><span class=\"string\">-28</span>\", \"2020<span class=\"string\">-09</span><span class=\"string\">-27</span>\", \"2020<span class=\"string\">-10</span><span class=\"string\">-10</span>\",</span><br><span class=\"line\">       \"2021<span class=\"string\">-02</span><span class=\"string\">-07</span>\", \"2021<span class=\"string\">-02</span><span class=\"string\">-20</span>\", \"2021<span class=\"string\">-09</span><span class=\"string\">-18</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-09</span>\", \"2021<span class=\"string\">-10</span><span class=\"string\">-10</span>\"</span><br><span class=\"line\">     ],</span><br><span class=\"line\">     festival_list: [],</span><br><span class=\"line\">     weekendWorkDay_list: []</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"响应方法\"><a href=\"#响应方法\" class=\"headerlink\" title=\"响应方法\"></a>响应方法</h5><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 将节假日,周末工作日转换为时间戳</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.festival.forEach(<span class=\"function\">(<span class=\"params\">i, item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.festival_list.push(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(item).valueOf())</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.weekendWorkDay.forEach(<span class=\"function\">(<span class=\"params\">i, item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.weekendWorkDay_list.push(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(item).valueOf())</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.formatCountDay(<span class=\"string\">\"2022-07-22\"</span>, <span class=\"string\">\"2022-07-25\"</span>)</span><br></pre></td></tr></table></figure>\n<h5 id=\"读入数据\"><a href=\"#读入数据\" class=\"headerlink\" title=\"读入数据\"></a>读入数据</h5><figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 过滤俩天之间的周末节假日，返回距离的天数</span></span><br><span class=\"line\">    formatCountDay (start, end) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> sign = <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> startday = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(start)</span><br><span class=\"line\">      <span class=\"keyword\">var</span> endday = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(end)</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// 总相差天数</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> diffDay = (endday - startday) / (<span class=\"number\">1000</span> * <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">24</span>) + <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">parseInt</span>(diffDay) === <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(diffDay)</span><br><span class=\"line\">      <span class=\"comment\">// 周末周六天数+节假日</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> weekEnds = <span class=\"number\">0</span></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; diffDay; i++) &#123;</span><br><span class=\"line\">        sign = <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"comment\">// 判断是否是节假日</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.festival_list.includes(startday.valueOf())) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">\"节假日\"</span>)</span><br><span class=\"line\">          weekEnds = weekEnds + <span class=\"number\">1</span></span><br><span class=\"line\">          sign = <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 判断周六周日，如果是节假日则不作判断</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sign === <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (startday.getDay() === <span class=\"number\">0</span> || startday.getDay() === <span class=\"number\">6</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 判断该周末是否需要因为节假日补班</span></span><br><span class=\"line\">            <span class=\"keyword\">var</span> weekEnds_sign = <span class=\"number\">0</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j <span class=\"keyword\">in</span> <span class=\"keyword\">this</span>.weekendWorkDay_list) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (startday.valueOf() === <span class=\"keyword\">this</span>.weekendWorkDay_list[j]) &#123;</span><br><span class=\"line\">                weekEnds_sign = weekEnds_sign + <span class=\"number\">1</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (weekEnds_sign === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">              weekEnds = weekEnds + <span class=\"number\">1</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startday.setDate(startday.getDate() + <span class=\"number\">1</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(diffDay - weekEnds)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(diffDay - weekEnds)</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 计算请假时长</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>beginTime    开始时间</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>endTime      结束时间</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>stWorkTime   上班时间</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>enWrokTime   下班时间</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>isFreeTime  是否要去除午休工作时长</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>freeTimeMon  午休开始时间</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param <span class=\"type\">&#123;Object&#125;</span> </span>freeTimeAft  午休结束时间</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\">     getTotal(beginTime ,endTime,stWorkTime,enWrokTime,isFreeTime,freeTimeMon,freeTimeAft)&#123;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> days;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> hours;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> date;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> freeTime=freeTimeAft-freeTimeMon;</span><br><span class=\"line\">         </span><br><span class=\"line\">         beginTime = beginTime.replace(<span class=\"regexp\">/-/g</span>,<span class=\"string\">'/'</span>);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> beginArr =  beginTime.split(<span class=\"string\">\" \"</span>);     </span><br><span class=\"line\">         <span class=\"keyword\">var</span> beginMonth = <span class=\"built_in\">parseInt</span>( beginArr[<span class=\"number\">0</span>].split(<span class=\"string\">\"/\"</span>)[<span class=\"number\">1</span>]);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> beginDay = <span class=\"built_in\">parseInt</span>(beginArr[<span class=\"number\">0</span>].split(<span class=\"string\">\"/\"</span>)[<span class=\"number\">2</span>]); </span><br><span class=\"line\">         <span class=\"keyword\">var</span> beginHours = <span class=\"built_in\">parseInt</span>(beginArr[<span class=\"number\">1</span>].split(<span class=\"string\">\":\"</span>)[<span class=\"number\">0</span>]);                                       </span><br><span class=\"line\">         <span class=\"keyword\">var</span> beginMin = <span class=\"built_in\">parseInt</span>(beginArr[<span class=\"number\">1</span>].split(<span class=\"string\">\":\"</span>)[<span class=\"number\">1</span>]);   </span><br><span class=\"line\">         <span class=\"keyword\">var</span> beginHoursMin = beginHours+beginMin/<span class=\"number\">60</span>;</span><br><span class=\"line\">       </span><br><span class=\"line\">         endTime = endTime.replace(<span class=\"regexp\">/-/g</span>,<span class=\"string\">'/'</span>);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> endArr = endTime.split(<span class=\"string\">\" \"</span>);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> endMonth = <span class=\"built_in\">parseInt</span>(endArr[<span class=\"number\">0</span>].split(<span class=\"string\">\"/\"</span>)[<span class=\"number\">1</span>]);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> endDay = <span class=\"built_in\">parseInt</span>(endArr[<span class=\"number\">0</span>].split(<span class=\"string\">\"/\"</span>)[<span class=\"number\">2</span>]);  </span><br><span class=\"line\">         <span class=\"keyword\">var</span> endHours = <span class=\"built_in\">parseInt</span>(endArr[<span class=\"number\">1</span>].split(<span class=\"string\">\":\"</span>)[<span class=\"number\">0</span>]);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> endMin = <span class=\"built_in\">parseInt</span>(endArr[<span class=\"number\">1</span>].split(<span class=\"string\">\":\"</span>)[<span class=\"number\">1</span>]);</span><br><span class=\"line\">         <span class=\"keyword\">var</span> endHoursMin = endHours+endMin/<span class=\"number\">60</span>;</span><br><span class=\"line\">     </span><br><span class=\"line\">         </span><br><span class=\"line\">         <span class=\"comment\">//如果beginHoursMin时间小于上班时间都算上班时间</span></span><br><span class=\"line\">         <span class=\"keyword\">if</span> (beginHoursMin&lt;=stWorkTime)&#123;     </span><br><span class=\"line\">             beginHoursMin = stWorkTime;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"comment\">//如果endHoursMin时间大于上班时间都算下班时间</span></span><br><span class=\"line\">         <span class=\"keyword\">if</span> (endHoursMin&gt;=enWrokTime)&#123;</span><br><span class=\"line\">             endHoursMin = enWrokTime;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"comment\">//如果结束时间在freeTimeMon和freeTimeAft之间都算freeTimeMon</span></span><br><span class=\"line\">         <span class=\"keyword\">if</span> (isFreeTime==<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">             <span class=\"keyword\">if</span> (endHoursMin&gt;=freeTimeMon &amp;&amp; endHoursMin&lt;=freeTimeAft)&#123;</span><br><span class=\"line\">                 endHoursMin = freeTimeMon;</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">             </span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">             </span><br><span class=\"line\">         </span><br><span class=\"line\">         <span class=\"comment\">//获取结束时间-开始时间的天数</span></span><br><span class=\"line\">         <span class=\"keyword\">var</span> daysBetween = <span class=\"keyword\">this</span>.daysBetween(beginTime,endTime);</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (daysBetween.length&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">             <span class=\"keyword\">var</span> daysBetweenLen = daysBetween.length;</span><br><span class=\"line\">             <span class=\"comment\">//午休</span></span><br><span class=\"line\">             <span class=\"keyword\">if</span> (isFreeTime==<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                 <span class=\"keyword\">var</span> hour = enWrokTime-stWorkTime-freeTime;</span><br><span class=\"line\">                 <span class=\"keyword\">if</span> (daysBetweenLen==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                     <span class=\"comment\">//同一天</span></span><br><span class=\"line\">                     hours=(endHoursMin)-(beginHoursMin)-freeTime;</span><br><span class=\"line\">                 &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (daysBetweenLen==<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">                     <span class=\"comment\">//跨一天   </span></span><br><span class=\"line\">                     <span class=\"comment\">//第一天的时长</span></span><br><span class=\"line\">                     hours = enWrokTime - beginHoursMin;</span><br><span class=\"line\">                     <span class=\"comment\">//是否有午休         </span></span><br><span class=\"line\">                     <span class=\"keyword\">if</span> (beginHoursMin&lt;=freeTimeMon) </span><br><span class=\"line\">                         hours=hours-freeTime;</span><br><span class=\"line\">                     <span class=\"comment\">//第二天的时长    </span></span><br><span class=\"line\">                     hours += endHoursMin -stWorkTime ;</span><br><span class=\"line\">                     <span class=\"comment\">//是否有午休 </span></span><br><span class=\"line\">                     <span class=\"keyword\">if</span> (endHoursMin&gt;=freeTimeAft)</span><br><span class=\"line\">                         hours=hours-freeTime;</span><br><span class=\"line\">                             </span><br><span class=\"line\">                 &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                     <span class=\"comment\">//跨两天以上 </span></span><br><span class=\"line\">                     <span class=\"comment\">//第一天的时长</span></span><br><span class=\"line\">                     hours = enWrokTime - beginHoursMin;</span><br><span class=\"line\">                     <span class=\"comment\">//是否有午休             </span></span><br><span class=\"line\">                     <span class=\"keyword\">if</span> (beginHoursMin&lt;=freeTimeMon) </span><br><span class=\"line\">                         hours=hours-freeTime;</span><br><span class=\"line\">                     <span class=\"comment\">//中间时长</span></span><br><span class=\"line\">                     hours+=(daysBetweenLen<span class=\"number\">-2</span>)*(hour);</span><br><span class=\"line\">                     <span class=\"comment\">//最后一天时长</span></span><br><span class=\"line\">                     hours += endHoursMin -stWorkTime ;</span><br><span class=\"line\">                     <span class=\"comment\">//是否有午休 </span></span><br><span class=\"line\">                     <span class=\"keyword\">if</span> (endHoursMin&gt;=freeTimeAft)</span><br><span class=\"line\">                         hours=hours-freeTime;</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">                 days = <span class=\"built_in\">Math</span>.floor(hours/hour);</span><br><span class=\"line\">                 hours = hours%hour;</span><br><span class=\"line\">                 date =&#123;<span class=\"string\">\"days\"</span>:days,<span class=\"string\">\"hours\"</span>:hours&#125;;          </span><br><span class=\"line\">                 </span><br><span class=\"line\">             &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">             <span class=\"comment\">//非午休   </span></span><br><span class=\"line\">                 hour = enWrokTime-stWorkTime;</span><br><span class=\"line\">                 <span class=\"keyword\">if</span> (daysBetweenLen==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">                     <span class=\"comment\">//同一天</span></span><br><span class=\"line\">                     hours=(endHoursMin)-(beginHoursMin);</span><br><span class=\"line\">                 &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (daysBetweenLen==<span class=\"number\">2</span>)&#123;</span><br><span class=\"line\">                     <span class=\"comment\">//跨一天   </span></span><br><span class=\"line\">                     hours = enWrokTime - beginHoursMin; </span><br><span class=\"line\">                     <span class=\"comment\">//第二天的时长</span></span><br><span class=\"line\">                     hours += endHoursMin -stWorkTime ;              </span><br><span class=\"line\">                 &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                     <span class=\"comment\">//跨两天以上 </span></span><br><span class=\"line\">                     <span class=\"comment\">//第一天的时长</span></span><br><span class=\"line\">                     hours = enWrokTime - beginHoursMin; </span><br><span class=\"line\">                     <span class=\"comment\">//中间时长</span></span><br><span class=\"line\">                     hours+=(daysBetweenLen<span class=\"number\">-2</span>)*(hour);</span><br><span class=\"line\">                     <span class=\"comment\">//最后一天时长</span></span><br><span class=\"line\">                     hours += endHoursMin -stWorkTime ;              </span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">                 days = <span class=\"built_in\">Math</span>.floor(hours/hour);</span><br><span class=\"line\">                 hours = hours%hour;</span><br><span class=\"line\">                 date =&#123;<span class=\"string\">\"days\"</span>:days,<span class=\"string\">\"hours\"</span>:hours&#125;;</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">             </span><br><span class=\"line\">         </span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(date)</span><br><span class=\"line\">         <span class=\"keyword\">return</span> date;</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">     <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* 根据两个日期，判断相差天数</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param </span>sDate1 开始日期 如：2016-11-01</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@param </span>sDate2 结束日期 如：2016-11-02</span></span><br><span class=\"line\"><span class=\"comment\">* <span class=\"doctag\">@returns <span class=\"type\">&#123;number&#125;</span> </span>返回相差天数</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\">     daysBetween(sDate1,sDate2)&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\">       sDate1 = sDate1.substring(<span class=\"number\">0</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">       sDate2 = sDate2.substring(<span class=\"number\">0</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> startTime = <span class=\"keyword\">this</span>.gDate(sDate1);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> endTime = <span class=\"keyword\">this</span>.gDate(sDate2);</span><br><span class=\"line\">       <span class=\"keyword\">while</span>((endTime.getTime()-startTime.getTime())&gt;=<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">         <span class=\"keyword\">var</span> year = startTime.getFullYear();</span><br><span class=\"line\">         <span class=\"keyword\">var</span> month = startTime.getMonth().toString().length==<span class=\"number\">1</span>?<span class=\"string\">\"0\"</span>+startTime.getMonth().toString():startTime.getMonth();</span><br><span class=\"line\">         <span class=\"keyword\">var</span> day = startTime.getDate().toString().length==<span class=\"number\">1</span>?<span class=\"string\">\"0\"</span>+startTime.getDate():startTime.getDate();</span><br><span class=\"line\">         arr.push(year+<span class=\"string\">\"/\"</span>+month+<span class=\"string\">\"/\"</span>+day);</span><br><span class=\"line\">         startTime.setDate(startTime.getDate()+<span class=\"number\">1</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> arr;</span><br><span class=\"line\"></span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">     gDate(datestr)&#123;</span><br><span class=\"line\">       datestr=datestr.replace(<span class=\"regexp\">/-/g</span>,<span class=\"string\">'/'</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> temp = datestr.split(<span class=\"string\">\"/\"</span>);</span><br><span class=\"line\">       <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(temp[<span class=\"number\">0</span>],temp[<span class=\"number\">1</span>],temp[<span class=\"number\">2</span>]);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> date;</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\"> </span><br><span class=\"line\"> \t<span class=\"comment\">//函数调用</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.getTotal(<span class=\"string\">'2022-08-27 09:00:00'</span> ,<span class=\"string\">'2022-08-28 18:00:00'</span>,<span class=\"number\">9</span>,<span class=\"number\">18</span>,<span class=\"literal\">false</span>,<span class=\"number\">12</span>,<span class=\"number\">13.5</span>)</span><br></pre></td></tr></table></figure>\n","tags":["VUE","uniapp开发"]},{"title":"记录hexo替换主题","url":"/2017/09/09/%E8%AE%B0%E5%BD%95hexo%E6%9B%BF%E6%8D%A2%E4%B8%BB%E9%A2%98/","content":"<p>博客也是上线了一年了，结果拖拖拉拉一直没什么东西写，今天闲来无事想着更换看腻了的博客主题。在 <a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">hexo主题官网</a> 找到了一款极简的主题 <a href=\"https://github.com/frostfan/hexo-theme-polarbear\" target=\"_blank\" rel=\"noopener\">polarbear</a> ,安装替换现有主题都是常规流程。参考制作人的readme步骤。</p>\n<figure class=\"highlight elixir\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$ </span>npm install hexo-renderer-scss --save</span><br><span class=\"line\"><span class=\"variable\">$ </span>git clone <span class=\"symbol\">https:</span>/<span class=\"regexp\">/github.com/frostfan</span><span class=\"regexp\">/hexo-theme-polarbear themes/polarbear</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"修改配置-config-yml\"><a href=\"#修改配置-config-yml\" class=\"headerlink\" title=\"修改配置 _config.yml\"></a>修改配置 <strong>_config.yml</strong></h1><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Extensions</span></span><br><span class=\"line\"><span class=\"comment\">## Plugins: http://hexo.io/plugins/</span></span><br><span class=\"line\"><span class=\"comment\">## Themes: http://hexo.io/themes/</span></span><br><span class=\"line\"><span class=\"attr\">theme:</span> <span class=\"string\">polarbear</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在归档页面显示所有文章 （Show all articles on archive page.）</span></span><br><span class=\"line\"><span class=\"comment\"># 需要安装(Need to install) hexo-generator-archive 插件支持</span></span><br><span class=\"line\"><span class=\"attr\">archive_generator:</span></span><br><span class=\"line\">    <span class=\"attr\">per_page:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">yearly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">monthly:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">daily:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>结果 <strong>archive</strong> 和 <strong>about</strong> 遇到了问题。右上角的归档页和关于我找不到路径。</p>\n<p><img src=\"http://xiaobokeji-test.oss-cn-shenzhen.aliyuncs.com/upload/39f20625-eeef-cc03-1f9e-4d03778175c9/achite.png\" alt=\"image\"></p>\n<hr>\n<h1 id=\"更换自己喜欢的网页图标\"><a href=\"#更换自己喜欢的网页图标\" class=\"headerlink\" title=\"更换自己喜欢的网页图标\"></a>更换自己喜欢的网页图标</h1><p>网上搜索自己喜欢的图片，尺寸小，注意格式要是<code>.ico</code>,替换本地<code>themes</code>文件夹下的<code>favicon.icon</code>文件即可。</p>\n<hr>\n<h1 id=\"解决about找不到\"><a href=\"#解决about找不到\" class=\"headerlink\" title=\"解决about找不到\"></a>解决about找不到</h1><p>排查了一下问题，可能是文件找不到。终于找到了相关教程，new了文件</p>\n<figure class=\"highlight routeros\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo new<span class=\"built_in\"> page </span><span class=\"string\">\"about\"</span></span><br><span class=\"line\">hexo new<span class=\"built_in\"> page </span><span class=\"string\">\"archives\"</span></span><br></pre></td></tr></table></figure>\n<p>执行命令后在本地站点的source目录下生成一个about文件夹，修改about文件夹下的index.md。相应的archives也要修改type</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">about</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2016</span><span class=\"number\">-03</span><span class=\"number\">-23</span> <span class=\"number\">14</span><span class=\"string\">:24:06</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">about</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">title:</span> <span class=\"string\">archives</span></span><br><span class=\"line\"><span class=\"attr\">date:</span> <span class=\"number\">2016</span><span class=\"number\">-03</span><span class=\"number\">-23</span> <span class=\"number\">14</span><span class=\"string\">:24:06</span></span><br><span class=\"line\"><span class=\"attr\">type:</span> <span class=\"string\">archive</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br></pre></td></tr></table></figure>\n<p>重启服务就发现about可以正常跳转一个空页了。</p>\n<hr>\n<h1 id=\"解决archive找不到\"><a href=\"#解决archive找不到\" class=\"headerlink\" title=\"解决archive找不到\"></a>解决archive找不到</h1><p>百思不得其解为什么hexo没有自动生成archive，明明是安装了插件就可以支持的。重新执行了一下安装命令。<br><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">install</span> <span class=\"comment\">--save hexo-generator-archive</span></span><br></pre></td></tr></table></figure></p>\n<p>在node_modules下找到了相应的hexo-generator-archive，证明插件安装成功。但是还是没有自动生成。</p>\n<p>终于排查到了问题，<strong>_config.yml</strong> 网站配置文件里的文件目录写错了 </p>\n<figure class=\"highlight avrasm\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\"># 错误</span></span><br><span class=\"line\"><span class=\"symbol\">archive_dir:</span> archive</span><br><span class=\"line\"><span class=\"meta\"># 正确</span></span><br><span class=\"line\"><span class=\"symbol\">archive_dir:</span> archives</span><br></pre></td></tr></table></figure>\n<p>终于成功了！</p>\n<p><img src=\"http://xiaobokeji-test.oss-cn-shenzhen.aliyuncs.com/upload/39f20628-f2aa-db19-1214-3dff2a83249e/%E6%B5%8B%E8%AF%95.png\" alt=\"image\"></p>\n<hr>\n<h1 id=\"以下是9月10日更新：\"><a href=\"#以下是9月10日更新：\" class=\"headerlink\" title=\"以下是9月10日更新：\"></a>以下是9月10日更新：</h1><p>侧边栏没有展示自定义的widget</p>\n<p>修改本地站点的 <strong>_config.yml</strong> 的相关配置语句并没有生效，经过排查发现是主题的 <strong>_config.yml</strong> 的相关配置是false，看来主题的配置权重更高。修改为false之后就发现了自定义的 <strong>widget_custom</strong> 出现了。</p>\n<p><img src=\"http://xiaobokeji-test.oss-cn-shenzhen.aliyuncs.com/upload/39f20628-f2aa-db19-1214-3dff2a83249e/%E6%B5%8B%E8%AF%95.png\" alt=\"image\"></p>\n<hr>\n<p>参考文章 </p>\n<ul>\n<li><a href=\"https://hexo.io/zh-cn/docs/configuration.html\" target=\"_blank\" rel=\"noopener\">官方说明</a></li>\n<li><a href=\"https://blog.csdn.net/tonydandelion2014/article/details/61615898\" target=\"_blank\" rel=\"noopener\">Hexo安装配置详解</a></li>\n</ul>\n","tags":["hexo"]},{"title":"请求封装","url":"/2018/03/29/%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%B0%81%E8%A3%85/","content":"<p>目前后台是微服务架构，所以不同的业务模块会请求到不同的地址，而不同的环境（测试/beta/生产）会携带不同的请求头进行区分，同时每个请求都有固定的参数携带，所以需要对请求进行统一的封装和管理。在这里记录一下封装请求的代码。</p>\n<p>目前请求统一封装至 services 文件夹，按照后台模块名进行区分。每个请求都会封装成一个Promise，使用async/await进行异步请求管理。注意同时发起的多个请求使用Promise.all封装为一个新的Promise进行管理，防止串行请求影响性能。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> resp = <span class=\"keyword\">await</span> OpService.getProjects()</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(resp)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> requests = [UcService.getCurrentDeptLoginInfo(), UcService.getDepts()]</span><br><span class=\"line\"><span class=\"keyword\">let</span> [currentDeptResp, deptsResp] = <span class=\"keyword\">await</span> <span class=\"built_in\">Promise</span>.all(requests)</span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"1\"><a href=\"#1\" class=\"headerlink\" title=\"1\"></a>1</h1><ul>\n<li>utils/request.js</li>\n<li>封装请求</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//module区分模块，模块名称封装在 【src/config/module.js】里</span></span><br><span class=\"line\"><span class=\"comment\">//path 是请求的文件路径</span></span><br><span class=\"line\"><span class=\"comment\">//data 是传入数据</span></span><br><span class=\"line\"><span class=\"comment\">//noAccessToken 大部分时间都是false ，极端情况 比如登陆、投诉之类的不需要</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span>(module, path, data, noAccessToken = false) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> config = <span class=\"keyword\">await</span> BaseService.getConfig()</span><br><span class=\"line\">        <span class=\"keyword\">let</span> client = <span class=\"keyword\">await</span> BaseService.getClient(<span class=\"built_in\">module</span>)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> services = config.services[<span class=\"built_in\">module</span>]</span><br><span class=\"line\">        <span class=\"keyword\">let</span> resp = <span class=\"keyword\">await</span> client.get(makeUrl(services.host, path, data, noAccessToken), &#123;</span><br><span class=\"line\">          headers: &#123;</span><br><span class=\"line\">            accept: <span class=\"string\">'application/json'</span>,</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        resolve(resp)</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">await</span> handleError(e)</span><br><span class=\"line\">        reject(e)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"2\"><a href=\"#2\" class=\"headerlink\" title=\"2\"></a>2</h1><ul>\n<li>eg: src\\services.js</li>\n<li>封装请求</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 登录后获取当前基础信息接口</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"comment\">//R是在build/webpack.base.conf.js里声明过的封装方法</span></span><br><span class=\"line\"> <span class=\"comment\">//里面包含了基础的请求信息</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCurrentDeptLoginInfo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res, rej</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> resp = <span class=\"keyword\">await</span> R.get(Config.module.UC, <span class=\"string\">'/user/get_current_dept_login_info'</span>)</span><br><span class=\"line\">      res(resp)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      rej(e)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> p</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<hr>\n<h1 id=\"3-应用请求\"><a href=\"#3-应用请求\" class=\"headerlink\" title=\"3 应用请求\"></a>3 应用请求</h1><ul>\n<li>src\\app.js</li>\n<li>调用封装的方法</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> handleDeptCommand(id) &#123;</span><br><span class=\"line\">   Loading.show()</span><br><span class=\"line\">   <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">let</span> resp = <span class=\"keyword\">await</span> UserService.switchDept(id)</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (resp.errcode == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">let</span> resp2 = <span class=\"keyword\">await</span> UserService.getCurrentDeptLoginInfo()</span><br><span class=\"line\">       BaseService.setBasicData(resp2.info)</span><br><span class=\"line\">       <span class=\"keyword\">this</span>._renderBasicData(resp2.info)</span><br><span class=\"line\">       <span class=\"keyword\">this</span>.$router.push(<span class=\"string\">'/'</span>)</span><br><span class=\"line\">     &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">       <span class=\"built_in\">console</span>.error(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'errcode: '</span> + resp.errcode))</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">     <span class=\"built_in\">console</span>.error(e)</span><br><span class=\"line\">   &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">     Loading.hide()</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n","tags":["前端","VUE"]}]